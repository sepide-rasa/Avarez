@model Avarez.Models.Varizi_Savabegh
@using Ext.Net.MVC
@using Hogaf.ExtNet.UX
@using Ext.Net;
@using Ext.Net.Utilities;
@{
    var X = Html.X();
    Avarez.Models.cartaxEntities Car = new Avarez.Models.cartaxEntities();
    var subSett = Car.sp_SelectSubSetting(0, 0, Convert.ToInt32(Session["CountryType"]), Convert.ToInt32(Session["CountryCode"]), Car.sp_GetDate().FirstOrDefault().CurrentDateTime).FirstOrDefault();
    bool? ForceScan = true;
    bool? ExpScan = true;
    bool onlinePer=false;
    bool resid = false;
    if (subSett != null)
    {
        ForceScan = subSett.fldHaveScan;
        ExpScan = subSett.fldExpScan;
    }

    var picmnu = Car.sp_SelectNameBankAndMunForBankInformation(Convert.ToInt32(Session["CountryCode"]), Convert.ToInt32(Session["CountryType"])).ToList();
    var HaveBank = false;
    if (picmnu.Count != 0)
    {
        HaveBank = true;
        var Per = Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 416);
        if (HaveBank == true && Per == true)
        {
            onlinePer = true;
        }
    }
    if (Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 387))
    {
        resid = true;
    }
    var Pishkhan = false;
    var user = Car.sp_UserSelect("fldid", Convert.ToInt32(Session["UserId"]).ToString(), 1, "",1,"").FirstOrDefault();
    if (user.fldOfficeUserKey != null)
    {
        Pishkhan = true;
        if (HaveBank) { 
            HaveBank = false;
            onlinePer = false;

        } resid = false;
    }
}


<style>
    /*.hideicon a.x-menu-item {
            padding-right: 0;
    }*/
    .no-icon-menu .x-menu-item-icon { display: none; }

    .ifs-tooltip {
        overflow: visible;
        background-color: #f8f8d6;
        border: 1px solid #CCC;
        -webkit-box-shadow: 4px 4px 4px 0px #CCC;
        -moz-box-shadow: 4px 4px 4px 0px #CCC;
        box-shadow: 4px 4px 4px 0px #CCC;
    }

    .ifs-tooltip-body {
        position: relative;
        padding: 10px;
    }

    .x-tip-anchor {
        background-repeat: no-repeat;
        border-width: 0px;
    }

    .x-tip-anchor-top {
        width: 58px;
        height: 19px;
        /*top: -67px !important;*/
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAAUCAYAAADcHS5uAAAACXBIWXMAAAsSAAALEgHS3X78AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAslJREFUeNrslr9rE2Ecxr939/7IvWmSS3pt09CCTsXyikp1EwouDnbSQQRBURxdVKrSP6Hg4uQoCBYHFyt0cSgqVrnxxXYvapukd6RJLsnde3kdHGwL1tb0kgw+4x28Xz73fN/nHk0pBf8VkxzHmXYc50w3ZimlQCkF2s6HzebXWIcK4Y/ZNn1NCDrVbEowDPhUKrUucs5acc2k9AQAAOjdcnF1tXU3l6NrlkXP5XKKFAoGSSbJdDqNN4Xwz8c9P3ZHhfD54CBdRMgYt21d17T2rvdRhMDzZMN15YsgCOY4Z6U4HI0NVAg/Tyl9bFn6LcvCAxjLfb93va5DrRZ+L5WaNwHgHeesfZSgKAYHDYzxtXzenDdNlGdMgabJv0UGJJMRJBK4IKVaRAg+AsCFvl1dIfy8bSeWAGByaAhjw4j+6ZxazQDPa21VKsEVztly36yuEH6CEHI/k9FnUymSZkx27EAUGVCptBvlcrgQBMEs56zcU1Ah/JPDw4k3iQQaS6XA2Bs2nS5craaD57XcSiW4xDlb6Qno5mb7s5Tq9MgIJQhJiEvttgEbG0FQrbZfhmF4j3PmdgV0bS24kUzqT7NZmhoYiKA7+pXM9br8Viw2LnPOvsQGKoQ/adt0gRA0aVm6oevdgtz93y2VgpamqZWDtKpDgQrhM4zxQ8tCD7JZzAiR0GtVqwZ4XrOyvR3OcM4+dAwqhH82l6NLjGErkznqsOn87rpu1NjaCl+FYfiIc7ZxaFAh/GOEkCe5HJpJpxHuBxf/cnfXi8XG7b2t6o/NSAg/gRC6OjrK5hlDQ6YZAUC/Qu5sVWg8DOnbel09B4A7+zYjx3Hytk3fY4yOZ7O9CZujcNd1f7eqXavrOA7DGM+aJszl8ybq3zU9eKtyXdlUSi0Xi83rU1NTZc1xnGlK6TPG2EShEEI/hU2nqtcNWF9v/JBSTvwcADNrUKvy2XKvAAAAAElFTkSuQmCC);
    }
    .Helpp {
        background-image: url("/Content/icon/mini/help.png");
        background-size: contain !important;
    }
    .x-textfield-icon {
        padding-left:215px;
    }
    .lblP {
        color: green;
    }
    .boldCaption{
        font-weight:bold;
    }

    .colorval {
        color:purple;
    }
    .x-form-cb-label-after {
        margin-left: 10px !important;
    }
    .lbl {
        background-color: rgb(255, 202, 153);
    }
    .Archive {
        background-image: url("/Content/icon/mini/archive.png");
        background-size: contain !important;
    }
    .Savabegh {
        background-image: url("/Content/icon/mini/download (2).png");
        background-size: contain !important;
    }
    .tick {
        background-image: url("/Content/icon/mini/tick.png");
        background-size: contain !important;
    }
    .Fish {
        background-image: url("/Content/icon/mini/ثبت واریزی.png");
        background-size: cover !important;
    }
    .Actions {
        background-image: url("/Content/icon/mini/عملیاتت.png");
        background-size: cover !important;
    }
    .Varizi {
        background-image: url("/Content/icon/mini/ثبت واریزی.png");
        background-size: contain !important;
    }
    .Mafasa {
        background-image: url("/Content/icon/mini/مشاهده مفاصا.png");
        background-size: contain !important;
    }
    .Tekrari {
        background-image: url("/Content/icon/mini/حذف فیش های تکراری.png");
        background-size: contain !important;
    }
    .Siah {
        background-image: url("/Content/icon/mini/ListBlak (2).png");
        background-size: contain !important;
    }
    .kholase {
        background-image: url("/Content/icon/mini/خلاصه وضعیت.png");
        background-size: contain !important;
    }
    .VMoshakhasat {
        background-image: url("/Content/icon/mini/ویرایش مشخصات خودرو.png");
        background-size: contain !important;
    }
    .VSavabegh {
        background-image: url("/Content/icon/mini/ویرایش سوابق.png");
        background-size: contain !important;
    }
    .VTasavir {
        background-image: url("/Content/icon/mini/ویرایش-تصاویر.png");
        background-size: contain !important;
    }
    .VMalek {
        background-image: url("/Content/icon/mini/changeowner.png");
        background-size: cover !important;
    }
    .FishD {
        background-image: url("/Content/icon/mini/فیش های در حال وصول.png");
        background-size: cover !important;
    }
    .soorathesab {
        background-image: url("/Content/icon/mini/صورتحساب.png");
        background-size: cover !important;
    }

    .Pos {
        background-image: url("/Content/images/پیگیری تراکنشها.png");
        background-size: contain !important;
    }
     .Back {
        background-image: url("/Content/kartMashins.jpg");
        background-repeat: no-repeat;
        background-size: contain;
    }
.Back2{
    background-image:url("/Content/kartMashins2.jpg");
    background-repeat:no-repeat;
    background-size:contain;
}
</style>

@(X.Panel()
    .ID("SelectParvande" + (string)ViewBag.CarFileId)//.Frame(true)
    .Closable(true)
    .CloseAction(Ext.Net.CloseAction.Destroy)
    .Listeners(l => l.Render.Handler = "setTitleforTab()")
    .Border(false)
    .BodyStyle("background-color:#dfe8f6;")
        //.BodyStyle("background-color:red;")
        //.Layout(LayoutType.Fit)
    .AutoScroll(true)
    .TopBar(
        X.Toolbar()
            .Border(false)//.Frame(true).Width(300).Height(50)
            .Defaults(new { Margin = 5 })
            .Items(
                X.Button()
                    .Text("صفحه اصلی")
                    .Icon(Icon.BulletHome)
                    .Listeners(l => l.Click.Handler = "GotoFirstPage()"),
                X.Button()
                    .Text("انتقال سوابق")
                    .IconCls("Savabegh")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 242))
                    .Listeners(l => l.Click.Handler = "ShowPnlSavabegh()"),
                /*X.Button()
                    .Text("صورت حساب بازه ای")
                    .Menu(
                        Html.X().Menu().ID("MenuBill" + (string)ViewBag.CarFileId)
                            .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 427))
                            .Width(80)),*/
                X.Button()
                    .Text("صورت حساب")
                    .IconCls("soorathesab")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 246))
                    .Listeners(l => l.Click.Handler = "ShowPnlBill(0);"),
                X.Button()
                    .Text("ثبت واریزی")
                    .IconCls("Varizi")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 290))
                    .Listeners(l => l.Click.Handler = "ShowPnlVarizi();"),
                X.Button()
                    .Text("مفاصا حساب")
                    .IconCls("Mafasa")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 351))
                    .Listeners(l => l.Click.Handler = "Mafasa();"),
                X.Button()
                    .Text("دانلود مفاصا حساب")
                    .Icon(Icon.ArrowDown)
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 415))
                    .Listeners(l => l.Click.Handler = "DownloadMafasa();"),
                X.Button()
                    .Text("حذف فیش های تکراری")
                    .IconCls("Tekrari")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 302))
                    .Listeners(l => l.Click.Handler = "HazfTekrari();"),
                X.Button()
                    .Text("لیست سیاه")
                    .IconCls("Siah")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 308))
                    .Listeners(l => l.Click.Handler = "ShowPnlBlackList();"),
                X.Button()
                    .Text("آرشیو")
                    .Icon(Icon.BoxPicture)
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 392))
                    .Listeners(l => l.Click.Handler = "Archive();"),
                X.Button()
                    .Text("پیگیری پرداخت های شهرداری")
                    .IconCls("pishkhanpos")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 422))
                    .Listeners(l => l.Click.Handler = "ListPishkhanpos();"),
                X.Button()
                    .Text("پیگیری رسیدهای پیشخوان")
                    .IconCls("pishkhanReciept")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 424))
                    .Listeners(l => l.Click.Handler = "ListPishkhanReciept();"),
                X.Button()
                    .Text("خلاصه وضعیت")
                    .IconCls("kholase")
                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 395))
                    .Listeners(l => l.Click.Handler = "kholaseVaziyat();")
                )
            )
        .Items(
        X.Hidden()
            .ItemID("fldCarPlaqueID")
            .Value(0),
        X.Hidden()
            .ItemID("fldIdVarizi")
            .Value(0),
        X.Hidden()
            .ItemID("fldIdBlackList")
            .Value(0),
        X.Hidden()
            .Value(0)
            .ItemID("fldMalekId"),
        X.Hidden()
            .Value(0)
            .ItemID("MalekIDChange"),
        X.Hidden()
            .ItemID("fldCarId")
            .Value(0),
        X.Hidden()
            .ItemID("PosIPId")
            .Value(0),
        X.Hidden()
            .ItemID("yearoftax")
            .Value(0),
        X.Hidden()
            .ItemID("FinallPrice")
                .Value(0),
            X.Hidden()
                    .ItemID("KhodEzhari")
                .Value(0),
            
        X.Panel()
            .Border(false)
            .ID("pnlLow" + (string)ViewBag.CarFileId)
            //.BodyStyle("background-color:red;")
            .Listeners(l => l.Render.Handler = "Ext.getCmp('pnlLow" + (string)ViewBag.CarFileId + "').setSize((App.AvarezWin.width)-14,(App.AvarezWin.height)-121);")
            .Layout(LayoutType.HBox)
            .AutoScroll(true)
            .Margin(1)
            .Items(
                X.Panel()
                    .Border(false)
                    .Width(260)
                    .Margin(1)
                    .Layout(LayoutType.VBox)
                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Right })
                    .Items(
                        X.Panel()
                            .Border(false)
                            .Layout(LayoutType.Fit)
                            .Items(
                                X.Container()
                                    .Listeners(l => l.AfterRender.Handler = "LoadDetails();")
                                    .Content(@<table style="width: 140px;height: 170px;">
                                        <tr>
                                            <td colspan="2" align="center">
                                                <img src="@Url.Content("/Content/kartMashins.jpg")" width="250px" />
                                                <span id='"KName"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 13px; height: 20px; top: 42px; position: absolute; right: 100px;"></span>
                                                <span id='"KCode"@ViewBag.CarFileId' style="font-family: Tahoma; height: 20px; top: 69px; position: absolute; right: 103px;"></span>
                                                <span id='"KVIN"@ViewBag.CarFileId' style="font-family: Tahoma; height: 20px; top: 97px; position: absolute; left: 44px;"></span>
                                                <span id='"KPelak1"@ViewBag.CarFileId' style="font-family: Tahoma; font-weight: bold; height: 20px; top: 127px; position: absolute; right: 48px;"></span>
                                                <span id='"KPelak2"@ViewBag.CarFileId' style="font-family: Tahoma; font-weight: bold; font-size: larger; height: 20px; top: 141px; position: absolute; right: 48px;"></span>
                                                <span id='"KPelak3"@ViewBag.CarFileId' style="font-family: Tahoma; font-weight: bold; font-size: medium; height: 20px; top: 133px; position: absolute; right: 74px;"></span>
                                            </td>
                                        </tr>
                                    </table>)),
                        X.Panel()
                            .Border(false)
                            .Items(
                                X.Container()
                                    .Content(@<table style="width: 140px;height: 170px;">
                                        <tr>
                                            <td colspan="2" align="center">
                                                <img src="@Url.Content("/Content/kartMashins2.jpg")" width="250px" />
                                                <span id='"KNo"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 14px; position: absolute; right: 68px; "></span>
                                                <span id='"KSystem"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 29px; position: absolute; right: 74px; "></span>
                                                <span id='"KTip"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 44px; position: absolute; right: 65px; "></span>
                                                <span id='"KRang"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 57px; position: absolute; right: 70px; "></span>
                                                <span id='"KModel"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 72px; position: absolute; right: 68px; "></span>
                                                <span id='"KSukht"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 83px; position: absolute; right: 86px; "></span>
                                                <span id='"KTedad"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 102px; position: absolute; right: 114px; "></span>
                                                <span id='"KMotor"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 115px; position: absolute; right: 87px; "></span>
                                                <span id='"KShasi"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 129px; position: absolute; right: 88px; "></span>
                                                <span id='"mobile"@ViewBag.CarFileId' style="font-family: Tahoma; font-size: 10px; height: 20px; top: 145px; position: absolute; right: 52px; ">موبایل:</span>

                                            </td>
                                        </tr>
                                    </table>)),
                        X.Panel()
                            .Border(false)
                            .Layout(Ext.Net.LayoutType.Accordion)
                            .LayoutConfig(new Ext.Net.AccordionLayoutConfig { OriginalHeader = true, Multi = false })
                            .PaddingSpec("0 3px 0 0")
                            .ID("AccordionPnl" + (string)ViewBag.CarFileId)
                            .Listeners(l => l.Render.Handler = "Ext.getCmp('AccordionPnl" + (string)ViewBag.CarFileId + "').setHeight((App.AvarezWin.height)-467);")
                            .Width(255)
                            .Items(
                                X.Panel()
                                    .Layout(LayoutType.Fit)
                                    .Title("عملیات")
                                    .IconCls("Actions")
                                    .Frame(true)
                                    .Items(
                                        X.MenuPanel()
                                            .Border(false)
                                            .Region(Region.West)
                                            .Menu(m =>
                                            {
                                                m.Add(X.MenuItem()
                                                    .Text("ویرایش مشخصات خودرو")
                                                    .IconCls("VMoshakhasat")
                                                    .Listeners(l => l.Click.Handler = "ShowPnlEditCar();"));
                                                m.Add(X.MenuItem()
                                                    .Text("ویرایش اطلاعات مالک")
                                                    .IconCls("VTasavir")
                                                    .Listeners(l => l.Click.Handler = "EditMalek();"));
                                                m.Add(X.MenuItem()
                                                    .Text("تعویض مالک")
                                                    .IconCls("VMalek")
                                                    .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 300))
                                                    .Listeners(l => l.Click.Handler = "ShowPnlChangeMalek();"));
                                            })
                                        ),
                                X.Panel()
                                    .Title("راهنماها")
                                    .Icon(Icon.Help)
                                    .Layout(LayoutType.Fit)
                                    .Frame(true)
                                    .Items(
                                        X.MenuPanel()
                                            .Border(false)
                                            .Region(Region.West)
                                            .Menu(m =>
                                            {
                                                m.Add(X.MenuItem()
                                                    .Text("راهنمای کامل Html")
                                                    .Icon(Ext.Net.Icon.Help)
                                                    .Listeners(l => l.Click.Handler = "HelpHtml();")
                                                    );
                                                m.Add(X.MenuItem()
                                                    .Text("راهنمای کامل Pdf")
                                                    .Icon(Ext.Net.Icon.Help)
                                                    .Listeners(l => l.Click.Handler = "DownloadHelpPdf();")
                                                    );
                                                m.Add(X.MenuItem()
                                                    .Text("فیلم آموزشی")
                                                    .Icon(Ext.Net.Icon.Help)
                                                    .Listeners(l => l.Click.Handler = "DownloadHelpVideo();")
                                                    );
                                            })
                                        )
                                    )
                                ),
                X.Panel()
                    .ID("MenuPanel" + (string)ViewBag.CarFileId)
                    .Listeners(l => l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').setSize(App.AvarezWin.width-287,App.AvarezWin.height-132);")
                    .Border(false)
                    //.BodyStyle("background-color:red;")
                    .Margin(5)
                    .Defaults(new { Margin = 2 })
                    //.AutoScroll(true)
                    .Items(
                        X.Panel()
                            .ID("PnlKoli" + (string)ViewBag.CarFileId)
                            .BodyStyle("background-color:#dfe8f6;")
                            //.BodyStyle("background-color:yellow;")
                            .Border(false)
                            .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').setWidth(App.AvarezWin.width-292);")
                            .Listeners(l => l.AfterRender.Fn = "addKeyMapSelectParvande")
                            .Layout(LayoutType.VBox)
                            .LayoutConfig(new Ext.Net.VBoxLayoutConfig { Align = VBoxAlign.Stretch })
                            .Defaults(new { Margin = 2 })
                            .AutoScroll(true)
                            .Items(
                                X.FormPanel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforSavabegh")
                                    .Title("ثبت سوابق")
                                    .Layout(LayoutType.VBox)
                                    //.AutoScroll(true)
                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                    .Border(true)
                                    .Items(
                                        X.Hidden()
                                            .ItemID("fldIdSavabegh")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldFileIdSavabegh")
                                            .Value(0),
                                        X.FieldSet()
                                            .Title("مشخصات سوابق")
                                            .ItemID("fieldsetforSavabegh")
                                            .AutoScroll(true)
                                            .Defaults(new { Margin = 2 })
                                            .Height(79)
                                            .Layout(LayoutType.Table)
                                            .LayoutConfig(new TableLayoutConfig { Columns = 6 })
                                            .Items(
                                                X.Label("استان:"),
                                                X.ComboBox()
                                                    .ItemID("cboState")
                                                    .TypeAhead(true)
                                                    //.AutoFocus(true)
                                                    .ForceSelection(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("fldName")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا استان را انتخاب نمایید.")
                                                    .ValueField("fldID")
                                                    .EmptyText("استان...")
                                                    .Width(170)
                                                    .Listeners(ls => ls.Select.Handler = "loadCboMun()")
                                                    .Store(X.Store()
                                                        .Model(X.Model()
                                                            .IDProperty("fldID")
                                                            .Fields(
                                                                new ModelField("fldID", ModelFieldType.String) { Mapping = "fldID" },
                                                                new ModelField("fldName", ModelFieldType.String) { Mapping = "fldName" }
                                                                )
                                                            )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetCascadeState"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                            )
                                                        ),
                                                X.Label("شهرداری:"),
                                                X.ComboBox()
                                                    .ForceSelection(true)
                                                    .ItemID("cboMun")
                                                    .IndicatorIcon(Icon.Zoom)
                                                    .IndicatorTip("جستجوی شهرداری")
                                                    .Listeners(l => l.IndicatorIconClick.Handler = "SearchMun(1)")
                                                    .EmptyText("شهرداری...")
                                                    .TypeAhead(true)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شهرداری را انتخاب نمایید.")
                                                    .QueryMode(DataLoadMode.Local)
                                                    .ForceSelection(true)
                                                    .Width(188)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("fldName")
                                                    .ValueField("fldID")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldID")
                                                            .Fields(
                                                                new ModelField("fldID", ModelFieldType.String) { Mapping = "fldID" },
                                                                new ModelField("fldName", ModelFieldType.String) { Mapping = "fldName" })
                                                            )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetCascadeCounty"))
                                                            .Reader(X.JsonReader().Root("data")))
                                                        ),
                                                X.Label("از سال:"),
                                                X.ComboBox()
                                                    .ItemID("CboAzSal")
                                                    .Editable(false)
                                                    .TypeAhead(true)
                                                    .BlankText("لطفا از سال را انتخاب نمایید.")
                                                    .QueryMode(DataLoadMode.Local)
                                                    .TriggerAction(TriggerAction.All)
                                                    .AllowBlank(false)
                                                    .DisplayField("fldName")
                                                    .ValueField("fldID")
                                                    .Width(170)
                                                    .EmptyText("از سال...")
                                                    .Listeners(l => l.Select.Handler = "loadCboTaSal()")
                                                    .Store(X.Store()
                                                        .Model(X.Model()
                                                            .IDProperty("fldID")
                                                            .Fields(
                                                                new ModelField("fldID", ModelFieldType.String) { Mapping = "fldID" },
                                                                new ModelField("fldName", ModelFieldType.String) { Mapping = "fldName" }
                                                            )
                                                        )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetSal"))
                                                            .Reader(X.JsonReader().Root("data")))
                                                        .Parameters(ps => ps.Add(new StoreParameter("CarFileId", ViewBag.CarFileId, ParameterMode.Raw)))
                                                        ),
                                                X.Label("تا سال:"),
                                                X.ComboBox()
                                                    .ItemID("CboTaSal")
                                                    .Editable(false)
                                                    .TypeAhead(true)
                                                    .BlankText("لطفا تا سال را انتخاب نمایید.")
                                                    .QueryMode(DataLoadMode.Local)
                                                    .TriggerAction(TriggerAction.All)
                                                    .AllowBlank(false)
                                                    .DisplayField("fldSalP")
                                                    .ValueField("fldSalP")
                                                    .Width(170)
                                                    .EmptyText("تا سال...")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldSalP")
                                                            .Fields(
                                                                new ModelField("fldSalP", ModelFieldType.String) { Mapping = "fldSal" }
                                                                )
                                                            )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetSal2"))
                                                            .Reader(X.JsonReader().Root("data")))
                                                        ),
                                                X.Label("شماره نامه:"),
                                                X.TextField()
                                                    .EnforceMaxLength(true)
                                                    .MaxLength(25)
                                                    .Width(170)
                                                    .ItemID("txtShName")
                                                    .ReadOnly(false)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شماره نامه را وارد نمایید."),
                                                X.Label("توضیحات:"),
                                                X.TextField()
                                                    .Width(170)
                                                    .AutoScroll(true)
                                                    .ItemID("txtDesc")
                                                    .ColSpan(3)
                                            ),
                                        X.FieldSet()
                                            .Border(true)
                                            .Defaults(new { Margin = 2 })
                                            .Layout(LayoutType.HBox)
                                            //.Hidden(!(bool)ExpScan)
                                            .ItemID("pnlUpload")
                                            .Height(50)
                                            .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('pnlUpload').setWidth(Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldsetforSavabegh').getWidth());")
                                            .Title("آپلود فایل مدرک(حداکثر 700KB)")
                                            .Items(
                                                X.Label("تصویر مدرک:"),
                                                    //.Hidden(!(bool)ForceScan),
                                                X.FileUploadField()
                                                    //.Hidden(!(bool)ForceScan)
                                                    .ItemID("FileUploadSavabegh")
                                                    .ButtonOnly(true)
                                                    .Icon(Icon.Attach)
                                                    .ButtonText("انتخاب فایل")
                                                    .DirectEvents(l =>
                                                    {
                                                        l.Change.Action = "UploadSavabegh";
                                                        l.Change.Success = "hideprogressSavabegh();";
                                                    })
                                                    .Listeners(l => l.Change.Fn = "showFileSavabegh"),
                                                X.Container()
                                                    .Hidden(!(bool)ExpScan)
                                                    .Content(@<center><div id='"fi-button-msg"@ViewBag.CarFileId' style="display:none; width:300px;height:25px"></div></center>)),
                                        X.Button()
                                            .Text("ذخیره")
                                            .ItemID("SaveSavabegh")
                                            .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 243))
                                            .Icon(Ext.Net.Icon.Disk)
                                            .Margin(5)
                                            .MinWidth(80)
        //.ToolTip("کلید میانبر F8")
                                            .Listeners(l => l.Click.Handler = "SaveEnteghalSavabegh()")
                                            ),
                                X.FormPanel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .ItemID("pnlforVarizi")
                                    .AutoScroll(true)
                                    .Hidden(true)
                                    .Title("ثبت واریزی")
                                    .Layout(LayoutType.VBox)
                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                    .Border(true)
                                    .Items(
                                        X.Hidden()
                                            .ItemID("fldIdVarizi")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldFileIdVarizi")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldIdMunVarizi")
                                            .Value(0),
                                        X.FieldSet()
                                            .Title("مشخصات فیش")
                                            .ItemID("fieldsetforVarizi")
                                            .AutoScroll(true)
                                            .Defaults(new { Margin = 2 })
                                            .Height(128)
                                            .Layout(LayoutType.Table)
                                            .LayoutConfig(new TableLayoutConfig { Columns = 6 })
                                            .Items(
                                                X.FieldSet()
                                                    .Border(false)
                                                    .ItemID("fieldsettext")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldsettext').setWidth(Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldsetforVarizi').getWidth()-90);")
                                                    .ColSpan(6)
                                                    .MarginSpec("-5px 0 0 0")
                                                    .Layout(LayoutType.VBox)
                                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                                    .Items(
                                                        X.TextField()
                                                            .ReadOnly(true)
                                                            .Center()
                                                            .Value("<<لطفا پس از وارد کردن سریال قبض، کلید Enter صفحه کلید خود را بفشارید.>>")
                                                            .ItemID("text")
                                                            .FieldStyle("background-image:none;border-width:0px;background-color:#dfe8f6;color:red;")
                                                            .Width(410)),
                                                X.Label("تاریخ واریز:"),
                                                X.PDateField()
                                                    .ItemID("txtDateVariz")
                                                    .AllowBlank(false)
                                                    .Width(170)
                                                    .BlankText("لطفا تاریخ واریز را وارد نمایید.")
                                                    .Editable(true),
                                                    //.Listeners(l => l.Render.Handler = "SetDate()"),
                                                X.Label("نحوه پرداخت:"),
                                                X.ComboBox()
                                                    .ItemID("cboNoePardakht")
                                                    .Width(170)
                                                    .AllowBlank(false)
                                                    .Listeners(l =>
                                                    {
                                                        l.Select.Handler = "showhideItems()";
                                                        l.Render.Handler = "manage()";
                                                    })
                                                    .BlankText("لطفاً نحوه پرداخت فیش را انتخاب نمایید.")
                                                    .Editable(false)
                                                    .SelectedItems(new { value = "1" })
                                                    .Items(
                                                        X.ListItem()
                                                            .Text("عادی")
                                                            .Value("1"),
                                                        X.ListItem()
                                                            .Text("علی الحساب")
                                                            .Value("2")),
                                                X.Label("سریال قبض:")
                                                    .ItemID("lblSerial"),
                                                X.TextField()
                                                    .ItemID("txtSerial")
                                                    .Width(170)
                                                    //.AutoFocus(true)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا سریال قبض را وارد نمایید.")
                                                    .EnableKeyEvents(true)
                                                    .Listeners(l => l.KeyDown.Fn = "setPrice"),
                                                X.Label("شهرداری:")
                                                    .ItemID("lblMun"),
                                                X.TextField()
                                                    .ItemID("txtMun")
                                                    .AllowBlank(false)
                                                    .Width(188)
                                                    .BlankText("لطفا یک شهرداری را انتخاب نمایید.")
                                                    .ReadOnly(true)
                                                    .EmptyText("روی آیکن کلیک نمایید.")
                                                    .IndicatorIcon(Icon.Zoom)
                                                    .IndicatorTip("جستجوی شهرداری")
                                                    .Listeners(l => l.IndicatorIconClick.Handler = "SearchMun(2)"),
                                                X.Label("سریال قبض:")
                                                    .ItemID("lblSerialFish"),
                                                X.TextField()
                                                    .ItemID("txtSerialFish")
                                                    .Width(170)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا سریال قبض را وارد نمایید."),
                                                X.Label("نوع واریز:"),
                                                X.ComboBox()
                                                    .ItemID("CboNoeVariz")
                                                    .Width(170)
                                                    .TypeAhead(true)
                                                    .ForceSelection(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا نوع واریز را انتخاب نمایید")
                                                    .Store(
                                                        X.Store()
                                                            .Listeners(l => l.Load.Handler = "setDefaultCboNoeVariz()")
                                                            .Model(X.Model()
                                                                .IDProperty("ID")
                                                                .Fields(
                                                                    new ModelField("ID", ModelFieldType.String) { Mapping = "SettleTypeID" },
                                                                    new ModelField("Name", ModelFieldType.String) { Mapping = "SettleTypeName" }))
                                                            .Proxy(X.AjaxProxy()
                                                                .Url(Url.Action("GetSettleType"))
                                                            .Reader(X.JsonReader().Root("data")))
                                                ),
                                                X.Label("مبلغ واریزی:")
                                                    .ItemID("lblPrice"),
                                                X.TextField()
                                                    .ItemID("txtPrice")
                                                    .Width(170)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا مبلغ واریزی را وارد نمایید.")
                                                    .Listeners(l => l.Change.Handler = "formatMoney()")
                                                    .ReadOnly(true),
                                                X.Label("سریال برچسب:"),
                                                X.TextField()
                                                    .Width(170)
                                                    .ItemID("txtSerialLable"),
                                                X.Label("توضیحات:"),
                                                X.TextField()
                                                    .ItemID("txtDescV")
                                                    .Width(170)
                                            ),
                                        X.FieldSet()
                                            .Border(true)
                                            .Defaults(new { Margin = 2 })
                                            .Layout(LayoutType.HBox)
                                            .ItemID("pnlUploadVarizi")
                                            .Height(50)
                                            .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('pnlUploadVarizi').setWidth(Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldsetforVarizi').getWidth());")
                                            .Title("آپلود فایل مدرک(حداکثر 700KB)")
                                            .Items(
                                                X.Label("تصویر مدرک:"),
                                                X.FileUploadField()
                                                    .ItemID("FileUploadVarizi")
                                                    .ButtonOnly(true)
                                                    .Icon(Icon.Attach)
                                                    .ButtonText("انتخاب فایل")
                                                    .DirectEvents(l =>
                                                    {
                                                        l.Change.Action = "UploadVarizi";
                                                        l.Change.Success = "hideprogressVarizi();";
                                                    })
                                                    .Listeners(l => l.Change.Fn = "showFileVarizi"),
                                                X.Container()
                                                    .Content(@<center><div id='"fi-button-msgvariz"@ViewBag.CarFileId' style="display:none; width:300px;height:25px"></div></center>)),
                                        X.Button()
                                            .Text("ذخیره")
                                            .ItemID("SaveVarizi")
                                            .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 291))
                                            .Icon(Ext.Net.Icon.Disk)
                                            .Margin(5)
                                            .MinWidth(80)
        //.ToolTip("کلید میانبر F8")
                                            .Listeners(l => l.Click.Handler = "SaveVarizi()")
                            ),
                                X.FormPanel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforBlackList")
                                    //.AutoScroll(true)
                                    .Title("لیست سیاه")
                                    .Layout(LayoutType.VBox)
                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                    .Border(true)
                                    .Items(
                                        X.Hidden()
                                            .ItemID("fldIdBlackList")
                                            .Value(0),
                                        X.FieldSet()
                                            .Title("مشخصات")
                                            .ItemID("fieldsetforBlackList")
                                            .Height(115)
                                            .Layout(LayoutType.Table)
                                            .LayoutConfig(new TableLayoutConfig { Columns = 2 })
                                            .Defaults(new { Margin = 2 })
                                            .Items(
                                                X.Label("نوع محدودیت:"),
                                                X.ComboBox()
                                                    .ItemID("cboType")
                                                    .ForceSelection(true)
                                                    .Width(170)
                                                    //.AutoFocus(true)
                                                    .TypeAhead(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .TriggerAction(TriggerAction.All)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا نوع محدودیت را انتخاب نمایید.")
                                                    .Items(
                                                        new ListItem("جلوگیری از انجام هر کاری", "1"),
                                                        new ListItem("جلوگیری از صدور فیش", "2")
                                                        ),
                                                X.Label("پیغام:"),
                                                X.TextArea()
                                                    .ItemID("txtMsg")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا پیغام را وارد نمایید.")
                                                    .Width(400)
                                            ),
                                        X.Button()
                                            .Text("ذخیره")
                                            .ItemID("SaveBlackList")
                                            .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 309))
                                            .Icon(Ext.Net.Icon.Disk)
                                            .Margin(5)
                                            .MinWidth(80)
        //.ToolTip("کلید میانبر F8")
                                            .Listeners(l => l.Click.Handler = "SaveBlackList()")),
                                X.Panel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforEditCar")
                                    .Title("ویرایش مشخصات خودرو")
                                    .AutoScroll(true)
                                    .IconCls("VMoshakhasat")
                                    .Layout(LayoutType.VBox)
                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                    .Border(true)
                                    .Items(
                                        /*X.Hidden()
                                            .ItemID("fldIdCarFile")
                                            .Value(0),*/
                                        X.Hidden()
                                            .ItemID("fldPlaqueTypeName")
                                            .Value(""),
                                        X.FieldSet()
                                            .Title("مشخصات خودرو")
                                            .ItemID("fieldsetforEditCar")
                                            .Height(130)
                                            .Layout(LayoutType.Table)
                                            .LayoutConfig(new TableLayoutConfig { Columns = 8 })
                                            .Defaults(new { Margin = 2 })
                                            .Items(
                                                X.Label("نوع پلاک:"),
                                                X.ComboBox()
                                                    .ItemID("CboPelakTypeEntezami")
                                                    .TypeAhead(true)
                                                    .Editable(false)
                                                    .AllowBlank(false)
                                                    .Width(170)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا نوع پلاک را انتخاب نمایید.")
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("نوع پلاک")
                                                    .Items(
                                                        new ListItem("پلاک انتظامی", "0"),
                                                        new ListItem("سایر", "1")
                                                            )
                                                    .SelectedItems(new { Value = "0" })
                                                    .Listeners(l => l.Select.Handler = "ChangeCboPelakTypeEn();"),
                                                X.Label("نوع ساخت:"),
                                                X.ComboBox()
                                                    //.AutoFocus(true)
                                                    .Width(170)
                                                    .ItemID("cboCarMakeNew")
                                                    .TypeAhead(true)
                                                    .Editable(false)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا نوع ساخت را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(ls => ls.Select.Handler = "loadAccountTypes()")
                                                    .Store(X.Store()
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                )
                                                            )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetMake"))
                                                            .Reader(X.JsonReader().Root("data")))
                                                        //.Listeners(li => li.Load.Handler = "LoadPropertyCar();")
                                                        ),
                                                X.Label("نوع کاربری:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboCarAccountTypes")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا نوع کاربری را انتخاب نمایید..")
                                                    .AllowBlank(false)
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(li => li.Select.Handler = "loadCboCarCabin()")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    ))
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetAccount"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("نوع کابین:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboCarCabin")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا نوع کابین را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(ls => ls.Select.Handler = "loadCboSystem()")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    )
                                                                )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetCabin"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("سیستم خودرو:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboSystem")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .AllowBlank(false)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا سیستم خودرو را انتخاب نمایید.")
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(ls => ls.Select.Handler = "loadCboModel()")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                )
                                                                )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetSystem"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("تیپ خودرو:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboModel")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا تیپ خودرو را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(ls => ls.Select.Handler = "loadCboClass()")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    ))
                                                            .Proxy(X.AjaxProxy()
                                                                .Url(Url.Action("GetModel"))
                                                                .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("کلاس خودرو:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboClass")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا کلاس خودرو را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    )
                                                                    )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetClass"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("شماره موتور:"),
                                                X.TextField()
                                                    .ItemID("txtMotor")
                                                    .FieldStyle("direction:ltr;")
                                                    .Listeners(l => l.Change.Handler = "setUpperCase('txtMotor')")
                                                    .EnforceMaxLength(true)
                                                    .MaxLength(50)
                                                    .Width(170)
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شماره موتور را وارد نمایید."),
                                                X.Label("شماره شاسی:"),
                                                X.TextField()
                                                    .FieldStyle("direction:ltr;")
                                                    .ItemID("txtShasi")
                                                    .EnforceMaxLength(true)
                                                    .EnableKeyEvents(true)
                                                    .Listeners(l=>l.KeyDown.Fn="setCharShasiVIN")
                                                    .MaxLength(50)
                                                    .Width(170)
                                                    .Listeners(l => l.Change.Handler = "setUpperCase('txtShasi')")
                                                    .AllowBlank(false)
                                                    .BlankText("لطفا شماره شاسی را وارد نمایید."),
                                                X.Label("رنگ خودرو:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboColor")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .ForceSelection(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا رنگ خودرو را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Store(X.Store()
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    )
                                                                    )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetColor"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("سال تولید:"),
                                                X.ComboBox()
                                                    .Width(170)
                                                    .ItemID("cboYear")
                                                    .TypeAhead(true)
                                                    .Editable(true)
                                                    .QueryMode(DataLoadMode.Local)
                                                    .BlankText("لطفا سال تولید را انتخاب نمایید.")
                                                    .AllowBlank(false)
                                                    .ForceSelection(true)
                                                    .TriggerAction(TriggerAction.All)
                                                    .DisplayField("Name")
                                                    .ValueField("ID")
                                                    .EmptyText("...")
                                                    .Listeners(l => l.Select.Handler = "ChangeYear();")
                                                    .Store(X.Store()
                                                        .AutoLoad(false)
                                                        .Model(X.Model()
                                                            .IDProperty("fldId")
                                                            .Fields(
                                                                new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                    )
                                                                    )
                                                        .Proxy(X.AjaxProxy()
                                                            .Url(Url.Action("GetYear"))
                                                            .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                ),
                                                X.Label("تاریخ سند کارخانه:"),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .PaddingSpec("0 0 0 0")
                                                    .Layout(LayoutType.HBox)
                                                    .Defaults(new { Margin = 1 })
                                                    .Items(
                                                        X.TextField()
                                                            .ItemID("txtDateD")
                                                            .MaskRe("[0-9]")
                                                            .MinLength(2)
                                                            .MaxLength(2)
                                                            .EnforceMaxLength(true)
                                                            .Listeners(l => l.Change.Handler = "checkDay2('txtDateD')")
                                                            .Width(30)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا روز سند کارخانه را وارد نمایید."),
                                                        X.Label()
                                                            .Text("/")
                                                            .ItemID("lblDate5"),
                                                        X.TextField()
                                                            .ItemID("txtDateM")
                                                            .Listeners(l => l.Change.Handler = "checkMonth2('txtDateM')")
                                                            .MaskRe("[0-9]")
                                                            .MinLength(2)
                                                            .MaxLength(2)
                                                            .EnforceMaxLength(true)
                                                            .LabelSeparator(" ")
                                                            .Width(30)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا ماه سند کارخانه را وارد نمایید."),
                                                        X.Label()
                                                            .Text("/")
                                                            .ItemID("lblDate6"),
                                                        X.ComboBox()
                                                            //.MsgTarget(Ext.Net.MessageTarget.Side)
                                                            .Width(60)
                                                            .ItemID("txtDateY")
                                                            .TypeAhead(true)
                                                            .Editable(true)
                                                            .QueryMode(DataLoadMode.Local)
                                                            .BlankText("لطفا سال سند کارخانه را انتخاب نمایید.")
                                                            .ForceSelection(true)
                                                            .TriggerAction(TriggerAction.All)
                                                            .DisplayField("Name")
                                                            .ValueField("ID")
                                                            .EmptyText("...")
                                                            .Store(X.Store()
                                                                .AutoLoad(false)
                                                                .Model(X.Model()
                                                                    .IDProperty("fldId")
                                                                    .Fields(
                                                                        new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                        new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                        )
                                                                    )
                                                                .Proxy(X.AjaxProxy()
                                                                    .Url(Url.Action("GetFillDate"))
                                                                    .Reader(X.JsonReader().Root("data"))
                                                                    )
                                                                //.Parameters(ps => ps.Add(new StoreParameter("year", "App.NewParvandeKhodro.queryById('cboYear').getValue()", ParameterMode.Raw)))
                                                                        )
                                                            .AllowBlank(false)
                                                        /*X.TextField()
                                                            .ItemID("txtDateY")
                                                            .LabelSeparator(" ")
                                                            .ReadOnly(true)
                                                            .BlankText("لطفا سال سند کارخانه را وارد نمایید.")
                                                            .Width(50)
                                                            .AllowBlank(false)*/
                                                        ),
                                                X.Label("VIN:"),
                                                X.FieldSet()
                                                    .PaddingSpec("0 0 0 0")
                                                    .ItemID("fieldset5")                                                    
                                                    .Border(false)
                                                    .ColSpan(2)
                                                    .Layout(LayoutType.HBox)
                                                    .Defaults(new { Margin = 1 })
                                                    .Items(
                                                        X.TextField()
                                                            .ItemID("txtVinMatchShasi")
                                                            .FieldStyle("direction:ltr;")
                                                            .Width(170)
                                                    ),
                                                X.FieldSet()
                                                    .PaddingSpec("0 0 0 0")
                                                    .Border(false)
                                                    .ItemID("fieldset6")
                                                    .ColSpan(2)
                                                    .Layout(LayoutType.HBox)
                                                    .Defaults(new { Margin = 1 })
                                                    .Items(
                                                        X.TextField()
                                                            .ItemID("_charShasi")
                                                            .Width(55)
                                                            .MaxLength(6)
                                                            .MinLength(6)
                                                            .EnforceMaxLength(true)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا VIN را وارد نمایید."),
                                                            //.ReadOnly(true),
                                                        X.TextField()
                                                            .MaxLength(5)
                                                            .EnforceMaxLength(true)
                                                            .ItemID("_5char")
                                                            .FieldStyle("direction:ltr;")
                                                            .Listeners(l => l.Change.Handler = "Change_5char()")
                                                            .Width(50)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا VIN را وارد نمایید."),
                                                        X.TextField()
                                                            .MaxLength(2)
                                                            .EnforceMaxLength(true)
                                                            .MinLength(2)
                                                            //.MaskRe("[0-9]")
                                                            .ItemID("_charModel")
                                                            .FieldStyle("direction:ltr;")
                                                            .Width(25)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا VIN را وارد نمایید."),
                                                        X.TextField()
                                                            .MaxLength(2)
                                                            .EnforceMaxLength(true)
                                                            .ItemID("_2char")
                                                            .Width(25)
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا VIN را وارد نمایید.")
                                                            .Listeners(l => l.Change.Handler = "Change_2char()"),
                                                        X.ComboBox()
                                                            .Width(45)
                                                            .ItemID("cboShort")
                                                            .TypeAhead(true)
                                                            .Editable(true)
                                                            .QueryMode(DataLoadMode.Local)
                                                            .BlankText("لطفا کشور سازنده را انتخاب نمایید.")
                                                            .AllowBlank(false)
                                                            .ForceSelection(true)
                                                            .TriggerAction(TriggerAction.All)
                                                            .DisplayField("Name")
                                                            .Listeners(l => l.Select.Handler = "ChangeShort();")
                                                            .ValueField("ID")
                                                            .EmptyText("...")
                                                            .Store(X.Store()
                                                                .AutoLoad(false)
                                                                .Listeners(l => l.Load.Handler = "setCboShort()")
                                                                .Model(X.Model()
                                                                    .IDProperty("fldId")
                                                                    .Fields(
                                                                        new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                        new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                            )
                                                                            )
                                                                .Proxy(X.AjaxProxy()
                                                                    .Url(Url.Action("GetShort"))
                                                                    .Reader(X.JsonReader().Root("data"))
                                                                            )
                                                                        ),
                                                        X.Image()
                                                            .ItemID("Image")
                                                            .PaddingSpec("2px 0 0 0")
                                                            .ImageUrl("/Content/Blue.jpg")
                                                            .Width(20)
                                                            .Height(20)
                                                            .Border(false)
                                        ),
                                        X.FieldSet()
                                            .Border(false)
                                            .Layout(LayoutType.HBox)
                                            .Margin(0)
                                            .Items(
                                        X.Label("مطابق با شاسی").ItemID("lblCheck"),
                                        X.Checkbox()
                                            //.MarginSpec("0 0 0 -10px")
                                            .ItemID("checkbox1")//.ColSpan(6)
                                            .Listeners(l => l.Change.Fn = "setVINshasi"))
                                            ),
                                        X.Button()
                                            .Text("ذخیره")
                                            .ItemID("SavePropertyCar")
                                            .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 238))
                                            .Icon(Ext.Net.Icon.Disk)
                                            .MinWidth(80)
                                            .MarginSpec("0 0 2px 0")
                                            //.ToolTip("کلید میانبر F8")
                                            .Listeners(l => l.Click.Handler = "SavePropertyCar()")),
                                X.Panel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforChangeOwner")
                                    //.AutoScroll(true)
                                    .Title("تعویض مالک")
                                    .IconCls("VMalek")
                                    .Border(true)
                                    .LayoutConfig(new VBoxLayoutConfig { Align=VBoxAlign.Center})
                                    .Items(
                                        X.Hidden()
                                            .ItemID("carPlaqueIdChangeMalek"),
                                        X.FieldSet()
                                            .Title("مشخصات مالک")
                                            //.MarginSpec("0 20px 5px 20px")
                                            .Layout(LayoutType.VBox)
                                            .ItemID("FieldsetOwner")
                                            .AutoScroll(true)
                                            .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('FieldsetOwner').setWidth(App.AvarezWin.width-336)")
                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center})
                                            .Items(
                                                X.FieldSet()
                                                    .Border(false)
                                                    .PaddingSpec("0 0 0 0")
                                                    .Layout(LayoutType.HBox)
                                                    .Items(
                                                        X.Label("نوع مالکیت:")
                                                            .Cls("boldCaption"),
                                                        X.ComboBox()
                                                            .ItemID("cboTypeOwner")
                                                            .Editable(false)
                                                            .TypeAhead(true)
                                                            .Width(188)
                                                            .QueryMode(DataLoadMode.Local)
                                                            .TriggerAction(TriggerAction.All)
                                                            .SelectedItems(new { Value = "1" })
                                                            .Items(
                                                                new ListItem("حقیقی", "1"),
                                                                new ListItem("حقوقی", "0"), 
                                                                new ListItem("اتباع غیرایرانی", "2")
                                                                )
                                                            .Listeners(l => { 
                                                                l.Select.Handler = "ChangeCboTypeOwner()";
                                                            }),
                                                        X.Label("کــــد مـــلـی:")
                                                            .ItemID("lblNationalCode")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 59px"),
                                                        X.TextField()
                                                            .ItemID("txtNationalCodeAtba")
                                                            .Hidden(true)
                                                            .FieldStyle("direction:ltr;")
                                                            .Listeners(l =>
                                                            {
                                                                l.Blur.Handler = "checkOwnerAtba()";
                                                            })
                                                            .AllowBlank(false)
                                                            .BlankText("لطفا کد/شناسه ملی را وارد نمایید.")
                                                            .Width(188),
                                                        X.TextField()
                                                            .ItemID("txtNationalCode")                                                            
                                                            .FieldStyle("direction:ltr;")
                                                            .Listeners(l => {
                                                                l.Render.Handler = "setMaxMinValid()";                                                               
                                                            })
                                                            .EnforceMaxLength(true)
                                                            .AllowBlank(false)
                                                            .MaskRe("[0-9]")
                                                            .BlankText("لطفا کد/شناسه ملی را وارد نمایید.")
                                                            .Width(188)
                                                            .Listeners(l => l.Change.Handler = "GetPelak()"),
                                                        X.Button()
                                                            .Icon(Icon.Add)
                                                            .ToolTip("ثبت مالک جدید")
                                                            .Disabled(true)
                                                            .ItemID("btnNewOwner")
                                                            .Listeners(l => l.Click.Handler = "GotoNewMalek_Pelak()")
                                                            .Flat(true),
                                                        X.Button()
                                                            .Icon(Icon.Pencil)
                                                            .ToolTip("ویرایش مالک")
                                                            .Disabled(true)
                                                            .ItemID("btnEditOwner")
                                                            .Listeners(l => l.Click.Handler = "GotoEditMalek_Pelak()")
                                                            .Flat(true),
                                                         X.Label()
                                                            .Text("شماره پلاک:")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 75px"),
                                                        X.ComboBox()
                                                            .ItemID("CboSh_Pelak")
                                                            .Width(188)
                                                            .TypeAhead(true)
                                                            .Editable(false)
                                                            .Disabled(true)
                                                            .QueryMode(DataLoadMode.Local)
                                                            .Selectable(true)
                                                            .Listeners(l => l.Select.Handler = "ChangeCboPlaqueOwner()")
                                                            .BlankText("لطفا پلاک را انتخاب نمایید.")
                                                            .AllowBlank(false)
                                                            .TriggerAction(TriggerAction.All)
                                                            .DisplayField("Name")
                                                            .ValueField("ID")
                                                            .EmptyText("...")
                                                            .Store(X.Store()
                                                                .AutoLoad(false)
                                                                .Model(X.Model()
                                                                    .IDProperty("fldId")
                                                                    .Fields(
                                                                        new ModelField("ID", ModelFieldType.String) { Mapping = "ID" },
                                                                        new ModelField("Name", ModelFieldType.String) { Mapping = "Name" }
                                                                            )
                                                                            )
                                                                .Proxy(X.AjaxProxy()
                                                                    .Url(Url.Action("GetPelakofOwner"))
                                                                    .Reader(X.JsonReader().Root("data"))
                                                                            )
                                                                        )
                                                    ),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .PaddingSpec("0 0 0 0")
                                                    .Layout(LayoutType.HBox)
                                                    .ItemID("fieldset1")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldset1').setWidth(App.AvarezWin.width-432)")
                                                    .Items(
                                                        X.Label()
                                                            .ItemID("lblNameOwner")
                                                            .Text("نــام مـالک:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtNameFamilyMalek")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("نوع ساخت: ")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 50px"),
                                                        X.Label()
                                                            .ItemID("txtNoeSakht")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("نوع کاربری:")
                                                            .PaddingSpec("0 0 0 116px")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtCarAccountTypes2")
                                                            .Cls("colorval")
                                                            .Width(195)
                                                    ),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .PaddingSpec("0 0 0 0")
                                                    .ItemID("fieldset2")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldset2').setWidth(App.AvarezWin.width-432)")
                                                    .Layout(LayoutType.HBox)
                                                    .Items(
                                                        X.Label()
                                                            .Text("نوع کابین:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtCarCabin2")
                                                            .Cls("colorval")
                                                            .Width(203),
                                                        X.Label()
                                                            .PaddingSpec("0 0 0 54px")
                                                            .Text("سیستم خودرو:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtSystem2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("تیپ خودرو:")
                                                            .PaddingSpec("0 0 0 98px")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtModel2")
                                                            .Cls("colorval")
                                                            .Width(190)
                                                    ),
                                                X.FieldSet()
                                                    .ItemID("fieldset3")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldset3').setWidth(App.AvarezWin.width-432)")
                                                    .PaddingSpec("0 0 0 0")
                                                    .Border(false)
                                                    .Layout(LayoutType.HBox)
                                                    .Items(
                                                        X.Label()
                                                            .Text("کلاس خودرو:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtClass2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("شماره موتور:")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 42px"),
                                                        X.Label()
                                                            .ItemID("txtMotor2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("شماره شاسی:")
                                                            .PaddingSpec("0 0 0 111px")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .Width(160)
                                                            .ItemID("txtShasi2")
                                                            .Cls("colorval")
                                                    ),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .Layout(LayoutType.HBox)
                                                    .ItemID("fieldset4")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldset4').setWidth(App.AvarezWin.width-432)")
                                                    .PaddingSpec("0 0 0 0")
                                                    .Items(
                                                        X.Label()
                                                            .Text("رنگ خودرو:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtColor2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("سال تولید:")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 53px"),
                                                        X.Label()
                                                            .ItemID("txtYear2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("تاریخ پلاک گذاری:")
                                                            .PaddingSpec("0 0 0 122px")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtDateP2")
                                                            .Cls("colorval")
                                                            .Width(162)
                                                    ),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .ItemID("fieldsetVIN")
                                                    .Layout(LayoutType.HBox)
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fieldsetVIN').setWidth(App.AvarezWin.width-432)")
                                                    .PaddingSpec("0 0 0 0")
                                                    .Items(
                                                        X.Label()
                                                            .Text("تاریخ اولین بیمه:")
                                                            .Cls("boldCaption"),
                                                        X.Label()
                                                            .ItemID("txtDate2")
                                                            .Cls("colorval")
                                                            .Width(200),
                                                        X.Label()
                                                            .Text("VIN:")
                                                            .Cls("boldCaption")
                                                            .PaddingSpec("0 0 0 27px"),
                                                        X.Label()
                                                            .ItemID("VIN2")
                                                            .Cls("lblP")
                                                            .Width(200)
                                                    )),
                                    X.FieldSet()
                                        .Border(false)
//.MarginSpec("0 20px 5px 20px")
                                        .ItemID("fielsetbtnChangeOwner")
                                        .Listeners(l => l.BoxReady.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('fielsetbtnChangeOwner').setWidth(Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('FieldsetOwner').getWidth());")
                                        .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                        .Items(
                                            X.Button()
                                            .Text("ثبت تعویض مالک")
                                                .ItemID("SaveChangeOwner")
                                                .Icon(Ext.Net.Icon.Disk)
                                                .Margin(5)
                                                .MinWidth(80)
//.ToolTip("کلید میانبر F8")
                                                .Listeners(l => l.Click.Handler = "SaveChangeOwner()")),
                                        X.GridPanel()
                                            .Title("پرونده های مرتبط با پلاک انتخاب شده")
                                            .AutoScroll(true)
                                            .MarginSpec("0 20px 5px 20px")
                                            .Listeners(l => l.ViewReady.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('GridChangeOwner').setSize(Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('FieldsetOwner').getWidth(),App.AvarezWin.height-402);")
                                            .ItemID("GridChangeOwner")
                                            .Border(true)
                                            .Store(
                                                X.StoreFor(Model.CarFileOwner)
                                                    .AutoLoad(false)
                                                    .Proxy(
                                                        Html.X().AjaxProxy()
                                                            .Url(Url.Action("ReadFilesofPelak"))
                                                            .Reader(Html.X().JsonReader().Root("data"))
                                                            )
                                                    .PageSize(2000)
                                                    .RemoteFilter(true)
                                                    .RemotePaging(true)
                                                )
                                            .ColumnModel(
                                                Html.X().RowNumbererColumn(),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldID).Text("کد").Flex(1).Hidden(true).Hideable(false),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldOwnerName).Text("نام مالک").Flex(5).Wrap(true),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldPlaqueNumber).Text("شماره پلاک").Flex(4),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldMotorNumber).Text("شماره موتور").Flex(4),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldVIN).Text("VIN").Flex(4),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldShasiNumber).Text("شماره شاسی").Flex(4),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldDesc).Text("توضیحات").Flex(6).Wrap(true),
                                                Html.X().Column().DataIndex(Model.CarFileOwner, m => m.fldCarID).Text("کد ماشین").Flex(1).Hidden(true).Hideable(false)
                                            )
                                        ),
                                X.FormPanel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforEditPictures")
                                    .Title("ویرایش تصاویر")
                                    .AutoScroll(true)
                                    .IconCls("VTasavir")
                                    .Layout(LayoutType.VBox)
                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('pnlforEditPictures').setHeight(App.AvarezWin.height-336);")
                                    .LayoutConfig(new VBoxLayoutConfig { Align=VBoxAlign.Center})
                                    .Border(true)
                                    .Items(
                                        X.Hidden()
                                            .ItemID("FileIdBarg")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("FileIdBackKart")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("FileIdKart")
                                           .Value(0),
                                        X.Hidden()
                                            .ItemID("FileIdSanad")
                                            .Value(0),
                                        X.FieldSet()
                                            .Title("تصاویر مدارک خودرو")
                                            .Listeners(l => l.Render.Handler = "Ext.getCmp('PnlKoli" + (string)ViewBag.CarFileId + "').queryById('FieldsetPictures').setWidth(App.AvarezWin.width-400);")
                                            .MarginSpec("0 20px 5px 20px")
                                            .Layout(LayoutType.VBox)
                                            .ItemID("FieldsetPictures")
                                            .AutoScroll(true)
                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                            .Items(
                                                X.FieldSet()
                                                    .Border(false)
                                                    .ItemID("fieldsetImg")
                                                    .Layout(LayoutType.Table)
                                                    .LayoutConfig(new TableLayoutConfig { Columns = 4 })
                                                    .Items(
                                                        X.Panel()
                                                            .Border(false)
                                                            .BodyStyle("background-color:transparent;")
                                                            .Layout(LayoutType.VBox)
                                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                                            .Items(
                                                                X.Image()
                                                                    .ItemID("BargeSabz"),
                                                                X.FieldSet()
                                                                    .Height(25)
                                                                    .Width(150)
                                                                    .Border(false)
                                                                    .Layout(LayoutType.Fit)
                                                                    .Items(
                                                                        X.Container()
                                                                            .Content(@<center><div id='"fi-button-msgB"@ViewBag.CarFileId' style="display:none; width:auto;"></div></center>))
                                                                    ),
                                                        X.Panel()
                                                            .Border(false)
                                                            .BodyStyle("background-color:transparent;")
                                                            .Layout(LayoutType.VBox)
                                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                                            .PaddingSpec("0 0 0 15px")
                                                            .Items(
                                                                X.Image()
                                                                  .ItemID("Kart"),
                                                                X.FieldSet()
                                                                    .Height(25)
                                                                    .Width(150)
                                                                    .Border(false)
                                                                    .Layout(LayoutType.Fit)
                                                                    .Items(
                                                                        X.Container()
                                                                            .Content(@<center><div id='"fi-button-msgKart"@ViewBag.CarFileId' style="display:none; width:auto;"></div></center>))
                                                                    ),
                                                        X.Panel()
                                                            .Border(false)
                                                            .PaddingSpec("0 0 0 15px")
                                                            .BodyStyle("background-color:transparent;")
                                                            .Layout(LayoutType.VBox)
                                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                                            .Items(
                                                                X.Image()
                                                                    .ItemID("BackKart"),
                                                                X.FieldSet()
                                                                    .Height(25)
                                                                    .Width(150)
                                                                    .Border(false)
                                                                    .Layout(LayoutType.Fit)
                                                                    .Items(
                                                                        X.Container()
                                                                            .Content(@<center><div id='"fi-button-msgBKart"@ViewBag.CarFileId' style="display:none; width:auto;"></div></center>))
                                                                ),
                                                        X.Panel()
                                                            .Border(false)
                                                            .PaddingSpec("0 0 0 15px")
                                                            .BodyStyle("background-color:transparent;")
                                                            .Layout(LayoutType.VBox)
                                                            .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                                            .Items(
                                                                X.Image()
                                                                    .ItemID("Sanad"),
                                                                X.FieldSet()
                                                                    .Height(25)
                                                                    .Width(150)
                                                                    .Border(false)
                                                                    .Layout(LayoutType.Fit)
                                                                    .Items(
                                                                        X.Container()
                                                                            .Content(@<center><div id='"fi-button-msgSanad"@ViewBag.CarFileId' style="display:none; width:auto;"></div></center>))
                                                                    )
                                                    ),
                                                    X.FormPanel()
                                                        .Border(false)
                                                        .ItemID("formpanelupload")
                                                        .BodyStyle("background-color:transparent;")
                                                        .Layout(LayoutType.Table)
                                                        .LayoutConfig(new TableLayoutConfig { Columns=4})
                                                        .Items(
                                                            X.FileUploadField()
                                                                .ButtonOnly(true)
                                                                .Icon(Icon.Attach)
                                                                .PaddingSpec("0 10px 0 10px")
                                                                .ButtonText("انتخاب فایل برگ سبز خودرو")
                                                                .DirectEvents(l =>
                                                                {
                                                                    l.Change.Action = "UploadBargeSabz";
                                                                    l.Change.Success = "hideprogressBargeSabz();";
                                                                })
                                                                .Listeners(l => l.Change.Fn = "showFileBargeSabz"),
                                                            X.FileUploadField()
                                                                .ButtonOnly(true)
                                                                .Icon(Icon.Attach)
                                                                .PaddingSpec("0 10px 0 10px")
                                                                .ButtonText("انتخاب فایل صفحه اول کارت")
                                                                .DirectEvents(l =>
                                                                {
                                                                    l.Change.Action = "UploadKart";
                                                                    l.Change.Success = "hideprogressKart();";
                                                                })
                                                                .Listeners(l => l.Change.Fn = "showFileKart"),
                                                            X.FileUploadField()
                                                                .ButtonOnly(true)
                                                                .Icon(Icon.Attach)
                                                                .PaddingSpec("0 10px 0 10px")
                                                                .ButtonText("انتخاب فایل صفحه دوم کارت")
                                                                .DirectEvents(l =>
                                                                {
                                                                    l.Change.Action = "UploadBackKart";
                                                                    l.Change.Success = "hideprogressBackKart();";
                                                                })
                                                                .Listeners(l => l.Change.Fn = "showFileBackKart"),
                                                            X.FileUploadField()
                                                                .ButtonOnly(true)
                                                                .PaddingSpec("0 10px 0 10px")
                                                                .Icon(Icon.Attach)
                                                                .ButtonText("انتخاب فایل سند فروش")
                                                                .DirectEvents(l =>
                                                                {
                                                                    l.Change.Action = "UploadSanad";
                                                                    l.Change.Success = "hideprogressSanad();";
                                                                })
                                                                .Listeners(l => l.Change.Fn = "showFileSanad")
                                                        )
                                            ),
                                        X.Button()
                                            .ItemID("savePictures")
                                            .Text("ذخیره تصاویر")
                                            .MinWidth(80)
                                            .Margin(2)
                                            .Icon(Icon.Disk)
                                            .Listeners(l => l.Click.Handler = "savePictures();")
                                        ),
                                X.FormPanel()
                                    .BodyStyle("background-color:#dfe8f6;")
                                    .Hidden(true)
                                    .ItemID("pnlforBill")
                                    .IconCls("soorathesab")
                                    //.AutoScroll(true)
                                    .Title("صورتحساب")
                                    .Layout(LayoutType.VBox)
                                    .LayoutConfig(new VBoxLayoutConfig { Align = VBoxAlign.Center })
                                    .Border(true)
                                    .Items(
                                        X.Hidden()
                                            .ItemID("shasi_motor_vin")
                                            .Value(""),
                                        X.Hidden()
                                            .ItemID("Mablagh")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldFine")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldValueAddPrice")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldPrice")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("Bed")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("Years"),
                                            //.Value(""),
                                        X.Hidden()
                                            .ItemID("fldOtherPrice")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldMainDiscount")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldFineDiscount")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldValueAddDiscount")
                                            .Value(0),
                                        X.Hidden()
                                            .ItemID("fldOtherDiscount")
                                            .Value(0),
                                        X.FieldSet()
                                            .Title("صورتحساب")
                                            .ItemID("fieldsetforBill")
                                            .Layout(LayoutType.VBox)
                                            .Listeners(l => l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('fieldsetforBill').setWidth(App.AvarezWin.width-330);")
                                            .LayoutConfig(new VBoxLayoutConfig { Align=VBoxAlign.Center})
                                            .Defaults(new { Margin = 2 })
                                            .Items(
                                                X.FieldSet()
                                                    //.MarginSpec("20px 0 0 0")
                                                    .Border(true)
                                                    .Height(65)
                                                    .Title("محاسبه عوارض")
                                                    .Defaults(new { Margin = 10 })
                                                    .Layout(LayoutType.HBox)
                                                    .Items(
                                                        X.Button()
                                                            .Text("محاسبه مجدد")
                                                            .Icon(Ext.Net.Icon.Calculator)
                                                            .Listeners(l => l.Click.Handler = "CalculateNew();"),
                                                        X.Label("مبلغ قابل پرداخت:"),
                                                        X.Label()
                                                            .ItemID("AvarezMablagh")
                                                            .Width(115)
                                                            ),
                                                X.Container()
                                                    .Height(80)
                                                    .Hidden(!HaveBank)
                                                    .Content(@<center><div align="center" id='"fi-button-Dl4"@ViewBag.CarFileId' style="text-align:center;">
                                                        <br />
                                                        <table style="width: 150px;">
                                                            <tr style="align-content:center;text-align:center;">
                                                                @for (var i = 0; i < picmnu.Count; i++)
                                                                {
                                                                    <td style="text-align: center; vertical-align: middle; "><img src="@Url.Content("~/Bank_New/Image/"+picmnu[i].BankId)" title='@picmnu[i].fldBankName' style="height:40px;width:40px;" /></td>
                                                                }
                                                            </tr>
                                                            <tr style="align-content:center">
                                                                @for (var i = 0; i < picmnu.Count; i++)
                                                                {
                                                                    <td style="text-align: center; vertical-align: middle; ">
                                                                        <input id='"Bank"@ViewBag.CarFileId' name="Bank" type="radio" value='@picmnu[i].BankId' style="height:20px;">
                                                                    </td>
                                                                }
                                                            </tr>
                                                        </table>
                                                    </div></center>),
                                                X.FieldSet()
                                                    .Border(false)
                                                    .Defaults(new { Margin = 5 })
                                                .Items(
                                                    X.Button()
                                                        .Text("چاپ جزئیات")
                                                        .Icon(Ext.Net.Icon.PrinterStart)
                                                        .Listeners(l =>l.Click.Handler = "PrintDetails();"),
                                                    /*X.Button()
                                                        .Text("چاپ جزئیات")
                                                        .Icon(Ext.Net.Icon.PrinterStart)
                                                        .Listeners(l => l.Click.Handler = "PrintDetails2();"),*/
                                                    X.Button()
                                                        .Text("پرداخت با Pos")
                                                        .Icon(Ext.Net.Icon.Money)
                                                        .ItemID("btnPos")
                                                        .Listeners(l =>
                                                        {
                                                            l.Click.Handler = "PayPos();";
                                                            //l.Render.Handler = "showHidebtnpose();";
                                                        }),
                                                    X.Button()
                                                        .Text("پرداخت")
                                                        .Icon(Ext.Net.Icon.Coins)
                                                        .Hidden(true)
                                                        .Listeners(l => l.Click.Handler = "PardakhtOnline1New();"),
                                                    X.Button()//تهران
                                                        .Text("پرداخت")
                                                        .Icon(Ext.Net.Icon.Coins)
                                                        .ItemID("btnpishkhan")
                                                        .Hidden(!Pishkhan)
                                                        .Listeners(l => l.Click.Handler = "pishkhan('btnpay');"),
                                                    X.Button()
                                                        .Text("پرداخت")
                                                        .Icon(Ext.Net.Icon.ArrowLeft)
                                                        .Hidden(!onlinePer)
                                                        .Listeners(l =>l.Click.Handler = "Next1();"),
                                                    X.Button()
                                                        .Text("فیش")
                                                        .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 248))
                                                        .Icon(Ext.Net.Icon.Page)
                                                        .Listeners(l =>
                                                        {
                                                            l.Click.Handler = "Fish1();";
                                                        }),
                                                        X.Button()
                                                        .Text("دانلود فیش")
                                                        .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]),414))
                                                        .Icon(Ext.Net.Icon.ArrowDown)
                                                        .Listeners(l =>
                                                        {
                                                            l.Click.Handler = "DownloadFish();";
                                                        }),
                                                    X.Button()
                                                        .Text("رسید دفتر")                                                        
                                                        .Hidden(!resid)
                                                        .Icon(Ext.Net.Icon.Page)
                                                        .Listeners(l =>
                                                        {
                                                            l.Click.Handler = "OfficeRecipt1();";
                                                        }),
                                                    X.Button()
                                                        .Text("رسید دفتر")
                                                        .ItemID("btnpishkhanresid")
                                                        .Hidden(!Pishkhan)
                                                        .Icon(Ext.Net.Icon.Page)
                                                        .Listeners(l =>
                                                        {
                                                            l.Click.Handler = "pishkhanRecipt('btnresipt');";
                                                        })
                                                )),                                                
                                                X.Panel()
                                                    .Border(false)
                                                    .Layout(LayoutType.Fit)
                                                    .AutoScroll(true)
                                                    .ItemID("pnlGridbill")
                                                    .Listeners(l => l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('pnlGridbill').setSize(App.AvarezWin.width-330,App.AvarezWin.height-382);")
                                                    .PaddingSpec("0 0 5px 0")
                                                    .Items(
                                                        X.GridPanel()
                                                            .ItemID("GridFish")
                                                            //.BottomBar(X.PagingToolbar().HideRefresh(true))
                                                            //.Frame(true)
                                                            .AutoScroll(true)
                                                            .Store(
                                                                    X.StoreFor(Model.CarFileFish)
                                                                    //.Proxy(
                                                                    //    Html.X().AjaxProxy()
                                                                    //        .Url(Url.Action("ReadFish"))
                                                                    //        .Reader(Html.X().JsonReader().Root("data"))
                                                                    //        )
                                                                    .PageSize(2000)
                                                                    .RemoteFilter(true)
                                                                    .RemotePaging(true)
                                                            )
                                                            .View(
                                                                Html.X().GridView().LoadingText("در حال بارگذاری...")
                                                            )
                                                            .SelectionModel(
                                                                Html.X().RowSelectionModel()
                                                                    .Mode(SelectionMode.Single))
                                                            .ColumnModel(
                                                                Html.X().RowNumbererColumn(),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldYear).Text("سال").Flex(2),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldPrice).Text("عوارض").Renderer("seperate").Flex(4),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldMablaghMoaser).Text("مبلغ موثر").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldValueAdded).Text("تبصره ب ماده43").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldFinalPrice).Text("مبلغ نهایی").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldNoMashmol).Text("غیر مشمول").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldMashmol).Text("مشمول جریمه").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldTedadJarime).Text("تعداد ماه/روز").Flex(3), 
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldMablaghJarime).Text("جریمه").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldOtherPrice).Text("سایر").Flex(4).Renderer("seperate"),
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldDiscount).Text("تخفیف").Flex(4).Renderer("seperate"),                                                                    
                                                                    Html.X().Column().DataIndex(Model.CarFileFish, m => m.fldDept).Text("جمع کل").Flex(6).Renderer("seperate")
                                                                        )


                                            )
                                            )
                                ),
                        X.GridPanel()
                            .Title("اطلاعات واریزی")
                            .AutoScroll(true)
                            .Listeners(l => {
                                l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('GridVarizi').setSize(App.AvarezWin.width-292,(App.AvarezWin.height-142)/3);";
                                l.AfterRender.Handler = "ReloadGridVarizi();";
                            })
                            .ItemID("GridVarizi")
                            .Listeners(l => l.ItemMouseEnter.Fn = "showmobileintip")
                            //.Height(164)
                            .IconCls("Varizi")
                            .Border(true)
                            .View(
                                Html.X().GridView().LoadingText("در حال بارگذاری...")
                            )
                            .Store(
                                 X.StoreFor(Model.Varizi)
                                    .AutoLoad(false)
                                    .Proxy(
                                        Html.X().AjaxProxy()
                                            .Url(Url.Action("ReadVarizi"))
                                            .Reader(Html.X().JsonReader().Root("data"))
                                        )
                                    .PageSize(2000)
                                    .RemoteFilter(true)
                                    .RemotePaging(true)
                            )
                            .ColumnModel(
                                Html.X().RowNumbererColumn().Flex(1),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldID).Text("کد").Flex(1).Hidden(true),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldCollectionDate).Text("تاریخ").Wrap(true).Flex(2),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldPrice).Text("مبلغ").Renderer("seperate").Wrap(true).Flex(2),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldMunName).Text("صاحب حساب").Wrap(true).Flex(5),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.BankName).Text("بانک عامل").Wrap(true).Flex(5),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.UserName).Text("کاربر ثبت کننده").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.sabtkonande).Text("کاربر صادر کننده").Wrap(true).Flex(2),
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldAcceptName).Text("وضعیت تأیید").Wrap(true).Flex(3),                                
                                Html.X().Column().DataIndex(Model.Varizi, m => m.fldMobile).Hidden(true),
                                Html.X().ImageCommandColumn()
                                    .Listeners(l => l.Command.Fn = "ActiononVarizi")/*.Text("نمایش اطلاعات")*/
                                    .Flex(2).Commands(Html.X().ImageCommand().CommandName("EditVarizi").Icon(Ext.Net.Icon.PageEdit).ToolTip(tt => tt.Text = "ویرایش")
                                    , Html.X().ImageCommand().CommandName("DeleteVarizi").Icon(Ext.Net.Icon.Delete).ToolTip(tt => tt.Text = "حذف")),
                                Html.X().CommandColumn().Flex(2).Listeners(ls => ls.Command.Handler = "ShowResid(record);")
                                    .Commands(
                                        Html.X().GridCommand()
                                            .CommandName("ShowResid")
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("رسید")
                                            .ToolTip(tt => tt.Text = "رسید")
                                        ),
                                         Html.X().CommandColumn().Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 447)).Flex(2).Listeners(ls => ls.Command.Handler = "ShowMafasaInVarizi(record);")
                                    .Commands(
                                        Html.X().GridCommand()
                                            .CommandName("ShowMafasaInVarizi")
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("مفاصا")
                                            .ToolTip(tt => tt.Text = "مفاصا")
                                        ),
                                Html.X().CommandColumn().PrepareToolbar("disableMadrak").Flex(2).Listeners(ls => ls.Command.Handler = "ShowMadrakVariz(record);")
                                    .Commands(
                                        Html.X().GridCommand()
                                            .CommandName("ShowImage")
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("مدرک")
                                            .ToolTip(tt => tt.Text = "مدرک")
                                    )
                                /*Html.X().CommandColumn()/*.PrepareToolbar("disableMadrak").Flex(2).Listeners(ls => ls.Command.Handler = "SodoorMafasa(record);")
                                    .Commands(
                                        Html.X().GridCommand()
                                            .CommandName("sodoormafasa")
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("صدور مفاصا")
                                            .ToolTip(tt => tt.Text = "صدور مفاصا")
                                    )*/
                            ),
                    X.GridPanel()
                        .Title("فیش های در انتظار وصول")
                        .AutoScroll(true)
                        .IconCls("FishD")
                        //.Height(164)
                        .Listeners(l => {
                            l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('GridPeacockery').setSize(App.AvarezWin.width-292,(App.AvarezWin.height-142)/3);";
                            l.AfterRender.Handler = "ReloadGridPeacockery();";
                        })
                        .ItemID("GridPeacockery")
                        //.Hidden(true)
                        .IconCls("Varizi")
                        .Border(true)
                        .Store(
                            X.StoreFor(Model.Peacockery)
                                .Proxy(
                                    Html.X().AjaxProxy()
                                        .Url(Url.Action("ReadPeacockery"))
                                        .Reader(Html.X().JsonReader().Root("data"))
                                    )
                                .AutoLoad(false)
                                .PageSize(2000)
                                .RemoteFilter(true)
                                .RemotePaging(true)
                        )
                        .ColumnModel(
                            Html.X().RowNumbererColumn().Flex(1),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldID).Text("کد").Flex(1).Hidden(true),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldCarFileID).Text("کد پرونده").Hidden(true).Flex(1),
                            /*Html.X().Column().DataIndex(Model.Peacockery, m => m.fldPeacockeryCode).Text("سریال قبض").Wrap(true).Flex(3),*/
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldShGhabz).Text("شناسه قبض").Wrap(true).Flex(5),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldShPardakht).Text("شناسه پرداخت").Wrap(true).Flex(5),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldShowMoney).Text("مبلغ").Wrap(true).Renderer("seperate").Flex(3),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldIssuanceDate).Text("تاریخ صدور").Wrap(true).Flex(3),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.fldBankName).Text("نام بانک").Wrap(true).Flex(5),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.OwnerName).Text("نام مالک").Wrap(true).Flex(5),
                            Html.X().Column().DataIndex(Model.Peacockery, m => m.PlaquNumber).Text("شماره پلاک").Wrap(true).Flex(5)
                    ),
                        X.GridPanel()
                            .Title("سوابق خودرو")
                            .Listeners(l =>
                            {
                                l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('GridSavabegh').setSize(App.AvarezWin.width-292,(App.AvarezWin.height-142)/3);";
                                l.AfterRender.Handler = "ReloadGridSavabegh()";
                            })
                            .Listeners(l => l.ItemMouseEnter.Fn = "showmobileintipsavabegh")
                            .AutoScroll(true)
                            //.Height(164)
                            .IconCls("Savabegh")
                            .View(
                                Html.X().GridView().LoadingText("در حال بارگذاری...")
                            )
                            .ItemID("GridSavabegh")
                            .Border(true)
                            .Store(
                                X.StoreFor(Model.Savabegh)
                                    .Proxy(
                                        Html.X().AjaxProxy()
                                            .Url(Url.Action("ReadSavabegh"))
                                            .Reader(Html.X().JsonReader().Root("data"))
                                        )
                                    .AutoLoad(false)
                                    .PageSize(2000)
                                    .RemoteFilter(true)
                                    .RemotePaging(true)
                                )
                            .ColumnModel(
                                Html.X().RowNumbererColumn().Flex(1),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldID).Text("کد").Flex(1).Hidden(true),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldName).Text("شهرداری").Wrap(true).Flex(5),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldLetterNumber).Text("ش نامه").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldStartDate).Text("از تاریخ").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldEndDate).Text("تا تاریخ").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldPlaqueNumber).Text("ش پلاک").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldUserName).Text("كاربر").Wrap(true).Flex(4),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldAcceptName).Text("وضعیت تأیید").Wrap(true).Renderer("checkexcistFile").Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldDate).Text("تاریخ ثبت").Wrap(true).Flex(3),
                                Html.X().Column().DataIndex(Model.Savabegh, m => m.fldDesc).Text("توضیحات").Wrap(true).Flex(4),
                                Html.X().ImageCommandColumn().Flex(1)
                                    .Listeners(l => l.Command.Fn = "ActiononSavabegh")/*.Text("نمایش اطلاعات")*/
                                    .Flex(2).Commands(Html.X().ImageCommand().CommandName("EditSavabegh").Icon(Ext.Net.Icon.PageEdit).ToolTip(tt => tt.Text = "ویرایش")
                                    , Html.X().ImageCommand().CommandName("DeleteSavabegh").Icon(Ext.Net.Icon.Delete).ToolTip(tt => tt.Text = "حذف")),
                                    Html.X().CommandColumn().Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 447)).Flex(3).Listeners(ls => ls.Command.Fn = "ShowMafasa")
                                    .Commands(
                                    Html.X().GridCommand()
                                            .CommandName("ShowMafasaInExp")
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("مفاصا")
                                            .ToolTip(tt => tt.Text = "مفاصا")  
                                    ),
                                Html.X().CommandColumn().Flex(6).PrepareToolbar("disableMadrak2").Listeners(ls => ls.Command.Fn = "ShowMadrak")
                                    .Commands(                                    
                                        Html.X().GridCommand()
                                            .CommandName("buttonMadrak") 
                                            .StandOut(true)
                                            .MinWidth(60)
                                            .Text("مدرک")
                                            .ToolTip(tt => tt.Text = "مدرک"),
                                        Html.X().GridCommand()
                                        .CommandName("buttonTaeeid")
                                        .StandOut(true)
                                        .MinWidth(60)
                                        .Text("تأیید")
                                        .Hidden(!Avarez.Controllers.Users.Permossions.haveAccess(Convert.ToInt32(Session["UserId"]), 426))
                                        .ToolTip(tt => tt.Text = "تأیید")   
                                    )
                            ),
                        X.GridPanel()
                            .Title("لیست سیاه")
                            .Listeners(l =>
                            {
                                l.Render.Handler = "Ext.getCmp('MenuPanel" + (string)ViewBag.CarFileId + "').queryById('GridBlackList').setSize(App.AvarezWin.width-292,App.AvarezWin.height-334);";
                                //l.AfterRender.Handler = "ReloadGridBlackList()";
                            })
                            .AutoScroll(true)
                            .IconCls("Siah")
                            .Height(300)
                            .ItemID("GridBlackList")
                            .Hidden(true)
                            .Border(true)
                            .View(
                                Html.X().GridView().LoadingText("در حال بارگذاری...")
                            )
                            .Store(
                                X.StoreFor(Model.BlackList)
                                    .AutoLoad(false)
                                    .Proxy(
                                        Html.X().AjaxProxy()
                                            .Url(Url.Action("ReadBlackList"))
                                            .Reader(Html.X().JsonReader().Root("data"))
                                            )
                                    .PageSize(2000)
                                    .RemoteFilter(true)
                                    .RemotePaging(true)
                                )
                            .ColumnModel(
                                Html.X().RowNumbererColumn().Flex(1),
                                Html.X().Column().DataIndex(Model.BlackList, m => m.fldId).Text("کد").Flex(1).Hidden(true),
                                Html.X().Column().DataIndex(Model.BlackList, m => m.fldTypeS).Text("شهرداری").Wrap(true).Flex(5),
                                Html.X().Column().DataIndex(Model.BlackList, m => m.fldMsg).Text("پیغام").Wrap(true).Flex(10),
                                Html.X().ImageCommandColumn()
                                    .Listeners(l => l.Command.Fn = "ActiononBlackList")
                                    .Flex(2).Commands(Html.X().ImageCommand().CommandName("EditBlackList").Icon(Ext.Net.Icon.PageEdit).ToolTip(tt => tt.Text = "ویرایش")
                                    , Html.X().ImageCommand().CommandName("DeleteBlackList").Icon(Ext.Net.Icon.Delete).ToolTip(tt => tt.Text = "حذف"))
                            )
                        )
                    )
            )
)


<script type="text/javascript">
    var MojazSavabegh = 0;
    var sizeeSavabegh = 0;
    var EndUploadSavabegh = false;
    var MojazVarizi = 0;
    var sizeeVarizi = 0;
    var EndUploadVarizi = false;
    var MojazBargeSabz = 0;
    var sizeeBargeSabz = 0;
    var EndUploadBargeSabz = false;
    var MojazKart = 0;
    var sizeeKart = 0;
    var EndUploadKart = false;
    var MojazBackKart = 0;
    var sizeeBackKart = 0;
    var EndUploadBackKart = false;
    var MojazSanad = 0;
    var sizeeSanad = 0;
    var EndUploadSanad = false;

    var CheckSavabegh = setInterval(CheckEndSavabegh, 500);
    var CheckVarizi = setInterval(CheckEndVarizi, 500);
    var CheckBargeSabz = setInterval(CheckEndBargeSabz, 500);
    var CheckKart = setInterval(CheckEndKart, 500);
    var CheckBackKart = setInterval(CheckEndBackKart, 500);
    var CheckSanad = setInterval(CheckEndSanad, 500);

    function checkTaeedSavabegh(carFileID) {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: carFileID
            },
            error: function (xhr, status, error) {
                return 0;
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false) {/*چک نکن*/
                    return true;
                }
                else {
                    return data.taeed;
                }
            }
        });
    }

    var setVINshasi = function (fieldd, valuee) {
        var tabId = App.SearchParvande.activeTab.id;
        if (valuee == true) {
            var txtShasi = Ext.getCmp(tabId).queryById('txtShasi');
            if (txtShasi.getValue().length == 17) {
                Ext.getCmp(tabId).queryById('fieldset5').show();
                Ext.getCmp(tabId).queryById('txtVinMatchShasi').setValue(txtShasi.getValue()).setReadOnly(true);
                Ext.getCmp(tabId).queryById('fieldset6').hide();
            }
            else {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "لطفا شماره شاسی را به درستی وارد نمایید.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
                fieldd.setValue(false);
            }
        }
        else {
            Ext.getCmp(tabId).queryById('fieldset5').hide();
            Ext.getCmp(tabId).queryById('txtVinMatchShasi').setValue("");
            Ext.getCmp(tabId).queryById('fieldset6').show();

            /*Ext.getCmp(tabId).queryById('cboShort').setValue(Ext.getCmp(tabId).queryById('cboShort').store.getAt(0));
            ChangeShort();
            Ext.getCmp(tabId).queryById('_2char').setValue("");
            var Year = Ext.getCmp(tabId).queryById('cboYear').getValue().toString();
            Ext.getCmp(tabId).queryById('_charModel').setValue(Year.substring(2));
            Ext.getCmp(tabId).queryById('_5char').setValue("");
            Ext.getCmp(tabId).queryById('_charShasi').setValue(txtShasi.getValue().substr(Shasi.length - 6).toUpperCase());*/
        }
    };

    var checkexcistFile = function (value, record) {
        if (record.record.data.fldFileId == 0) {
            return "___";
        }
        else {
            return value;
        }
    };

    App.AvarezWin.addListener('resize', function () {
        var CarFileId2 = App.SearchParvande.activeTab.id.substring(14);
        Ext.getCmp('PnlKoli' + CarFileId2).setWidth(App.AvarezWin.width - 292);
        Ext.getCmp('pnlLow' + CarFileId2).setSize((App.AvarezWin.width) - 14, (App.AvarezWin.height) - 121);
        Ext.getCmp('MenuPanel' + CarFileId2).setSize(App.AvarezWin.width - 287, App.AvarezWin.height - 132);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('GridChangeOwner').setSize(Ext.getCmp('PnlKoli' + CarFileId2).queryById('FieldsetOwner').getWidth(), App.AvarezWin.height - 402);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('pnlGridbill').setSize(App.AvarezWin.width - 330, App.AvarezWin.height - 382);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('GridVarizi').setSize(App.AvarezWin.width - 292, (App.AvarezWin.height - 142) / 3);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('GridPeacockery').setSize(App.AvarezWin.width - 292, (App.AvarezWin.height - 142) / 3);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('GridSavabegh').setSize(App.AvarezWin.width - 292, (App.AvarezWin.height - 142) / 3);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('GridBlackList').setSize(App.AvarezWin.width - 292, App.AvarezWin.height - 334);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('pnlUpload').setWidth(Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldsetforSavabegh').getWidth());
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldsettext').setWidth(Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldsetforVarizi').getWidth() - 90);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('pnlUploadVarizi').setWidth(Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldsetforVarizi').getWidth());
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('FieldsetOwner').setWidth(App.AvarezWin.width - 336);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldset1').setWidth(App.AvarezWin.width - 432);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldset2').setWidth(App.AvarezWin.width - 432);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldset3').setWidth(App.AvarezWin.width - 432);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldset4').setWidth(App.AvarezWin.width - 432);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fieldsetVIN').setWidth(App.AvarezWin.width - 432);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('fielsetbtnChangeOwner').setWidth(Ext.getCmp('PnlKoli' + CarFileId2).queryById('FieldsetOwner').getWidth());
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('FieldsetPictures').setWidth(App.AvarezWin.width - 400);
        Ext.getCmp('MenuPanel' + CarFileId2).queryById('fieldsetforBill').setWidth(App.AvarezWin.width - 330);
        Ext.getCmp('PnlKoli' + CarFileId2).queryById('pnlforEditPictures').setHeight(App.AvarezWin.height - 336);
        Ext.getCmp('AccordionPnl' + CarFileId2).setHeight((App.AvarezWin.height) - 467);
    });

    var showmobileintip = function (view, record, item) {
        var tip = record.data.fldMobile;
        var tipS = record.data.fldMobileSabtkonande;
        var target = item.cells[5];/*username*/
        var targetS = item.cells[6];/*sabtkonande*/
        Ext.fly(target).set({ 'data-qtip': tip });
        Ext.fly(targetS).set({ 'data-qtip': tipS });
    };

    var showmobileintipsavabegh = function (view, record, item) {
        var tip = record.data.fldMobile;
        var target = item.cells[6];
        Ext.fly(target).set({ 'data-qtip': tip, 'animate': true });
    };

    function ChangeCboPelakTypeEn() {
        var tabId = App.SearchParvande.activeTab.id;
        var CboPelakTypeEntezami = Ext.getCmp(tabId).queryById('CboPelakTypeEntezami');
        var cboShort = Ext.getCmp(tabId).queryById('cboShort');
        var _charShasi = Ext.getCmp(tabId).queryById('_charShasi');
        var _charModel = Ext.getCmp(tabId).queryById('_charModel');
        var _5char = Ext.getCmp(tabId).queryById('_5char');
        var _2char = Ext.getCmp(tabId).queryById('_2char');

        if (CboPelakTypeEntezami.getValue() == '0') {/*پلاک انتظامی*/
            cboShort.allowBlank = false;
            _charShasi.allowBlank = false;
            _charModel.allowBlank = false;
            _5char.allowBlank = false;
            _2char.allowBlank = false;

            cboShort.validate();
            _charShasi.validate();
            _charModel.validate();
            _5char.validate();
            _2char.validate();
        }
        else {
            cboShort.allowBlank = true;
            _charShasi.allowBlank = true;
            _charModel.allowBlank = true;
            _5char.allowBlank = true;
            _2char.allowBlank = true;
            cboShort.validate();
            _charShasi.validate();
            _charModel.validate();
            _5char.validate();
            _2char.validate();
        }

    }

    function CheckEndSanad() {
        if (EndUploadSanad == true) {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/ShowPic',
                params: {
                    state: 5
                },
                success: function (data) {
                    value = "data:image/gif;base64," + data.image;
                    Ext.getCmp(tabId).queryById('Sanad').setImageUrl(value);
                    var newSize = scaleSize(200, 200, data.width, data.height);
                    Ext.getCmp(tabId).queryById('Sanad').setSize(newSize[0], newSize[1]);
                }
            });

            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndSanad);
            EndUploadSanad = false;
        }
    }
    function CheckEndBackKart() {
        if (EndUploadBackKart == true) {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/ShowPic',
                params: {
                    state: 4
                },
                success: function (data) {
                    value = "data:image/gif;base64," + data.image;
                    Ext.getCmp(tabId).queryById('BackKart').setImageUrl(value);
                    var newSize = scaleSize(200, 200, data.width, data.height);
                    Ext.getCmp(tabId).queryById('BackKart').setSize(newSize[0], newSize[1]);
                }
            });
            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndBackKart);
            EndUploadBackKart = false;
        }
    }
    function CheckEndKart() {
        if (EndUploadKart == true) {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/ShowPic',
                params: {
                    state: 3
                },
                success: function (data) {
                    value = "data:image/gif;base64," + data.image;
                    Ext.getCmp(tabId).queryById('Kart').setImageUrl(value);
                    var newSize = scaleSize(200, 200, data.width, data.height);
                    Ext.getCmp(tabId).queryById('Kart').setSize(newSize[0], newSize[1]);
                }
            });

            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndKart);
            EndUploadKart = false;
        }
    }
    function CheckEndBargeSabz() {
        if (EndUploadBargeSabz == true) {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/ShowPic',
                params: {
                    state: 2
                },
                success: function (data) {
                    value = "data:image/gif;base64," + data.image;
                    Ext.getCmp(tabId).queryById('BargeSabz').setImageUrl(value);
                    var newSize = scaleSize(200, 200, data.width, data.height);
                    Ext.getCmp(tabId).queryById('BargeSabz').setSize(newSize[0], newSize[1]);
                }
            });
            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndBargeSabz);
            EndUploadBargeSabz = false;
        }
    }
    function CheckEndSavabegh() {
        if (EndUploadSavabegh == true) {
            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndSavabegh);
            EndUploadSavabegh = false;
        }
    }
    function CheckEndVarizi() {
        if (EndUploadVarizi == true) {
            Ext.MessageBox.hide();
            Ext.Msg.alert('عملیات موفق', 'فایل با موفقیت آپلود شد.');
            clearInterval(CheckEndVarizi);
            EndUploadVarizi = false;
        }
    }

    var seperate = function (value, metadata, record, rowIndex, colIndex, store) {
        return value.toLocaleString();
    };

    var showFileSanad = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msgSanad"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarSanad();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazSanad = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeSanad = 1;
                    }
                    if (sizeeSanad == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeSanad = 1;
                    }
                    if (sizeeSanad == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    var showFileBackKart = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msgBKart"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarBackKart();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazBackKart = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeBackKart = 1;
                    }
                    if (sizeeBackKart == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeBackKart = 1;
                    }
                    if (sizeeBackKart == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    } else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    var showFileKart = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msgKart"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarKart();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazKart = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeKart = 1;
                    }
                    if (sizeeKart == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeKart = 1;
                    }
                    if (sizeeKart == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    } else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    var showFileBargeSabz = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msgB"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarBargeSabz();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazBargeSabz = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeBargeSabz = 1;
                    }
                    if (sizeeBargeSabz == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeBargeSabz = 1;
                    }
                    if (sizeeBargeSabz == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    } else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    var showFileSavabegh = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msg"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarSavabegh();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazSavabegh = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeSavabegh = 1;
                    }
                    if (sizeeSavabegh == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeSavabegh = 1;
                    }
                    if (sizeeSavabegh == 1) {
                        el.update('<b>فایل انتخاب شده:</b> ' + v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    } else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    var showFileVarizi = function (fb, v) {
        var tabId = App.SearchParvande.activeTab.id;
        var id = fb.fileInputEl.dom.id;
        var elId = '"fi-button-msgvariz"' + tabId.substring(14);
        var el = Ext.get(elId);
        if (v) {
            showProgressBarVarizi();
            if (v.split('.').pop().toLowerCase() == "jpg" || v.split('.').pop().toLowerCase() == "jpeg"
                || v.split('.').pop().toLowerCase() == "png" || v.split('.').pop().toLowerCase() == "tif"
                || v.split('.').pop().toLowerCase() == "tiff") {
                MojazVarizi = 1;
                if ('@ViewBag.ImageSetting' == "4") {
                    if (document.getElementById(id).files[0].size <= 716800 && document.getElementById(id).files[0].size > 51200) {
                        sizeeVarizi = 1;
                    }
                    if (sizeeVarizi == 1) {
                        el.update(v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    }
                    else {
                        el.highlight();
                    }
                }
                else {
                    if (document.getElementById(id).files[0].size <= 716800) {
                        sizeeVarizi = 1;
                    }
                    if (sizeeVarizi == 1) {
                        el.update('<b>فایل انتخاب شده:</b> ' + v);
                    }
                    else {
                        el.update("");
                    }

                    if (!el.isVisible()) {
                        el.slideIn('t', {
                            duration: .2,
                            easing: 'easeIn',
                            callback: function () {
                                el.highlight();
                            }
                        });
                    } else {
                        el.highlight();
                    }
                }
            }
            else {
                el.update("");
            }
        }
    };

    function hideprogressSanad() {
        if (MojazSanad == 1 && sizeeSanad == 1) {
            EndUploadSanad = true;
        }
        sizeeSanad = 0;
        MojazSanad = 0;
    }

    function hideprogressBackKart() {
        if (MojazBackKart == 1 && sizeeBackKart == 1) {
            EndUploadBackKart = true;
        }
        sizeeBackKart = 0;
        MojazBackKart = 0;
    }

    function hideprogressKart() {
        if (MojazKart == 1 && sizeeKart == 1) {
            EndUploadKart = true;
        }
        sizeeKart = 0;
        MojazKart = 0;
    }

    function hideprogressBargeSabz() {
        if (MojazBargeSabz == 1 && sizeeBargeSabz == 1) {
            EndUploadBargeSabz = true;
        }
        sizeeBargeSabz = 0;
        MojazBargeSabz = 0;
    }

    function hideprogressSavabegh() {
        if (MojazSavabegh == 1 && sizeeSavabegh == 1) {
            EndUploadSavabegh = true;
        }
        sizeeSavabegh = 0;
        MojazSavabegh = 0;
    }

    function hideprogressVarizi() {
        if (MojazVarizi == 1 && sizeeVarizi == 1) {
            EndUploadVarizi = true;
        }
        sizeeVarizi = 0;
        MojazVarizi = 0;
    }

    function showProgressBarSanad() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function showProgressBarBackKart() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function showProgressBarKart() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function showProgressBarBargeSabz() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function showProgressBarSavabegh() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function showProgressBarVarizi() {
        Ext.MessageBox.show({
            msg: 'لطفاً منتظر باشید',
            progressText: 'در حال آپلود فایل...',
            width: 300,
            wait: true,
            waitConfig:
            {
                interval: 200,
                text: 'در حال آپلود فایل...',
                scope: this
            }
        });
    }

    function DownloadHelpVideo() {
        window.location.href = '@Url.Content("~/NewVer/SelectParvande/DownloadHelpVideo")';
    }

    function DownloadHelpPdf() {
        window.location.href = '@Url.Content("~/NewVer/SelectParvande/DownloadHelpPdf")';
    }

    function setTitleforTab() {
        Ext.getCmp("SelectParvande" + '@ViewBag.CarFileId').setTitle('@ViewBag.Ownername');
        Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").setValue('@ViewBag.KhodEzhari');
    }

    var disableMadrak = function (grid, toolbar, rowIndex, record) {
        var Button = toolbar.items.get(0);
        if (record.data.fldFileId == 0) {
            Button.setDisabled(true);
        }
    };

    var disableMadrak2 = function (grid, toolbar, rowIndex, record) {
        var Button = toolbar.items.get(0);
        var Button2 = toolbar.items.get(1);

        if (record.data.fldFileId == 0) {
            Button.setDisabled(true);
        }
        if (record.data.fldAccept == 1 || record.data.fldFileId == 0) {
            Button2.setDisabled(true);
        }
    };

    function savePictures() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask('در حال ذخیره سازی...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/SavePictures',
            params: {
                carFileId: tabId.substring(14),
                fileIdB: Ext.getCmp(tabId).queryById('FileIdBarg').getValue(),
                FileIdBK: Ext.getCmp(tabId).queryById('FileIdBackKart').getValue(),
                fileIdK: Ext.getCmp(tabId).queryById('FileIdKart').getValue(),
                fileIdS: Ext.getCmp(tabId).queryById('FileIdSanad').getValue()
            },
            success: function (data) {
                var ic = Ext.MessageBox.INFO;
                if (data.Er == 1)
                    ic = Ext.MessageBox.ERROR;
                Ext.MessageBox.show({
                    title: data.MsgTitle,
                    msg: data.Msg,
                    icon: ic,
                    buttons: Ext.MessageBox.OK
                });
                if (data.Er != 1) {
                    Ext.getCmp(tabId).queryById('FileIdBarg').setValue(data.Bargsabzfileidd);
                    Ext.getCmp(tabId).queryById('FileIdBackKart').setValue(data.CartBackfileidd);
                    Ext.getCmp(tabId).queryById('FileIdKart').setValue(data.Cartfileidd);
                    Ext.getCmp(tabId).queryById('FileIdSanad').setValue(data.Sanadfileidd);
                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    var setCharShasiVIN = function (field, e) {
        if (e.getKey() == 13) {
            setUpperCase('txtShasi');
        }
    };
    
    function SaveChangeOwner() {
        var tabId = App.SearchParvande.activeTab.id;
        var CboSh_Pelak = Ext.getCmp(tabId).queryById('CboSh_Pelak');
        var er = false;
        if (CboSh_Pelak.validate() == false) {
            er = true;
        }
        if (er == true)
            return;
        App.AvarezWin.body.mask('در حال ذخیره سازی...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/SaveChangeOwner',
            params: {
                PlaquId: Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue(),
                CarID: Ext.getCmp(tabId).queryById('fldCarId').getValue(),
                Date: Ext.getCmp(tabId).queryById('txtDateP2').getText()
            },
            success: function (data) {
                var ic = Ext.MessageBox.INFO;
                if (data.Er == 1)
                    ic = Ext.MessageBox.ERROR;
                Ext.MessageBox.show({
                    title: data.MsgTitle,
                    msg: data.Msg,
                    icon: ic,
                    buttons: Ext.MessageBox.OK,
                    fn: function (btn) {
                        if (btn == 'ok') {
                            App.AvarezWin.body.mask('در حال بارگذاری...');
                            Ext.net.DirectMethod.request({
                                url: '/NewVer/SelectParvande/Index',
                                params: {
                                    containerId: "SearchParvande",
                                    CarId: Ext.getCmp(tabId).queryById('fldCarId').getValue(),
                                    CarFileId: data.carFilechange
                                },
                                success: function () {
                                    Ext.getCmp(tabId).destroy();
                                    App.AvarezWin.body.mask().hide();
                                }
                            });
                        }
                    }
                });
                if (data.Er != 1) {
                    /*document.getElementById('"KName"' + tabId.substring(14)).innerText = Ext.getCmp(tabId).queryById("txtNameFamilyMalek").getText();
                    document.getElementById('"KCode"' + tabId.substring(14)).innerText = Ext.getCmp(tabId).queryById("txtNationalCode").getValue();
                    document.getElementById('"KPelak1"' + tabId.substring(14)).innerText = data.plaqecity;
                    document.getElementById('"KPelak2"' + tabId.substring(14)).innerText = data.pluqeserial;
                    document.getElementById('"KPelak3"' + tabId.substring(14)).innerText = data.plaqenumber;
                    Ext.getCmp(tabId).setTitle(Ext.getCmp(tabId).queryById("txtNameFamilyMalek").getText());

                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/Fill',
                        params: {
                            CarFileId: tabId.substring(14)
                        },
                        success: function (data1) {
                            var html = "کد ملی:" + data1.CodeMeli + "</br>VIN:" + data1.vin + "</br>شماره پلاک:" + data1.plaq + "</br>شماره موتور:" + data1.motor +
                            "</br>شماره شاسی:" + data1.shasi + "</br>نوع ساخت:" + data1.make + "</br>نوع کاربری:" + data1.account + "</br>نوع کابین:" + data1.cabin + "</br>سیستم خودرو:" + data1.syst + "</br>تیپ خودرو:" +
                            data1.modell + "</br>کلاس خودرو" + data1.classs + "</brرنگ خودرو:>" + data1.color + "</br>سال تولید:" + data1.year +
                            "</br>تاریخ پلاک گذاری:" + data1.datep + "</br>تاریخ اولین بیمه:" + data1.date;
                            Ext.create('Ext.tip.ToolTip', {
                                target: Ext.getCmp(tabId).tab,
                                anchorToTarget: true,
                                anchorOffset: 25,
                                anchorSize: {
                                    width: 58,
                                    height: 20
                                },
                                anchor: 'top',
                                closable: false,
                                dismissDelay: 0,
                                baseCls: 'ifs-tooltip',
                                shadow: false,
                                autoHide: true,
                                showDelay: 0,
                                html: html
                            });
                        }
                    });*/
                    Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().getProxy().setExtraParam("PlaquId", Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue());
                    Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().load();
                    App.GridSearch.store.load();
                    App.AvarezWin.body.mask().hide();
                }
            }
        });
    }

    function checkOwnerAtba() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById("cboTypeOwner").getValue() == "2" && Ext.getCmp(tabId).queryById("txtNationalCodeAtba").getValue() != "") {
            App.AvarezWin.body.mask("لطفا منتظر باشید...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/CheckIsOwner',
                params: {
                    NationalCode: Ext.getCmp(tabId).queryById("txtNationalCodeAtba").getValue()
                },
                success: function (data) {
                    if (data.name != "") {
                        Ext.getCmp(tabId).queryById('btnNewOwner').disable();
                        Ext.getCmp(tabId).queryById('btnEditOwner').enable();
                        Ext.getCmp(tabId).queryById('CboSh_Pelak').enable();
                        Ext.getCmp(tabId).queryById('CboSh_Pelak').store.load({
                            params: {
                                NationalCode: Ext.getCmp(tabId).queryById("txtNationalCodeAtba").getValue()
                            }
                        });
                        Ext.getCmp(tabId).queryById('CboSh_Pelak').expand();
                        Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText(data.name);
                        Ext.getCmp(tabId).queryById('MalekIDChange').setValue(data.MalekIDChange);
                    }
                    else {
                        Ext.getCmp(tabId).queryById('CboSh_Pelak').clearValue();
                        Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText("");
                        Ext.getCmp(tabId).queryById('CboSh_Pelak').disable();
                        Ext.getCmp(tabId).queryById('btnNewOwner').enable();
                        Ext.getCmp(tabId).queryById('btnEditOwner').disable();
                        Ext.MessageBox.show({
                            title: "",
                            msg: "مالک مورد نظر در سیستم ثبت نشده است. لطفا جهت ثبت مالک روی دکمه اضافه کلیک نمایید.",
                            icon: Ext.MessageBox.INFO,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
    }

    function ShowPnlSavabegh() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
        Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").setHeight(App.AvarezWin.height - 350);
        Ext.getCmp(tabId).queryById("GridVarizi").hide();
        Ext.getCmp(tabId).queryById("GridPeacockery").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").show();
        Ext.getCmp(tabId).queryById("GridSavabegh").show();
        ClearEnteghalSavabegh();
        Ext.getCmp(tabId).queryById("cboState").validate();
        Ext.getCmp(tabId).queryById("cboMun").validate();
        Ext.getCmp(tabId).queryById("CboAzSal").validate();
        Ext.getCmp(tabId).queryById("CboTaSal").validate();
        Ext.getCmp(tabId).queryById("txtShName").validate();
        Ext.getCmp(tabId).queryById("cboType").blur();
        Ext.getCmp(tabId).queryById("CboPelakTypeEntezami").blur();
        Ext.getCmp(tabId).queryById("txtDateVariz").blur();
        Ext.getCmp(tabId).queryById("txtNationalCode").blur();
        Ext.getCmp(tabId).queryById("cboState").focus();
        ReloadGridSavabegh();
    }
    function CarFileTaid() {
        if (Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").getValue() == "1") {
            Ext.MessageBox.show({
                title: "هشدار",
                msg: "درصورت ادامه پرونده تایید خواهد شد و امکان ویرایش آن را نخواهید داشت. آیا مطمئن هستید؟",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.YESNO,
                fn: function (btn) {
                    if (btn == 'yes') {
                        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });

                        Ext.net.DirectMethod.request({
                            url: '/NewVer/selectParvande/Taid',
                            params: {
                                CarFileId: App.SearchParvande.activeTab.id.substring(14)
                            },
                            success: function (data) {
                                if (data.Er == "0") {
                                    Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").setValue(data.KhodEzhari);
                                    Ext.MessageBox.show({
                                        title: data.MsgTitle,
                                        msg: data.Msg,
                                        icon: Ext.MessageBox.INFO,
                                        buttons: Ext.MessageBox.OK
                                    });
                                } else {
                                    Ext.MessageBox.show({
                                        title: data.MsgTitle,
                                        msg: data.Msg,
                                        icon: Ext.MessageBox.WARNING,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                Ext.net.Mask.hide();
                            }
                        });
                    }
                }
            });
        } else {
            Ext.MessageBox.show({
                title: "",
                msg: 'پرونده مورد نظر قبلا تایید شده است.',
                icon: Ext.MessageBox.INFO,
                buttons: Ext.MessageBox.OK
            });
        }
    }
    function GotoFirstPage() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
        Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").show();
        Ext.getCmp(tabId).queryById("GridSavabegh").setHeight((App.AvarezWin.height - 142) / 3);
        Ext.getCmp(tabId).queryById("GridVarizi").show();
        Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 142) / 3);
        Ext.getCmp(tabId).queryById("GridPeacockery").show();
        Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 142) / 3);
        ReloadGridSavabegh();
        ReloadGridVarizi();
        ReloadGridPeacockery();
    }

    function ShowPnlVarizi() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
        Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").show();
        Ext.getCmp(tabId).queryById("GridVarizi").show();
        Ext.getCmp(tabId).queryById("GridPeacockery").show();
        ClearVarizi();
        if (Ext.getCmp(tabId).queryById("cboNoePardakht").getValue() == "1") {
            Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 342) / 2);
            Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 342) / 2);
        }
        else {
            Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 381) / 2);
            Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 381) / 2);
        }
        Ext.getCmp(tabId).queryById("txtSerial").validate();
        Ext.getCmp(tabId).queryById("txtSerialFish").validate();
        Ext.getCmp(tabId).queryById("txtPrice").validate();
        Ext.getCmp(tabId).queryById("txtMun").validate();
        Ext.getCmp(tabId).queryById("cboType").blur();
        Ext.getCmp(tabId).queryById("CboPelakTypeEntezami").blur();
        Ext.getCmp(tabId).queryById("txtNationalCode").blur();
        Ext.getCmp(tabId).queryById("cboState").blur();
        SetDate();
        ReloadGridVarizi();
        ReloadGridPeacockery();
        Ext.getCmp(tabId).queryById("txtDateVariz").focus();
    }
    function EditMalek() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        var tabId = App.SearchParvande.activeTab.id;
        Ext.net.DirectMethod.request({
            url: '/NewVer/Parvande/NewMalek',
            params: {
                id: Ext.getCmp(tabId).queryById("fldMalekId").getValue(),
                state: 10
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }
    function ShowPnlEditCar() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridPeacockery").hide();
        Ext.getCmp(tabId).queryById("GridVarizi").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").show();
        Ext.getCmp(tabId).queryById("pnlforEditCar").show();
        LoadPropertyCar();
        getPic();
        Ext.getCmp(tabId).queryById("CboPelakTypeEntezami").blur();
        Ext.getCmp(tabId).queryById("txtNationalCode").blur();
        Ext.getCmp(tabId).queryById("cboState").blur();
        Ext.getCmp(tabId).queryById("txtDateVariz").blur();
        Ext.getCmp(tabId).queryById("cboType").focus();
    }

    function ShowPnlEditPictures() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").show();
        Ext.getCmp(tabId).queryById("pnlforEditCar").show();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridVarizi").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("GridPeacockery").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        getPic();
        LoadPropertyCar();
        Ext.getCmp(tabId).queryById("CboPelakTypeEntezami").blur();
        Ext.getCmp(tabId).queryById("txtNationalCode").blur();
        Ext.getCmp(tabId).queryById("cboState").blur();
        Ext.getCmp(tabId).queryById("txtDateVariz").blur();
        Ext.getCmp(tabId).queryById("cboType").focus();
    }

    function ShowPnlBlackList() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
        Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
        Ext.getCmp(tabId).queryById("GridPeacockery").hide();
        Ext.getCmp(tabId).queryById("pnlforBlackList").show();
        Ext.getCmp(tabId).queryById("GridBlackList").show();
        Ext.getCmp(tabId).queryById("CboPelakTypeEntezami").blur();
        Ext.getCmp(tabId).queryById("txtNationalCode").blur();
        Ext.getCmp(tabId).queryById("cboState").blur();
        Ext.getCmp(tabId).queryById("txtDateVariz").blur();
        Ext.getCmp(tabId).queryById("cboType").focus();
        ReloadGridBlackList();
        ClearBlackList();
        Ext.getCmp(tabId).queryById("cboType").validate();
        Ext.getCmp(tabId).queryById("txtMsg").validate();

    }

    function ShowPnlChangeMalek() {
        setPropOwnerinFieldset();
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").show();
        /*var pnlId = "PnlKoli" + tabId.substring(14);*/
        Ext.getCmp(tabId).queryById("cboTypeOwner").setValue("1");
        ChangeCboTypeOwner();
        Ext.getCmp(tabId).queryById("txtNationalCode").setValue("");
        Ext.getCmp(tabId).queryById("txtNameFamilyMalek").setText("");
        Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().getProxy().setExtraParam("PlaquId", Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue());
        Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().load();
        Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
        Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
        Ext.getCmp(tabId).queryById("pnlforBill").hide();
        Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
        Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
        Ext.getCmp(tabId).queryById("GridSavabegh").hide();
        Ext.getCmp(tabId).queryById("GridPeacockery").hide();
        Ext.getCmp(tabId).queryById("GridVarizi").hide();
        Ext.getCmp(tabId).queryById("GridBlackList").hide();
        Ext.getCmp(tabId).queryById("pnlforChangeOwner").setHeight(App.AvarezWin.height - 141);
        Ext.getCmp(tabId).queryById("txtNationalCode").focus();
    }

    function ShowPnlBill(type) {
        var tabId = App.SearchParvande.activeTab.id;
        if (type == 0) {
            Ext.getCmp(tabId).queryById('yearoftax').setValue(0);
        }
        if (Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").getValue() == '0') {
            Ext.net.DirectMethod.request({
                url: '/NewVer/Parvande/ShouldMobileVerify',
                params: {
                    CarFileId: tabId.substring(14)
                },
                success: function (data) {
                    if (data.Verifyed == 0) {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/Parvande/MobileVerify',
                            params: {
                                CarFileId: tabId.substring(14)
                            },
                            success: function () {
                                Ext.net.Mask.hide();
                            }
                        });
                    } else {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/GetTrnStatus',
                            params: {
                                CarFileId: tabId.substring(14)
                            },
                            success: function (d) {
                                if (d == "0") {/*تراکنشی*/
                                    Ext.MessageBox.show({
                                        title: "هشدار",
                                        msg: "درصورت ادامه از شارژ شما کسر خواهد شد. آیا مطمئن هستید؟",
                                        icon: Ext.MessageBox.WARNING,
                                        buttons: Ext.MessageBox.YESNO,
                                        fn: function (btn) {
                                            if (btn == 'yes') {
                                                Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
                                                Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
                                                Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
                                                Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
                                                Ext.getCmp(tabId).queryById("pnlforBill").show();
                                                Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
                                                Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
                                                Ext.getCmp(tabId).queryById("GridSavabegh").hide();
                                                Ext.getCmp(tabId).queryById("GridVarizi").hide();
                                                Ext.getCmp(tabId).queryById("GridPeacockery").hide();
                                                Ext.getCmp(tabId).queryById("GridBlackList").hide();
                                                Ext.getCmp(tabId).queryById("GridVarizi").hide();
                                                showHidebtnpose();
                                                LoadBill(type);
                                            }
                                        }
                                    });
                                }
                                else {
                                    Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
                                    Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
                                    Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
                                    Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
                                    Ext.getCmp(tabId).queryById("pnlforBill").show();
                                    Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
                                    Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
                                    Ext.getCmp(tabId).queryById("GridSavabegh").hide();
                                    Ext.getCmp(tabId).queryById("GridVarizi").hide();
                                    Ext.getCmp(tabId).queryById("GridPeacockery").hide();
                                    Ext.getCmp(tabId).queryById("GridBlackList").hide();
                                    Ext.getCmp(tabId).queryById("GridVarizi").hide();
                                    showHidebtnpose();
                                    LoadBill(type);
                                }
                            }
                        });
                    }
                }
            });
        } else {
            Ext.MessageBox.show({
                title: "",
                msg: "پرونده مورد نظر تایید نشده و می بایست کلیه اطلاعات شامل پلاک، مشخصات خودرو، انتقال سوابق و اطلاعات واریزی بررسی گردیده و درصورت وجود مغایرت نسبت به اصلاح موارد ذکر شده اقدام نمایید و پس از اطمینان از صحیح بودن اطلاعات پرونده را تایید کنید. جهت تایید پرونده بروی تصویر کارت خودرو راست کلیک و تایید را انتخاب کنید. لازم بذکر است پس از تایید و وجود هرگونه مغایرت در اطلاعات مسئولیت آن به عهده شما خواهد بود.",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    function LoadBill(typee) {
        var tabId = App.SearchParvande.activeTab.id;
        if (hasPos == false) {
            Ext.getCmp(tabId).queryById("btnpishkhan").hide();
            Ext.getCmp(tabId).queryById("btnpishkhanresid").hide();
            if ('@Pishkhan' == true) {
                Ext.MessageBox.show({
                    title: "",
                    msg: "به دلیل عدم اتصال به دستگاه کارتخوان امکان پرداخت وجود ندارد.",
                    icon: Ext.MessageBox.WARNING,
                    buttons: Ext.MessageBox.OK
                });
            }
        }

        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/calc',
            params: {
                carFileId: tabId.substring(14),
                Yeartax: typee
            },
            success: function (data) {
                if (data.State == 2) {
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/SendToSupporter',
                        params: {
                            msg: data.msg,
                            Year: data.Year,
                            CarClassId: 0,
                            carFileID: tabId.substring(14)
                        },
                        success: function (data) {
                            App.AvarezWin.body.mask().hide();
                        }
                    });
                    Ext.getCmp(tabId).queryById("Years").setValue(data.Year);
                    /*Years = data.Year;*/
                }
                else {
                    if (data.msg != '') {
                        Ext.MessageBox.show({
                            title: data.MsgTitle,
                            msg: data.msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        /*Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/SendToSupporter',
                            params: {
                                msg: data.msg,
                                Year: data.Year,
                                CarClassId: 0,
                                carFileID: tabId.substring(14)
                            },
                            success: function (data) {
                            }
                        });*/
                    }
                    else {
                        Ext.getCmp(tabId).queryById('GridFish').getStore().loadData(data.bedehi);
                        Ext.getCmp(tabId).queryById('AvarezMablagh').setText(accounting.formatNumber(data.mablagh).toString() + ' ریال');
                        Ext.getCmp(tabId).queryById("Mablagh").setValue(data.mablagh);
                        Ext.getCmp(tabId).queryById("fldFine").setValue(data.fldFine);
                        Ext.getCmp(tabId).queryById("fldValueAddPrice").setValue(data.fldValueAddPrice);
                        Ext.getCmp(tabId).queryById("fldPrice").setValue(data.fldPrice);
                        Ext.getCmp(tabId).queryById("Bed").setValue(data.Bed);
                        Ext.getCmp(tabId).queryById("Years").setValue(data.Years);
                        Ext.getCmp(tabId).queryById("fldOtherPrice").setValue(data.fldOtherPrice);
                        Ext.getCmp(tabId).queryById("fldMainDiscount").setValue(data.fldMainDiscount);
                        Ext.getCmp(tabId).queryById("fldFineDiscount").setValue(data.fldFineDiscount);
                        Ext.getCmp(tabId).queryById("fldValueAddDiscount").setValue(data.fldValueAddDiscount);
                        Ext.getCmp(tabId).queryById("fldOtherDiscount").setValue(data.fldOtherDiscount);
                        Ext.getCmp(tabId).queryById("FinallPrice").setValue(data.mablagh1);
                    }
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/CheckExistFish',
                        params: {
                            carFileid: tabId.substring(14),
                            showmoney: Ext.getCmp(tabId).queryById("Mablagh").getValue()
                        },
                        success: function (result) {
                            if (result.state != 0)
                                Ext.MessageBox.show({
                                    title: "هشدار",
                                    msg: 'برای پرونده انتخابی فیش صادر و پرداخت نگردیده است.',
                                    icon: Ext.MessageBox.WARNING,
                                    buttons: Ext.MessageBox.OK
                                });
                            App.AvarezWin.body.mask().hide();
                        }
                    });
                }
            }
        });
    }

    function CalculateNew() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال انجام عملیات...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/Fill',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (data1) {
                var shasi = ""; var motor = ""; var vin = "";
                if (data1.shasi == "" || data1.motor == "" || data1.vin == "") {
                    if (data1.shasi == "")
                        shasi = " شماره شاسی،";
                    if (data1.motor == "")
                        motor = " شماره موتور،";
                    if (data1.vin == "")
                        vin = " VIN،";
                    shasi_motor_vin = "ثبت " + shasi + motor + vin + " ضروری می باشد.";
                    Ext.getCmp(tabId).queryById("shasi_motor_vin").setValue(shasi_motor_vin);
                }
            }
        });

        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/GetPicStatus',
            params: {
                CarFileid: tabId.substring(14)
            },
            success: function (result) {
                if (result.status == false && result.ForceScan == "1") {
                    var str = "";
                    if (result.carfile == 1)
                        str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                    if (result.coll == 1)
                        str += " واریزی علی الحساب ";
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                if (result.status1 == false && result.ExpScan == "1") {
                    var str = "";
                    if (result.carext == 1)
                        str += " انتقال سوابق ";
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                App.AvarezWin.body.mask().hide();
            }
        });
        var valuee = Ext.getCmp(tabId).queryById('yearoftax').getValue();
        LoadBill(valuee);
    }

    function setPropOwnerinFieldset() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask('در حال بارگذاری...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/FillChangeMalek',
            params: {
                CarId: Ext.getCmp(tabId).queryById("fldCarId").getValue(),
                CarFileId: tabId.substring(14)
            },
            success: function (data) {
                var txtNoeSakht = Ext.getCmp(tabId).queryById('txtNoeSakht');
                txtNoeSakht.setText(data.make);

                var txtCarAccountTypes2 = Ext.getCmp(tabId).queryById('txtCarAccountTypes2');
                txtCarAccountTypes2.setText(data.account);

                var txtCarCabin2 = Ext.getCmp(tabId).queryById('txtCarCabin2');
                txtCarCabin2.setText(data.cabin);

                var txtSystem2 = Ext.getCmp(tabId).queryById('txtSystem2');
                txtSystem2.setText(data.syst);

                var txtModel2 = Ext.getCmp(tabId).queryById('txtModel2');
                txtModel2.setText(data.modell);

                var txtClass2 = Ext.getCmp(tabId).queryById('txtClass2');
                txtClass2.setText(data.classs);

                var txtMotor2 = Ext.getCmp(tabId).queryById('txtMotor2');
                txtMotor2.setText(data.motor);

                var txtShasi2 = Ext.getCmp(tabId).queryById('txtShasi2');
                txtShasi2.setText(data.shasi);

                var txtColor2 = Ext.getCmp(tabId).queryById('txtColor2');
                txtColor2.setText(data.color);

                var txtYear2 = Ext.getCmp(tabId).queryById('txtYear2');
                txtYear2.setText(data.year);

                var txtDateP2 = Ext.getCmp(tabId).queryById('txtDateP2');
                txtDateP2.setText(data.currentDate);

                var txtDate2 = Ext.getCmp(tabId).queryById('txtDate2');
                txtDate2.setText(data.date);

                var VIN2 = Ext.getCmp(tabId).queryById('VIN2');
                VIN2.setText(data.vin);
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ChangeCboTypeOwner() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('cboTypeOwner').getValue() == "1") {
            Ext.getCmp(tabId).queryById('txtNationalCodeAtba').hide();
            Ext.getCmp(tabId).queryById('txtNationalCode').show();
            Ext.getCmp(tabId).queryById('lblNationalCode').setText("کــــد مـــلـی:");
            Ext.getCmp(tabId).queryById('txtNationalCode').minLength = "10";
            Ext.getCmp(tabId).queryById('txtNationalCode').inputEl.set({ maxLength: 10 });
            Ext.getCmp(tabId).queryById('txtNationalCode').validate();
            Ext.getCmp(tabId).queryById('txtNationalCode').setValue("");
            Ext.getCmp(tabId).queryById('lblNameOwner').setText("نــام مـالک:");
        }
        else if (Ext.getCmp(tabId).queryById('cboTypeOwner').getValue() == "0") {
            Ext.getCmp(tabId).queryById('txtNationalCodeAtba').hide();
            Ext.getCmp(tabId).queryById('txtNationalCode').show();
            Ext.getCmp(tabId).queryById('lblNationalCode').setText("شناسه ملی:");
            Ext.getCmp(tabId).queryById('txtNationalCode').minLength = "11";
            Ext.getCmp(tabId).queryById('txtNationalCode').inputEl.set({ maxLength: 12 });
            Ext.getCmp(tabId).queryById('txtNationalCode').validate();
            Ext.getCmp(tabId).queryById('txtNationalCode').setValue("");
            Ext.getCmp(tabId).queryById('lblNameOwner').setText("نام شرکت:");
        }
        else {
            Ext.getCmp(tabId).queryById('lblNationalCode').setText("کــــد مـــلـی:");
            Ext.getCmp(tabId).queryById('txtNationalCode').hide();
            Ext.getCmp(tabId).queryById('txtNationalCodeAtba').show();
            Ext.getCmp(tabId).queryById('lblNameOwner').setText("نــام مـالک:");
        }
    }

    function ChangeCboPlaqueOwner() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboTypeOwner = Ext.getCmp(tabId).queryById('cboTypeOwner');
        if (Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue() == "0") {
            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/NewMalek_Pelak/Index',
                params: {
                    NationalCode: txtNationalCode.getValue(),
                    State: "1",
                    Malek: false,
                    CarFileID: tabId.substring(14),
                    TypeMalek: cboTypeOwner.getValue()
                },
                success: function () {
                    App.AvarezWin.body.mask().hide();
                }
            });
            Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().getProxy().setExtraParam("PlaquId", Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue());
            Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().load();
        }
        else {
            Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().getProxy().setExtraParam("PlaquId", Ext.getCmp(tabId).queryById('CboSh_Pelak').getValue());
            Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().load();
        }
    }

    function loadCboMun() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboMun').getStore().load(
        {
            params: {
                cboState: Ext.getCmp(tabId).queryById('cboState').getValue()
            }
        });
        Ext.getCmp(tabId).queryById('cboMun').expand();
    }

    function loadCboTaSal() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('CboTaSal').clearValue();
        Ext.getCmp(tabId).queryById('CboTaSal').getStore().load({
            params: {
                StartYear: Ext.getCmp(tabId).queryById('CboAzSal').getValue()
            }
        });
    }

    function loadAccountTypes() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue() != 1) {
            Ext.getCmp(tabId).queryById('checkbox1').setValue(false);
            Ext.getCmp(tabId).queryById('checkbox1').hide();
            Ext.getCmp(tabId).queryById('lblCheck').hide();
            Ext.getCmp(tabId).queryById('fieldset6').show();
            Ext.getCmp(tabId).queryById('fieldset5').hide();
            Ext.getCmp(tabId).queryById('_2char').setValue("");
            Ext.getCmp(tabId).queryById('_5char').setValue("");
        }
        else {
            Ext.getCmp(tabId).queryById('checkbox1').show();
            Ext.getCmp(tabId).queryById('checkbox1').setValue(false);
            Ext.getCmp(tabId).queryById('lblCheck').show();
            Ext.getCmp(tabId).queryById('fieldset6').show();
            Ext.getCmp(tabId).queryById('fieldset5').hide();
            Ext.getCmp(tabId).queryById('_2char').setValue("");
            Ext.getCmp(tabId).queryById('_5char').setValue("");
        }
        Ext.getCmp(tabId).queryById('cboCarAccountTypes').clearValue();
        Ext.getCmp(tabId).queryById('cboCarAccountTypes').getStore().load({
            params: {
                cboCarMake: Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue()
            }
        });
        Ext.getCmp(tabId).queryById('cboYear').clearValue();
        Ext.getCmp(tabId).queryById('cboYear').getStore().load({
            params: {
                Noo: Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue()
            }
        });
        Ext.getCmp(tabId).queryById('cboShort').clearValue();
        Ext.getCmp(tabId).queryById('cboShort').getStore().load({
            params: {
                cboCarMake: Ext.getCmp(tabId).queryById('cboCarMakeNew').getDisplayValue()
            }
        });
        if (Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue() != "1") {
            Ext.getCmp(tabId).queryById('Image').setImageUrl("/Content/Blue.jpg");
        }
    }

    function setMaxMinValid() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('txtNationalCode').minLength = "10";
        Ext.getCmp(tabId).queryById('txtNationalCode').inputEl.set({ maxLength: 10 });
    }

    function GetPelak() {
        var tabId = App.SearchParvande.activeTab.id;
        txtNationalCode = Ext.getCmp(tabId).queryById('txtNationalCode');
        if (txtNationalCode.validate() == false) {
            Ext.getCmp(tabId).queryById('CboSh_Pelak').clearValue();
            Ext.getCmp(tabId).queryById('CboSh_Pelak').disable();
            Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText("");
        }
        else {
            if (Ext.getCmp(tabId).queryById('cboTypeOwner').getValue() == "1") {
                if (txtNationalCode.getValue().length == 10) {
                    App.AvarezWin.body.mask("لطفا منتظر باشید...");
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/CheckIsOwner',
                        params: {
                            NationalCode: txtNationalCode.getValue()
                        },
                        success: function (data) {
                            if (data.name != "") {/*مالک حقیقی ثبت شده*/
                                Ext.getCmp(tabId).queryById('btnNewOwner').disable();
                                Ext.getCmp(tabId).queryById('btnEditOwner').enable();
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').enable();
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').store.load({
                                    params: {
                                        NationalCode: txtNationalCode.getValue()
                                    }
                                });
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').expand();
                                Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText(data.name);
                                Ext.getCmp(tabId).queryById('MalekIDChange').setValue(data.MalekIDChange);

                                App.AvarezWin.body.mask().hide();
                            }
                            else {/*مالک حقیقی جدید*/
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SelectParvande/checks',
                                    params: {
                                        codec: txtNationalCode.getValue()
                                    },
                                    success: function (data) {
                                        if (data.data == 1) {
                                            Ext.getCmp(tabId).queryById('CboSh_Pelak').clearValue();
                                            Ext.getCmp(tabId).queryById('CboSh_Pelak').disable();
                                            Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText("");
                                            Ext.getCmp(tabId).queryById('btnNewOwner').enable();
                                            Ext.getCmp(tabId).queryById('btnEditOwner').disable();
                                            Ext.MessageBox.show({
                                                title: "",
                                                msg: "مالک مورد نظر در سیستم ثبت نشده است. لطفا جهت ثبت مالک روی دکمه اضافه کلیک نمایید.",
                                                icon: Ext.MessageBox.INFO,
                                                buttons: Ext.MessageBox.OK
                                            });
                                        }
                                        else {
                                            Ext.getCmp(tabId).queryById('CboSh_Pelak').clearValue();
                                            Ext.getCmp(tabId).queryById('CboSh_Pelak').disable();
                                            Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText("");
                                            Ext.getCmp(tabId).queryById('btnNewOwner').disable();
                                            Ext.getCmp(tabId).queryById('btnEditOwner').disable();
                                            Ext.MessageBox.show({
                                                title: "خطا",
                                                msg: "کد ملی وارد شده اشتباه است.",
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                        }
                                        App.AvarezWin.body.mask().hide();
                                    }
                                });
                            }
                        }

                    });
                }
            }
            else if (Ext.getCmp(tabId).queryById('cboTypeOwner').getValue() == "0") {
                if (txtNationalCode.getValue().length == 11 || txtNationalCode.getValue().length == 12) {
                    App.AvarezWin.body.mask("لطفا منتظر باشید...");
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/CheckIsOwner',
                        params: {
                            NationalCode: txtNationalCode.getValue()
                        },
                        success: function (data) {
                            if (data.name != "") {
                                Ext.getCmp(tabId).queryById('btnNewOwner').disable();
                                Ext.getCmp(tabId).queryById('btnEditOwner').enable();
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').enable();
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').store.load({
                                    params: {
                                        NationalCode: txtNationalCode.getValue()
                                    }
                                });
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').expand();
                                Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText(data.name);
                                Ext.getCmp(tabId).queryById('MalekIDChange').setValue(data.MalekIDChange);
                            }
                            else {
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').clearValue();
                                Ext.getCmp(tabId).queryById('txtNameFamilyMalek').setText("");
                                Ext.getCmp(tabId).queryById('CboSh_Pelak').disable();
                                Ext.getCmp(tabId).queryById('btnNewOwner').enable();
                                Ext.getCmp(tabId).queryById('btnEditOwner').disable();
                                Ext.MessageBox.show({
                                    title: "",
                                    msg: "مالک مورد نظر در سیستم ثبت نشده است. لطفا جهت ثبت مالک روی دکمه اضافه کلیک نمایید.",
                                    icon: Ext.MessageBox.INFO,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            App.AvarezWin.body.mask().hide();
                        }
                    });

                }
            }
        }
    }

    function GotoNewMalek_Pelak() {
        var tabId = App.SearchParvande.activeTab.id;
        var txtNationalCode = Ext.getCmp(tabId).queryById('txtNationalCode');
        var txtNationalCodeAtba = Ext.getCmp(tabId).queryById('txtNationalCodeAtba');
        var cboTypeOwner = Ext.getCmp(tabId).queryById('cboTypeOwner');
        var Code = "";
        if (cboTypeOwner.getValue() == "0" || cboTypeOwner.getValue() == "1") {
            if (txtNationalCode.validate() == false) {
                return;
            }
            Code = txtNationalCode.getValue();
        }
        else {
            if (txtNationalCodeAtba.validate() == false) {
                return;
            }
            Code = txtNationalCodeAtba.getValue();
        }
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/NewMalek_Pelak/Index',
            params: {
                NationalCode: Code,
                TypeMalek: cboTypeOwner.getValue(),
                State: "0",
                Malek: true,
                CarFileID: tabId.substring(14)
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function GotoEditMalek_Pelak() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboTypeOwner = Ext.getCmp(tabId).queryById('cboTypeOwner');
        if (cboTypeOwner.getValue() == "0" || cboTypeOwner.getValue() == "1") {
            txtNationalCode = Ext.getCmp(tabId).queryById('txtNationalCode');
            if (txtNationalCode.validate() == false) {
                return;
            }

            var currentcode = document.getElementById('"KCode"' + tabId.substring(14)).innerText;
            for (var i = 1; i < App.SearchParvande.tabBar.tabPanel.items.length; i++) {
                var tabsId = App.SearchParvande.tabBar.tabPanel.items.items[i].id;
                if (Ext.getCmp(tabsId).queryById("fldMalekId").getValue() == Ext.getCmp(tabId).queryById('MalekIDChange').getValue()
                    && tabId != tabsId) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "لطفا ابتدا پرونده(های) دیگر مربوط به مالک مورد نظر را بسته و سپس اقدام به ویرایش مالک نمایید.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
            }

            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/NewMalek_Pelak/Index',
                params: {
                    NationalCode: txtNationalCode.getValue(),
                    State: "1",
                    Malek: true,
                    CarFileID: tabId.substring(14),
                    TypeMalek: cboTypeOwner.getValue()
                },
                success: function () {
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
        else {
            txtNationalCodeAtba = Ext.getCmp(tabId).queryById('txtNationalCodeAtba');
            if (txtNationalCodeAtba.validate() == false) {
                return;
            }

            var currentcode = document.getElementById('"KCode"' + tabId.substring(14)).innerText;
            for (var i = 1; i < App.SearchParvande.tabBar.tabPanel.items.length; i++) {
                var tabsId = App.SearchParvande.tabBar.tabPanel.items.items[i].id;
                if (Ext.getCmp(tabsId).queryById("fldMalekId").getValue() == Ext.getCmp(tabId).queryById('MalekIDChange').getValue()
                    && tabId != tabsId) {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "لطفا ابتدا پرونده(های) دیگر مربوط به مالک مورد نظر را بسته و سپس اقدام به ویرایش مالک نمایید.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    return;
                }
            }

            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/NewMalek_Pelak/Index',
                params: {
                    NationalCode: txtNationalCodeAtba.getValue(),
                    State: "1",
                    Malek: true,
                    CarFileID: tabId.substring(14),
                    TypeMalek: 2
                },
                success: function () {
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
    }

    function setCboShort() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue() == "1") {
            Ext.getCmp(tabId).queryById('cboShort').setValue(Ext.getCmp(tabId).queryById('cboShort').store.getAt(0));
            ChangeShort();
        }
    }

    function loadCboCarCabin() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboCarCabin').clearValue();
        Ext.getCmp(tabId).queryById('cboCarCabin').getStore().load({
            params: {
                cboCarAccountTypes: Ext.getCmp(tabId).queryById('cboCarAccountTypes').getValue()
            }
        });
    }

    function loadCboSystem() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboSystem').clearValue();
        Ext.getCmp(tabId).queryById('cboSystem').getStore().load({
            params: {
                cboCarCabin: Ext.getCmp(tabId).queryById('cboCarCabin').getValue()
            }
        });
    }

    function loadCboModel() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboModel').clearValue();
        Ext.getCmp(tabId).queryById('cboModel').getStore().load({
            params: {
                cboSystem: Ext.getCmp(tabId).queryById('cboSystem').getValue()
            }
        });
    }

    function loadCboClass() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboClass').clearValue();
        Ext.getCmp(tabId).queryById('cboClass').getStore().load({
            params: {
                cboModel: Ext.getCmp(tabId).queryById('cboModel').getValue()
            }
        });
    }

    function setUpperCase(obj) {
        var tabId = App.SearchParvande.activeTab.id;
        if (obj == "txtShasi") {
            var txtShasi = Ext.getCmp(tabId).queryById('txtShasi');
            var _charShasi = Ext.getCmp(tabId).queryById('_charShasi');
            txtShasi.setValue(txtShasi.getValue().toUpperCase());
            chnageLag(txtShasi);
            var Shasi = txtShasi.getValue();
            _charShasi.setValue(Shasi.substr(Shasi.length - 6).toUpperCase());
        }
        else if (obj == 'txtMotor') {
            var txtMotor = Ext.getCmp(tabId).queryById('txtMotor');
            txtMotor.setValue(txtMotor.getValue().toUpperCase());
            chnageLag(txtMotor);
        }
    }

    function ChangeYear() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboYear = Ext.getCmp(tabId).queryById('cboYear');
        var _charModel = Ext.getCmp(tabId).queryById('_charModel');
        var cboCarMakeNew = Ext.getCmp(tabId).queryById('cboCarMakeNew');

        if (Ext.getCmp(tabId).queryById("fldPlaqueTypeName").getValue() == "ملی") {
            var Year = cboYear.getValue().toString();
            if (Year.length > 2 && Year.length == 4)
                _charModel.setValue(Year.substring(2));
            else
                _charModel.setValue('');
        }
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('txtDateY').getStore().getProxy().setExtraParam("year", cboYear.getValue());
        Ext.getCmp(tabId).queryById('txtDateY').getStore().getProxy().setExtraParam("Make", cboCarMakeNew.getValue());
        Ext.getCmp(tabId).queryById('txtDateY').store.load();
        Ext.net.DirectMethod.request({
            url: '/NewVer/Parvande/FillDateText',
            params: {
                year: cboYear.getValue()
            },
            success: function (result) {
                Ext.getCmp(tabId).queryById("txtDateY").setValue(result.date.substring(0, 4));
                Ext.getCmp(tabId).queryById("txtDateM").setValue(result.date.substring(5, 7));
                Ext.getCmp(tabId).queryById("txtDateD").setValue(result.date.substring(8, 10));
            }
        });
    }

    function checkDay2(DayID) {
        var tabId = App.SearchParvande.activeTab.id;
        var objectD2 = Ext.getCmp(tabId).queryById(DayID);
        if (objectD2.getValue() > 31) {
            objectD2.setValue("");
            Ext.MessageBox.show({
                title: "خطا",
                msg: "مقدار وارد شده معتبر نیست.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    function checkMonth2(MonthID) {
        var tabId = App.SearchParvande.activeTab.id;
        var objectM2 = Ext.getCmp(tabId).queryById(MonthID);
        if (objectM2.getValue() > 12) {
            objectM2.setValue("");
            Ext.MessageBox.show({
                title: "خطا",
                msg: "مقدار وارد شده معتبر نیست.",
                icon: Ext.MessageBox.ERROR,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    function Change_5char() {
        var tabId = App.SearchParvande.activeTab.id;
        var _5char = Ext.getCmp(tabId).queryById('_5char');
        _5char.setValue(_5char.getValue().toUpperCase());
        chnageLag(_5char);
    }

    function Change_2char() {
        var tabId = App.SearchParvande.activeTab.id;
        var _2char = Ext.getCmp(tabId).queryById('_2char');
        _2char.setValue(_2char.getValue().toUpperCase());
        chnageLag(_2char);
    }

    function getPic() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.get('"fi-button-msgB"' + tabId.substring(14)).update("");
        Ext.get('"fi-button-msgKart"' + tabId.substring(14)).update("");
        Ext.get('"fi-button-msgBKart"' + tabId.substring(14)).update("");
        Ext.get('"fi-button-msgSanad"' + tabId.substring(14)).update("");

        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/getPictures',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (data) {
                if (data.Er == 1) {
                    Ext.MessageBox.show({
                        title: data.MsgTitle,
                        msg: data.Msg,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    App.AvarezWin.body.mask().hide();
                }
                else {
                    Ext.getCmp(tabId).queryById('FileIdBarg').setValue(data.BargSabzFileId);
                    Ext.getCmp(tabId).queryById('FileIdBackKart').setValue(data.CartBackFileId);
                    Ext.getCmp(tabId).queryById('FileIdKart').setValue(data.CartFileId);
                    Ext.getCmp(tabId).queryById('FileIdSanad').setValue(data.SanadForoshFileId);

                    var panelheight = Ext.getCmp(tabId).queryById('pnlforEditPictures').getHeight();

                    valueBargSabz = "data:image/gif;base64," + data.ImgBargeSabz;
                    Ext.getCmp(tabId).queryById('BargeSabz').setImageUrl(valueBargSabz);
                    var newSize = scaleSize(panelheight - 148, panelheight - 148, data.width1, data.height1);
                    Ext.getCmp(tabId).queryById('BargeSabz').setSize(newSize[0], newSize[1]);

                    valueKart = "data:image/gif;base64," + data.ImageKart;
                    Ext.getCmp(tabId).queryById('Kart').setImageUrl(valueKart);
                    var newSize = scaleSize(panelheight - 148, panelheight - 148, data.width2, data.height2);
                    Ext.getCmp(tabId).queryById('Kart').setSize(newSize[0], newSize[1]);

                    valueBackKart = "data:image/gif;base64," + data.ImageBackKart;
                    Ext.getCmp(tabId).queryById('BackKart').setImageUrl(valueBackKart);
                    var newSize = scaleSize(panelheight - 148, panelheight - 148, data.width3, data.height3);
                    Ext.getCmp(tabId).queryById('BackKart').setSize(newSize[0], newSize[1]);

                    valueSanad = "data:image/gif;base64," + data.ImageSanad;
                    Ext.getCmp(tabId).queryById('Sanad').setImageUrl(valueSanad);
                    var newSize = scaleSize(panelheight - 148, panelheight - 148, data.width4, data.height4);
                    Ext.getCmp(tabId).queryById('Sanad').setSize(newSize[0], newSize[1]);
                    App.AvarezWin.body.mask().hide();
                }
            }
        });
    }

    function scaleSize(maxW, maxH, currW, currH) {

        var ratio = currH / currW;

        if (currW >= maxW & ratio <= 1) {
            currW = maxW;
            currH = currW * ratio;
        }
        else if (currH >= maxH) {
            currH = maxH;
            currW = currH / ratio;
        }

        return [currW, currH];
    }

    function LoadPropertyCar() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/Parvande/Details',
            params: {
                Id: tabId.substring(14)
            },
            success: function (data) {
                /*var fldIdCarFile = Ext.getCmp(tabId).queryById('fldIdCarFile');
                fldIdCarFile.setValue(data.fldId);

                var fldCarId = Ext.getCmp(tabId).queryById('fldCarId');
                fldCarId.setValue(data.fldCarID);

                var fldCarPlaqueID = Ext.getCmp(tabId).queryById('fldCarPlaqueID');
                fldCarPlaqueID.setValue(data.fldCarPlaqueID);*/

                var cboCarMakeNew = Ext.getCmp(tabId).queryById('cboCarMakeNew');
                cboCarMakeNew.setValue(data.CarMake);

                if (data.CarMake != 1) {/*وارداتی*/
                    Ext.getCmp(tabId).queryById('checkbox1').hide();
                    Ext.getCmp(tabId).queryById('lblCheck').hide();
                }

                var cboCarAccountTypes = Ext.getCmp(tabId).queryById('cboCarAccountTypes');
                cboCarAccountTypes.clearValue();
                cboCarAccountTypes.getStore().load({
                    params: {
                        cboCarMake: Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue()
                    }
                });
                cboCarAccountTypes.setValue(data.CarAccountId);

                var cboCarCabin = Ext.getCmp(tabId).queryById('cboCarCabin');
                cboCarCabin.clearValue();
                cboCarCabin.getStore().load({
                    params: {
                        cboCarAccountTypes: Ext.getCmp(tabId).queryById('cboCarAccountTypes').getValue()
                    }
                });
                cboCarCabin.setValue(data.CabinTypeId);

                var cboSystem = Ext.getCmp(tabId).queryById('cboSystem');
                cboSystem.clearValue();
                cboSystem.getStore().load({
                    params: {
                        cboCarCabin: Ext.getCmp(tabId).queryById('cboCarCabin').getValue()
                    }
                });
                cboSystem.setValue(data.CarSystemId);

                var cboModel = Ext.getCmp(tabId).queryById('cboModel');
                cboModel.clearValue();
                cboModel.getStore().load({
                    params: {
                        cboSystem: Ext.getCmp(tabId).queryById('cboSystem').getValue()
                    }
                });
                cboModel.setValue(data.CarModelId);

                var cboClass = Ext.getCmp(tabId).queryById('cboClass');
                cboClass.clearValue();
                cboClass.getStore().load({
                    params: {
                        cboModel: Ext.getCmp(tabId).queryById('cboModel').getValue()
                    }
                });
                cboClass.setValue(data.CarClassId);

                /*if (data.fldMotabeghBaShasi == 0) {/*عدم تطابق شاسی با VIN*/
                var cboShort = Ext.getCmp(tabId).queryById('cboShort');
                cboShort.clearValue();
                cboShort.getStore().load({
                    params: {
                        cboCarMake: Ext.getCmp(tabId).queryById('cboCarMakeNew').getDisplayValue()
                    }
                });
                /*}*/

                if (Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue() != "1") {
                    cboShort.setValue(data.sumbolid);
                    var value = "data:image/gif;base64," + data.ShortIcon;
                    Ext.getCmp(tabId).queryById('Image').setImageUrl(value);
                }

                var txtMotor = Ext.getCmp(tabId).queryById('txtMotor');
                txtMotor.setValue(data.fldMotorNumber);

                var txtShasi = Ext.getCmp(tabId).queryById('txtShasi');
                txtShasi.setValue(data.fldShasiNumber);

                var cboColor = Ext.getCmp(tabId).queryById('cboColor');
                cboColor.setValue(data.fldCarColorID);

                var cboYear = Ext.getCmp(tabId).queryById('cboYear');
                cboYear.clearValue();
                cboYear.getStore().load({
                    params: {
                        Noo: Ext.getCmp(tabId).queryById('cboCarMakeNew').getValue()
                    }
                });
                cboYear.setValue(data.fldModel);

                var txtDateY = Ext.getCmp(tabId).queryById('txtDateY');
                Ext.getCmp(tabId).queryById('txtDateY').getStore().getProxy().setExtraParam("year", cboYear.getValue());
                Ext.getCmp(tabId).queryById('txtDateY').getStore().getProxy().setExtraParam("Make", cboCarMakeNew.getValue());
                Ext.getCmp(tabId).queryById('txtDateY').store.load();
                txtDateY.setValue(data.fldStartDateInsurance.substring(0, 4));

                var txtDateM = Ext.getCmp(tabId).queryById('txtDateM');
                txtDateM.setValue(data.fldStartDateInsurance.substring(5, 7));

                var txtDateD = Ext.getCmp(tabId).queryById('txtDateD');
                txtDateD.setValue(data.fldStartDateInsurance.substring(8, 10));

                if (data.fldMotabeghBaShasi == 0) {/*عدم تطابق شاسی با VIN*/
                    var _charShasi = Ext.getCmp(tabId).queryById('_charShasi');
                    _charShasi.setValue(data.VIN.substring(11));

                    var _5char = Ext.getCmp(tabId).queryById('_5char');
                    _5char.setValue(data.VIN.substr(6, 5));

                    var _2char = Ext.getCmp(tabId).queryById('_2char');
                    _2char.setValue(data.VIN.substr(2, 2));

                    Ext.getCmp(tabId).queryById('fieldset5').hide();
                    Ext.getCmp(tabId).queryById('fieldset6').show();

                    var _charModel = Ext.getCmp(tabId).queryById('_charModel');
                    _charModel.setValue(data.VIN.substr(4, 2));
                }
                else {
                    var _charModel = Ext.getCmp(tabId).queryById('_charModel');
                    _charModel.setValue(data.fldModel.substr(2, 2));
                }

                /*else {
                    Ext.getCmp(tabId).queryById('fieldset5').show();
                    Ext.getCmp(tabId).queryById('fieldset6').hide();
                    var txtVinMatchShasi = Ext.getCmp(tabId).queryById('txtVinMatchShasi');
                    txtVinMatchShasi.setValue(data.VIN);
                }*/

                var checkbox1 = Ext.getCmp(tabId).queryById('checkbox1');
                checkbox1.setValue(data.fldMotabeghBaShasi);

                Ext.getCmp(tabId).queryById('fldPlaqueTypeName').setValue(data.fldPlaqueTypeName);

                var CboPelakTypeEntezami = Ext.getCmp(tabId).queryById('CboPelakTypeEntezami');
                CboPelakTypeEntezami.setValue(data.fldTypeEntezami);


                if (data.fldPlaqueTypeName != "ملی") {
                    /*_charShasi.setReadOnly(true);*/
                    _5char.minLength = "";
                    _2char.minLength = "";
                    /*char5.disable();*/
                }
                else {
                    _5char.minLength = "5";
                    _2char.minLength = "2";
                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ChangeShort() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboShort = Ext.getCmp(tabId).queryById('cboShort');
        var url = '/NewVer/Parvande/Image';
        var g = url + '?id=' + cboShort.getValue();
        var k = Ext.getCmp(tabId).queryById('Image');
        k.setImageUrl(g);
    }

    function SavePropertyCar() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboSystem = Ext.getCmp(tabId).queryById('cboSystem');
        var CboPelakTypeEntezami = Ext.getCmp(tabId).queryById('CboPelakTypeEntezami');
        var cboCarCabin = Ext.getCmp(tabId).queryById('cboCarCabin');
        var cboCarAccountTypes = Ext.getCmp(tabId).queryById('cboCarAccountTypes');
        var cboCarMakeNew = Ext.getCmp(tabId).queryById('cboCarMakeNew');
        var _5char = Ext.getCmp(tabId).queryById('_5char');
        var _2char = Ext.getCmp(tabId).queryById('_2char');
        var cboShort = Ext.getCmp(tabId).queryById('cboShort');
        var _charShasi = Ext.getCmp(tabId).queryById('_charShasi');
        var _charModel = Ext.getCmp(tabId).queryById('_charModel');
        var cboClass = Ext.getCmp(tabId).queryById('cboClass');
        var cboModel = Ext.getCmp(tabId).queryById('cboModel');
        var txtMotor = Ext.getCmp(tabId).queryById('txtMotor');
        var txtShasi = Ext.getCmp(tabId).queryById('txtShasi');
        var cboColor = Ext.getCmp(tabId).queryById('cboColor');
        var cboYear = Ext.getCmp(tabId).queryById('cboYear');
        var txtDateY = Ext.getCmp(tabId).queryById('txtDateY');
        var txtDateD = Ext.getCmp(tabId).queryById('txtDateD');
        var txtDateM = Ext.getCmp(tabId).queryById('txtDateM');
        var Id = Ext.getCmp(tabId).queryById('fldIdEditCar');
        var fldCarId = Ext.getCmp(tabId).queryById('fldCarId');
        var CboAzSal = Ext.getCmp(tabId).queryById('CboAzSal');
        var checkbox1 = Ext.getCmp(tabId).queryById('checkbox1');
        var txtVinMatchShasi = Ext.getCmp(tabId).queryById('txtVinMatchShasi');

        var er = false;

        if (cboSystem.validate() == false) {
            er = true;
        }
        if (cboCarAccountTypes.validate() == false) {
            er = true;
        }
        if (cboCarMakeNew.validate() == false) {
            er = true;
        }
        if (cboCarCabin.validate() == false) {
            er = true;
        }
        if (checkbox1.getValue() == false) {
            if (_5char.validate() == false) {
                er = true;
            }
            if (_2char.validate() == false) {
                er = true;
            }
            if (cboShort.validate() == false) {
                er = true;
            }
            if (_charShasi.validate() == false) {
                er = true;
            }
            if (_charModel.validate() == false) {
                er = true;
            }
        }
        if (cboClass.validate() == false) {
            er = true;
        }
        if (cboModel.validate() == false) {
            er = true;
        }
        if (txtMotor.validate() == false) {
            er = true;
        }
        if (txtShasi.validate() == false) {
            er = true;
        }
        if (cboColor.validate() == false) {
            er = true;
        }
        if (cboYear.validate() == false) {
            er = true;
        }
        if (txtDateD.validate() == false) {
            er = true;
        }
        if (txtDateM.validate() == false) {
            er = true;
        }

        if (Ext.getCmp(tabId).queryById('fldPlaqueTypeName') == "ملی") {
            if (_5char.getValue().length < 5) {
                alert('کد وارد شده کمتر از 5 رقم می باشد.');
                er = true;
            }
            else if (_2char.getValue().length < 2) {
                alert('کد وارد شده کمتر از 2 رقم می باشد.');
                er = true;
            }
        }

        if (er == true)
            return;

        if (checkbox1.getValue() == false) {
            var drop = cboShort.getDisplayValue();
            var vin = drop + _2char.getValue() + _charModel.getValue() + _5char.getValue() + _charShasi.getValue();
            if (vin.length < 17 && CboPelakTypeEntezami.getValue() == "1") {
                vin = '';
            }
            else if (vin.length < 17 && CboPelakTypeEntezami.getValue() == "0") {/*پلاک انتظامی*/
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "لطفا VIN را وارد نمایید.",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
                return;
            }
        }
        else {
            vin = txtVinMatchShasi.getValue();
        }
        var DateM = txtDateM.getValue();
        var DateD = txtDateD.getValue();
        if (DateM.length < 2)
            DateM = 0 + txtDateM.getValue();
        if (DateD.length < 2)
            DateD = 0 + txtDateD.getValue();

        var PelakTypeEntezami = false;
        if (CboPelakTypeEntezami.getValue() == "0")
            PelakTypeEntezami = true;

        if (vin != "") {
            App.AvarezWin.body.mask("در حال ذخیره سازی...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/Parvande/CheckVIN',
                params: {
                    Id: fldCarId.getValue(),
                    VIN: vin
                },
                success: function (data) {
                    if (data.Er == "0") {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/Parvande/CheckMotorNumber',
                            params: {
                                Id: fldCarId.getValue(),
                                CarSystem: cboSystem.getValue(),
                                fldMotorNumber: txtMotor.getValue()
                            },
                            success: function (data2) {
                                if (data2.Er == "0") {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/Parvande/Update',
                                        params: {
                                            carFileID: tabId.substring(14),
                                            fldId: fldCarId.getValue(),
                                            fldCarPlaqueID: null,
                                            fldUserID: 1,
                                            fldTypeEntezami: PelakTypeEntezami,
                                            fldMotorNumber: txtMotor.getValue(),
                                            fldShasiNumber: txtShasi.getValue(),
                                            fldVIN: vin,
                                            fldCarModelID: cboModel.getValue(),
                                            fldCarClassID: cboClass.getValue(),
                                            fldCarColorID: cboColor.getValue(),
                                            fldModel: cboYear.getValue(),
                                            fldStartDateInsurance: txtDateY.getValue() + "/" + DateM + "/" + DateD,
                                            fldDesc: "",
                                            carMake: cboCarMakeNew.getValue(),
                                            Match: checkbox1.getValue()
                                        },
                                        success: function (data) {
                                            var ic = Ext.MessageBox.INFO;
                                            if (data.Er == 1)
                                                ic = Ext.MessageBox.ERROR;
                                            Ext.MessageBox.show({
                                                title: data.MsgTitle,
                                                msg: data.Msg,
                                                icon: ic,
                                                buttons: Ext.MessageBox.OK
                                            });
                                            if (data.Er != 1) {
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/Fill',
                                                    params: {
                                                        CarFileId: tabId.substring(14)
                                                    },
                                                    success: function (data1) {
                                                        document.getElementById('"KName"' + tabId.substring(14)).innerText = data1.Malek;
                                                        document.getElementById('"KCode"' + tabId.substring(14)).innerText = data1.CodeMeli;
                                                        document.getElementById('"KVIN"' + tabId.substring(14)).innerText = data1.vin;
                                                        document.getElementById('"KPelak1"' + tabId.substring(14)).innerText = data1.fldPlaqueCityName;
                                                        document.getElementById('"KPelak2"' + tabId.substring(14)).innerText = data1.fldPlaqueSerial;
                                                        document.getElementById('"KPelak3"' + tabId.substring(14)).innerText = data1.fldCarPlaqueNumber;
                                                        document.getElementById('"KNo"' + tabId.substring(14)).innerText = data1.account;
                                                        document.getElementById('"KSystem"' + tabId.substring(14)).innerText = data1.syst;
                                                        document.getElementById('"KTip"' + tabId.substring(14)).innerText = data1.modell;
                                                        document.getElementById('"KRang"' + tabId.substring(14)).innerText = data1.color;
                                                        document.getElementById('"KModel"' + tabId.substring(14)).innerText = data1.year;
                                                        document.getElementById('"KSukht"' + tabId.substring(14)).innerText = data1.fldFuelType;
                                                        document.getElementById('"KMotor"' + tabId.substring(14)).innerText = data1.motor;
                                                        document.getElementById('"KShasi"' + tabId.substring(14)).innerText = data1.shasi;
                                                        document.getElementById('"mobile"' + tabId.substring(14)).innerText = "موبایل: " + data1.mobile;
                                                        document.getElementById('"KTedad"' + tabId.substring(14)).innerText = data1.fldCylinder_Wheel_Pivot;

                                                        /*var MenuBill1 = Ext.getCmp("MenuBill" + tabId.substring(14));
                                                        MenuBill1.removeAll();
                                                        for (var i = parseInt(data1.currentyear) ; i > parseInt(data1.shamsiYear) - 1; i--) {
                                                            var menuItem = Ext.create('Ext.menu.Item', {
                                                                itemId: i,
                                                                text: i,
                                                                handler: function (fieldd) {
                                                                    Ext.getCmp(tabId).queryById('yearoftax').setValue(fieldd.text);
                                                                    ShowPnlBill(fieldd.text);
                                                                }
                                                            });
                                                            MenuBill1.add(menuItem);
                                                        }*/

                                                        var html = "کد ملی:" + data1.CodeMeli + "</br>VIN:" + data1.vin + "</br>شماره پلاک:" + data1.plaq + "</br>شماره موتور:" + data1.motor +
                                                            "</br>شماره شاسی:" + data1.shasi + "</br>نوع ساخت:" + data1.make + "</br>نوع کاربری:" + data1.account + "</br>نوع کابین:" + data1.cabin + "</br>سیستم خودرو:" + data1.syst + "</br>تیپ خودرو:" +
                                                            data1.modell + "</br>کلاس خودرو" + data1.classs + "</brرنگ خودرو:>" + data1.color + "</br>سال تولید:" + data1.year +
                                                            "</br>تاریخ پلاک گذاری:" + data1.datep + "</br>تاریخ اولین بیمه:" + data1.date;
                                                        Ext.create('Ext.tip.ToolTip', {
                                                            target: Ext.getCmp(tabId).tab,
                                                            anchorToTarget: true,
                                                            anchorOffset: 25,
                                                            anchorSize: {
                                                                width: 58,
                                                                height: 20
                                                            },
                                                            anchor: 'top',
                                                            closable: false,
                                                            dismissDelay: 0,
                                                            baseCls: 'ifs-tooltip',
                                                            shadow: false,
                                                            autoHide: true,
                                                            showDelay: 0,
                                                            html: html
                                                        });
                                                        App.GridSearch.store.load();
                                                    }
                                                });
                                                CboAzSal.store.load({
                                                    params: {
                                                        CarFileId: tabId.substring(14)
                                                    }
                                                })
                                            }
                                            Ext.get('"fi-button-msgB"' + tabId.substring(14)).update("");
                                            Ext.get('"fi-button-msgKart"' + tabId.substring(14)).update("");
                                            Ext.get('"fi-button-msgBKart"' + tabId.substring(14)).update("");
                                            Ext.get('"fi-button-msgSanad"' + tabId.substring(14)).update("");
                                            App.AvarezWin.body.mask().hide();
                                        }
                                    });
                                }
                                else {
                                    Ext.MessageBox.show({
                                        Name: data2.MsgTitle,
                                        msg: data2.Msg,
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                            }
                        });
                    }
                    else {
                        Ext.MessageBox.show({
                            Name: data.MsgTitle,
                            msg: data.Msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                }
            });
        }
        else {
            App.AvarezWin.body.mask("در حال ذخیره سازی...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/Parvande/CheckMotorNumber',
                params: {
                    Id: fldCarId.getValue(),
                    CarSystem: cboSystem.getValue(),
                    fldMotorNumber: txtMotor.getValue()
                },
                success: function (data2) {
                    if (data2.Er == "0") {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/Parvande/Update',
                            params: {
                                carFileID: tabId.substring(14),
                                fldId: fldCarId.getValue(),
                                fldCarPlaqueID: null,
                                fldUserID: 1,
                                fldMotorNumber: txtMotor.getValue(),
                                fldShasiNumber: txtShasi.getValue(),
                                fldVIN: vin,
                                fldTypeEntezami: PelakTypeEntezami,
                                fldCarModelID: cboModel.getValue(),
                                fldCarClassID: cboClass.getValue(),
                                fldCarColorID: cboColor.getValue(),
                                fldModel: cboYear.getValue(),
                                fldStartDateInsurance: txtDateY.getValue() + "/" + DateM + "/" + DateD,
                                fldDesc: "",
                                Match: checkbox1.getValue()
                            },
                            success: function (data) {
                                var ic = Ext.MessageBox.INFO;
                                if (data.Er == 1)
                                    ic = Ext.MessageBox.ERROR;
                                Ext.MessageBox.show({
                                    title: data.MsgTitle,
                                    msg: data.Msg,
                                    icon: ic,
                                    buttons: Ext.MessageBox.OK
                                });
                                if (data.Er != 1) {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/SelectParvande/Fill',
                                        params: {
                                            CarFileId: tabId.substring(14)
                                        },
                                        success: function (data1) {
                                            document.getElementById('"KName"' + tabId.substring(14)).innerText = data1.Malek;
                                            document.getElementById('"KCode"' + tabId.substring(14)).innerText = data1.CodeMeli;
                                            document.getElementById('"KVIN"' + tabId.substring(14)).innerText = data1.vin;
                                            document.getElementById('"KPelak1"' + tabId.substring(14)).innerText = data1.fldPlaqueCityName;
                                            document.getElementById('"KPelak2"' + tabId.substring(14)).innerText = data1.fldPlaqueSerial;
                                            document.getElementById('"KPelak3"' + tabId.substring(14)).innerText = data1.fldCarPlaqueNumber;
                                            document.getElementById('"KNo"' + tabId.substring(14)).innerText = data1.account;
                                            document.getElementById('"KSystem"' + tabId.substring(14)).innerText = data1.syst;
                                            document.getElementById('"KTip"' + tabId.substring(14)).innerText = data1.modell;
                                            document.getElementById('"KRang"' + tabId.substring(14)).innerText = data1.color;
                                            document.getElementById('"KModel"' + tabId.substring(14)).innerText = data1.year;
                                            document.getElementById('"KSukht"' + tabId.substring(14)).innerText = data1.fldFuelType;
                                            document.getElementById('"KMotor"' + tabId.substring(14)).innerText = data1.motor;
                                            document.getElementById('"KShasi"' + tabId.substring(14)).innerText = data1.shasi;
                                            document.getElementById('"mobile"' + tabId.substring(14)).innerText = "موبایل: " + data1.mobile;
                                            document.getElementById('"KTedad"' + tabId.substring(14)).innerText = data1.fldCylinder_Wheel_Pivot;
                                            /*var MenuBill1 = Ext.getCmp("MenuBill" + tabId.substring(14));
                                            MenuBill1.removeAll();
                                            for (var i = parseInt(data1.currentyear) ; i > parseInt(data1.shamsiYear) - 1; i--) {
                                                var menuItem = Ext.create('Ext.menu.Item', {
                                                    itemId: i,
                                                    text: i,
                                                    handler: function (fieldd) {
                                                        Ext.getCmp(tabId).queryById('yearoftax').setValue(fieldd.text);
                                                        ShowPnlBill(fieldd.text);
                                                    }
                                                });
                                                MenuBill1.add(menuItem);
                                            }*/

                                            var html = "کد ملی:" + data1.CodeMeli + "</br>VIN:" + data1.vin + "</br>شماره پلاک:" + data1.plaq + "</br>شماره موتور:" + data1.motor +
                                                "</br>شماره شاسی:" + data1.shasi + "</br>نوع ساخت:" + data1.make + "</br>نوع کاربری:" + data1.account + "</br>نوع کابین:" + data1.cabin + "</br>سیستم خودرو:" + data1.syst + "</br>تیپ خودرو:" +
                                                data1.modell + "</br>کلاس خودرو" + data1.classs + "</brرنگ خودرو:>" + data1.color + "</br>سال تولید:" + data1.year +
                                                "</br>تاریخ پلاک گذاری:" + data1.datep + "</br>تاریخ اولین بیمه:" + data1.date;
                                            Ext.create('Ext.tip.ToolTip', {
                                                target: Ext.getCmp(tabId).tab,
                                                anchorToTarget: true,
                                                anchorOffset: 25,
                                                anchorSize: {
                                                    width: 58,
                                                    height: 20
                                                },
                                                anchor: 'top',
                                                closable: false,
                                                dismissDelay: 0,
                                                baseCls: 'ifs-tooltip',
                                                shadow: false,
                                                autoHide: true,
                                                showDelay: 0,
                                                html: html
                                            });
                                            App.GridSearch.store.load();
                                        }
                                    });
                                }
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                    }
                    else {
                        Ext.MessageBox.show({
                            Name: data2.MsgTitle,
                            msg: data2.Msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                }
            });
        }
    }

    function SearchMun(value) {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/MunicipalitySearch?State=' + value,
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function SaveEnteghalSavabegh() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboState = Ext.getCmp(tabId).queryById('cboState');
        var cboMun = Ext.getCmp(tabId).queryById('cboMun');
        var CboAzSal = Ext.getCmp(tabId).queryById('CboAzSal');
        var CboTaSal = Ext.getCmp(tabId).queryById('CboTaSal');
        var txtShName = Ext.getCmp(tabId).queryById('txtShName');
        var IdSavabegh = Ext.getCmp(tabId).queryById('fldIdSavabegh');
        var FileIdSavabegh = Ext.getCmp(tabId).queryById('fldFileIdSavabegh');
        var txtDesc = Ext.getCmp(tabId).queryById('txtDesc');

        var er = false;

        if (cboState.validate() == false) {
            er = true;
        }
        if (cboMun.validate() == false) {
            er = true;
        }
        if (CboAzSal.validate() == false) {
            er = true;
        }
        if (CboTaSal.validate() == false) {
            er = true;
        }
        if (txtShName.validate() == false) {
            er = true;
        }

        if (Ext.getCmp(tabId).queryById("GridSavabegh").store.count() > 0) {
            for (var i = 0; i < Ext.getCmp(tabId).queryById("GridSavabegh").store.count() ; i++) {
                if (Ext.getCmp(tabId).queryById("fldIdSavabegh").getValue() == 0) {
                    var inf = Ext.getCmp(tabId).queryById("GridSavabegh").store.data.items[i];
                    if (CboAzSal.getValue() >= inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() <= inf.data.fldEndDate.substring(0, 4)
                        || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() <= inf.data.fldEndDate.substring(0, 4)
                        || CboAzSal.getValue() >= inf.data.fldStartDate.substring(0, 4) && CboAzSal.getValue() < inf.data.fldEndDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)
                        || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)
                        || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() == inf.data.fldStartDate.substring(0, 4)
                        || CboAzSal.getValue() == inf.data.fldEndDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "در محدوده " + CboAzSal.getValue() + " تا  " + CboTaSal.getValue() + "سوابق دیگری ثبت شده است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        er = true;
                        CboTaSal.setValue("");
                        CboAzSal.setValue("");
                    }
                }
                else {
                    var inf = Ext.getCmp(tabId).queryById("GridSavabegh").store.data.items[i];
                    if (Ext.getCmp(tabId).queryById("fldIdSavabegh").getValue() != inf.data.fldID)
                        if (CboAzSal.getValue() >= inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() <= inf.data.fldEndDate.substring(0, 4)
                            || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() <= inf.data.fldEndDate.substring(0, 4)
                            || CboAzSal.getValue() >= inf.data.fldStartDate.substring(0, 4) && CboAzSal.getValue() < inf.data.fldEndDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)
                            || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)
                            || CboAzSal.getValue() < inf.data.fldStartDate.substring(0, 4) && CboTaSal.getValue() == inf.data.fldStartDate.substring(0, 4)
                            || CboAzSal.getValue() == inf.data.fldEndDate.substring(0, 4) && CboTaSal.getValue() > inf.data.fldEndDate.substring(0, 4)) {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "در محدوده " + CboAzSal.getValue() + "تا" + CboTaSal.getValue() + "سوابق دیگری ثبت شده است.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                            er = true;
                            CboTaSal.setValue("");
                            CboAzSal.setValue("");
                        }
                }
            }
        }


        if (er == true)
            return;

        App.AvarezWin.body.mask('در حال ذخیره سازی...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/SaveSavabegh',
            params: {
                fldCarFileID: App.SearchParvande.activeTab.id.substring(14),
                fldId: IdSavabegh.getValue(),
                fldMunicipalityID: cboMun.getValue(),
                fldFromYear: CboAzSal.getValue(),
                fldToYear: CboTaSal.getValue(),
                fldLetterNumber: txtShName.getValue(),
                fldFileId: FileIdSavabegh.getValue(),
                fldDesc: txtDesc.getValue()
            },
            success: function (data) {
                var ic = Ext.MessageBox.INFO;
                if (data.Err == 1)
                    ic = Ext.MessageBox.ERROR;
                Ext.MessageBox.show({
                    title: data.MsgTitle,
                    msg: data.Msg,
                    icon: ic,
                    buttons: Ext.MessageBox.OK
                });
                if (data.Err != 1) {
                    ReloadGridSavabegh();
                    ClearEnteghalSavabegh();
                }
                else {
                    var elId = '"fi-button-msg"' + tabId.substring(14);
                    var el = Ext.get(elId);
                    Ext.get(el).update("");
                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ClearEnteghalSavabegh() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboState').setValue("");
        Ext.getCmp(tabId).queryById('cboMun').setValue("");
        Ext.getCmp(tabId).queryById('CboTaSal').setValue("");
        Ext.getCmp(tabId).queryById('CboAzSal').setValue("");
        Ext.getCmp(tabId).queryById('txtShName').setValue("");
        Ext.getCmp(tabId).queryById('txtDesc').setValue("");
        Ext.getCmp(tabId).queryById('fldIdSavabegh').setValue(0);
        Ext.getCmp(tabId).queryById('fldFileIdSavabegh').setValue(0);
        var elId = '"fi-button-msg"' + tabId.substring(14);
        var el = Ext.get(elId);
        Ext.get(el).update("");
    }

    function ClearBlackList() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('cboType').setValue("");
        Ext.getCmp(tabId).queryById('txtMsg').setValue("");
        Ext.getCmp(tabId).queryById('fldIdBlackList').setValue(0);
    }

    function ActiononSavabegh(grid, command, record, row) {
        var tabId = App.SearchParvande.activeTab.id;
        if (command == 'EditSavabegh') {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
            Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
            Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
            Ext.getCmp(tabId).queryById("pnlforVarizi").hide();
            Ext.getCmp(tabId).queryById("pnlforBill").hide();
            Ext.getCmp(tabId).queryById("GridSavabegh").setHeight(App.AvarezWin.height - 350);
            Ext.getCmp(tabId).queryById("GridVarizi").hide();
            Ext.getCmp(tabId).queryById("GridPeacockery").hide();
            Ext.getCmp(tabId).queryById("GridBlackList").hide();
            Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
            Ext.getCmp(tabId).queryById("pnlforSavabegh").show();
            Ext.getCmp(tabId).queryById("GridSavabegh").show();
            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/CheckTaiidSavabegh',
                params: {
                    Id: record.data.fldID
                },
                success: function (data1) {
                    if (!data1.HaveTaiid || data1.userId == "1") {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/getDetailSavabegh',
                            params: {
                                Id: record.data.fldID
                            },
                            success: function (data) {
                                if (data.Er != 1) {
                                    var cboState = Ext.getCmp(tabId).queryById('cboState');
                                    cboState.setValue(data.fldStateId);
                                    var cboMun = Ext.getCmp(tabId).queryById('cboMun');
                                    cboMun.clearValue(); cboMun.getStore().load({
                                        params: {
                                            cboState: Ext.getCmp(tabId).queryById('cboState').getValue()
                                        }
                                    });
                                    cboMun.setValue(data.fldMunID);
                                    var CboAzSal = Ext.getCmp(tabId).queryById('CboAzSal');
                                    CboAzSal.setValue(data.fldFromYear);
                                    var CboTaSal = Ext.getCmp(tabId).queryById('CboTaSal');
                                    CboTaSal.clearValue(); CboTaSal.getStore().load({
                                        params: {
                                            StartYear: Ext.getCmp(tabId).queryById('CboAzSal').getValue()
                                        }
                                    });
                                    CboTaSal.setValue(data.fldToYear);
                                    var txtShName = Ext.getCmp(tabId).queryById('txtShName');
                                    txtShName.setValue(data.fldLetterNumber);
                                    var fldIdSavabegh = Ext.getCmp(tabId).queryById('fldIdSavabegh');
                                    fldIdSavabegh.setValue(data.fldId);
                                    var fldFileIdSavabegh = Ext.getCmp(tabId).queryById('fldFileIdSavabegh');
                                    fldFileIdSavabegh.setValue(data.fldFileId);
                                    var txtDesc = Ext.getCmp(tabId).queryById('txtDesc');
                                    txtDesc.setValue(data.fldDesc);
                                }
                                else {
                                    Ext.MessageBox.show({
                                        title: data.MsgTitle,
                                        msg: data.Msg,
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                }
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                    }
                    else {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "سابقه موردنظر تایید شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                }
            });
        }
        else if (command == 'DeleteSavabegh') {
            Ext.MessageBox.show({
                title: "هشدار",
                msg: "آیا برای حذف مطمئن هستید؟",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.YESNO,
                fn: function (btn) {
                    if (btn == 'yes') {
                        App.AvarezWin.body.mask("در حال انجام عملیات...");
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/DeleteSavabegh',
                            params: {
                                Id: record.data.fldID
                            },
                            success: function (data) {
                                var ic = Ext.MessageBox.INFO;
                                if (data.Er == 1)
                                    ic = Ext.MessageBox.ERROR;
                                Ext.MessageBox.show({
                                    title: data.MsgTitle,
                                    msg: data.Msg,
                                    icon: ic,
                                    buttons: Ext.MessageBox.OK
                                });
                                ReloadGridSavabegh();
                                if (record.data.fldID == Ext.getCmp(tabId).queryById('fldIdSavabegh').getValue()) {
                                    ClearEnteghalSavabegh();
                                }
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                    }
                }
            });
        }
    }

    function ActiononVarizi(grid, command, record, row) {
        /*test*/
        var tabId = App.SearchParvande.activeTab.id;
        if (command == 'EditVarizi') {
            var tabId = App.SearchParvande.activeTab.id;
            Ext.getCmp(tabId).queryById("pnlforBlackList").hide();
            Ext.getCmp(tabId).queryById("pnlforEditPictures").hide();
            Ext.getCmp(tabId).queryById("pnlforEditCar").hide();
            Ext.getCmp(tabId).queryById("pnlforBill").hide();
            Ext.getCmp(tabId).queryById("pnlforSavabegh").hide();
            Ext.getCmp(tabId).queryById("GridSavabegh").hide();
            Ext.getCmp(tabId).queryById("GridBlackList").hide();
            Ext.getCmp(tabId).queryById("pnlforChangeOwner").hide();
            Ext.getCmp(tabId).queryById("pnlforVarizi").show();
            Ext.getCmp(tabId).queryById("GridVarizi").show();
            Ext.getCmp(tabId).queryById("GridPeacockery").show();
            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/CheckTaiidPardakhtha',
                params: {
                    Id: record.data.fldID
                },
                success: function (data1) {
                    if (!data1.HaveTaiid || data1.userId == "1") {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/getDetailVarizi',
                            params: {
                                Id: record.data.fldID
                            },
                            success: function (data) {
                                if (data.Er != 1) {
                                    Ext.getCmp(tabId).queryById("cboNoePardakht").setValue(data.fldPayType);
                                    Ext.getCmp(tabId).queryById("fldIdVarizi").setValue(data.fldId);
                                    Ext.getCmp(tabId).queryById("txtDateVariz").setValue(data.fldCollectionDate);
                                    Ext.getCmp(tabId).queryById("txtPrice").setValue(data.fldPrice);
                                    Ext.getCmp(tabId).queryById("txtSerialLable").setValue(data.fldSerialBarChasb);
                                    Ext.getCmp(tabId).queryById("txtDescV").setValue(data.fldDesc);
                                    Ext.getCmp(tabId).queryById("CboNoeVariz").setValue(data.fldSettleTypeID);
                                    Ext.getCmp(tabId).queryById("fldFileIdVarizi").setValue(data.fldFileId);
                                    Ext.getCmp(tabId).queryById("fldIdMunVarizi").setValue(data.fldMunId);

                                    var cboNoePardakht = Ext.getCmp(tabId).queryById('cboNoePardakht');
                                    if (cboNoePardakht.getValue() == "1") {
                                        Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 342) / 2);
                                        Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 342) / 2);
                                        Ext.getCmp(tabId).queryById('txtSerial').show();
                                        Ext.getCmp(tabId).queryById('lblSerial').show();
                                        Ext.getCmp(tabId).queryById("txtSerial").setValue(data.fldPeacockeryCode);
                                        Ext.getCmp(tabId).queryById('txtMun').hide();
                                        Ext.getCmp(tabId).queryById('lblMun').hide();
                                        Ext.getCmp(tabId).queryById('txtSerialFish').hide();
                                        Ext.getCmp(tabId).queryById('lblSerialFish').hide();
                                        Ext.getCmp(tabId).queryById('pnlUploadVarizi').hide();
                                        Ext.getCmp(tabId).queryById('fieldsetforVarizi').setHeight(128);
                                        Ext.getCmp(tabId).queryById('txtPrice').setReadOnly(true);
                                        Ext.getCmp(tabId).queryById('txtMun').setValue("");
                                        Ext.getCmp(tabId).queryById('txtSerialFish').setValue("");
                                        Ext.getCmp(tabId).queryById('text').show();
                                    }
                                    else {
                                        Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 381) / 2);
                                        Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 381) / 2);
                                        Ext.getCmp(tabId).queryById('txtSerial').hide();
                                        Ext.getCmp(tabId).queryById('lblSerial').hide();
                                        Ext.getCmp(tabId).queryById('txtMun').show();
                                        Ext.getCmp(tabId).queryById('lblMun').show();
                                        Ext.getCmp(tabId).queryById("txtMun").setValue(data.fldName);
                                        Ext.getCmp(tabId).queryById('txtSerialFish').show();
                                        Ext.getCmp(tabId).queryById('lblSerialFish').show();
                                        Ext.getCmp(tabId).queryById("txtSerialFish").setValue(data.fldSerialFish);
                                        Ext.getCmp(tabId).queryById('fieldsetforVarizi').setHeight(107);
                                        Ext.getCmp(tabId).queryById('pnlUploadVarizi').show();
                                        Ext.getCmp(tabId).queryById('txtPrice').setReadOnly(false);
                                        Ext.getCmp(tabId).queryById('txtSerial').setValue("");
                                        Ext.getCmp(tabId).queryById('text').hide();
                                    }
                                    App.AvarezWin.body.mask().hide();
                                }
                                else {
                                    Ext.MessageBox.show({
                                        title: data.MsgTitle,
                                        msg: data.Msg,
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }

                            }
                        });
                    }
                    else {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "واریزی موردنظر تایید شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
        else if (command == 'DeleteVarizi') {
            Ext.MessageBox.show({
                title: "هشدار",
                msg: "آیا برای حذف مطمئن هستید؟",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.YESNO,
                fn: function (btn) {
                    if (btn == 'yes') {
                        App.AvarezWin.body.mask("در حال انجام عملیات...");
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/DeleteVarizi',
                            params: {
                                Id: record.data.fldID
                            },
                            success: function (data) {
                                var ic = Ext.MessageBox.INFO;
                                if (data.Er == 1)
                                    ic = Ext.MessageBox.ERROR;
                                Ext.MessageBox.show({
                                    title: data.MsgTitle,
                                    msg: data.Msg,
                                    icon: ic,
                                    buttons: Ext.MessageBox.OK
                                });
                                if (data.Er != 1) {
                                    ReloadGridVarizi();
                                    ReloadGridPeacockery();
                                }
                                if (record.data.fldID == Ext.getCmp(tabId).queryById('fldIdVarizi').getValue()) {
                                    ClearVarizi();
                                }
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                    }
                }
            });
        }
    }

    function ActiononBlackList(grid, command, record, row) {
        var tabId = App.SearchParvande.activeTab.id;
        if (command == 'EditBlackList') {
            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/getDetailsBlackList',
                params: {
                    Id: record.data.fldId
                },
                success: function (data) {
                    if (data.Er != 1) {
                        var cboType = Ext.getCmp(tabId).queryById('cboType');
                        cboType.setValue(data.fldType);
                        var txtMsg = Ext.getCmp(tabId).queryById('txtMsg');
                        txtMsg.setValue(data.fldMsg);
                        var fldIdBlackList = Ext.getCmp(tabId).queryById('fldIdBlackList');
                        fldIdBlackList.setValue(data.fldId);
                    }
                    else {
                        Ext.MessageBox.show({
                            title: data.MsgTitle,
                            msg: data.Msg,
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
        else if (command == 'DeleteBlackList') {
            Ext.MessageBox.show({
                title: "هشدار",
                msg: "آیا برای حذف مطمئن هستید؟",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.YESNO,
                fn: function (btn) {
                    if (btn == 'yes') {
                        App.AvarezWin.body.mask("در حال انجام عملیات...");
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/DeleteBlackList',
                            params: {
                                Id: record.data.fldID
                            },
                            success: function (data) {
                                var ic = Ext.MessageBox.INFO;
                                if (data.Er == 1)
                                    ic = Ext.MessageBox.ERROR;
                                Ext.MessageBox.show({
                                    title: data.MsgTitle,
                                    msg: data.Msg,
                                    icon: ic,
                                    buttons: Ext.MessageBox.OK
                                });
                                ReloadGridBlackList();
                                if (record.data.fldID == Ext.getCmp(tabId).queryById('fldIdBlackList').getValue()) {
                                    ClearBlackList();
                                }
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                    }
                }
            });
        }
    }
    var ShowMafasa = function (column, commandd, record) {
        if (commandd == "ShowMafasaInExp") {
            if (record.data.fldMunicipalityID.toString() == '@Session["UserMnu"]') {
                App.AvarezWin.body.mask("در حال بارگذاری...");
                Ext.net.DirectMethod.request({
                    url: '/NewVer/SelectParvande/ShowMafasaInExp',
                    params: {
                        Id: record.data.fldID
                    },
                    success: function () {
                        App.AvarezWin.body.mask().hide();
                    }
                });
            } else {
                Ext.MessageBox.show({
                    title: 'خطا',
                    msg: 'امکان صدور مفاصا وجود ندارد.',
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            }
        }
    };
    var ShowMadrak = function (column, commandd, record) {

        if (commandd == "buttonMadrak") {
            App.AvarezWin.body.mask("در حال بارگذاری...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/ShowMadrak',
                params: {
                    Id: record.data.fldID
                },
                success: function () {
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
        else if (commandd == "buttonTaeeid") {
            App.AvarezWin.body.mask("در حال انجام عملیات...");
            Ext.net.DirectMethod.request({
                url: '/NewVer/Filtering_New/AccMadrakSavabegh',
                params: {
                    id: record.data.fldID,
                    CarfileId: App.SearchParvande.activeTab.id.substring(14)
                },
                success: function (data) {
                    var ic = Ext.MessageBox.INFO;
                    if (data.Er == 1)
                        ic = Ext.MessageBox.ERROR;
                    Ext.MessageBox.show({
                        title: data.MsgTitle,
                        msg: data.Msg,
                        icon: ic,
                        buttons: Ext.MessageBox.OK
                    });
                    ReloadGridSavabegh();
                    App.AvarezWin.body.mask().hide();
                }
            });
        }
    };

    function SetDate() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('fldIdVarizi').getValue() == 0) {
            var txtDateVariz = Ext.getCmp(tabId).queryById('txtDateVariz');
            @{
                var nowdate = Car.sp_GetDate().FirstOrDefault().CurrentDateTime.ToString("yyyy-MM-dd");
            }
            var date = new Date('@nowdate');
            txtDateVariz.setMaxValue(date);
            txtDateVariz.maxText = "تاریخ واریز نمی تواند بعد از امروز باشد.";
            txtDateVariz.setValue(date);
        }
    }

    function showhideItems() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboNoePardakht = Ext.getCmp(tabId).queryById('cboNoePardakht');
        if (cboNoePardakht.getValue() == "1") {
            Ext.getCmp(tabId).queryById('txtSerial').show();
            Ext.getCmp(tabId).queryById('lblSerial').show();
            Ext.getCmp(tabId).queryById('txtMun').hide();
            Ext.getCmp(tabId).queryById('lblMun').hide();
            Ext.getCmp(tabId).queryById('txtSerialFish').hide();
            Ext.getCmp(tabId).queryById('lblSerialFish').hide();
            Ext.getCmp(tabId).queryById('fieldsetforVarizi').setHeight(128);
            Ext.getCmp(tabId).queryById('pnlUploadVarizi').hide();
            Ext.getCmp(tabId).queryById('txtPrice').setValue("");
            Ext.getCmp(tabId).queryById('txtPrice').setReadOnly(true);
            Ext.getCmp(tabId).queryById('txtMun').setValue("");
            Ext.getCmp(tabId).queryById('txtSerialFish').setValue("");
            Ext.getCmp(tabId).queryById('text').show();
            Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 342) / 2);
            Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 342) / 2);
        }
        else {
            Ext.getCmp(tabId).queryById('txtSerial').hide();
            Ext.getCmp(tabId).queryById('lblSerial').hide();
            Ext.getCmp(tabId).queryById('txtMun').show();
            Ext.getCmp(tabId).queryById('lblMun').show();
            Ext.getCmp(tabId).queryById('txtSerialFish').show();
            Ext.getCmp(tabId).queryById('lblSerialFish').show();
            Ext.getCmp(tabId).queryById('fieldsetforVarizi').setHeight(107);
            Ext.getCmp(tabId).queryById('pnlUploadVarizi').show();
            Ext.getCmp(tabId).queryById('txtPrice').setValue("");
            Ext.getCmp(tabId).queryById('txtPrice').setReadOnly(false);
            Ext.getCmp(tabId).queryById('txtSerial').setValue("");
            Ext.getCmp(tabId).queryById('text').hide();
            Ext.getCmp(tabId).queryById("GridVarizi").setHeight((App.AvarezWin.height - 381) / 2);
            Ext.getCmp(tabId).queryById("GridPeacockery").setHeight((App.AvarezWin.height - 381) / 2);
        }
    }

    function manage() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('txtSerial').show();
        Ext.getCmp(tabId).queryById('lblSerial').show();
        Ext.getCmp(tabId).queryById('txtMun').hide();
        Ext.getCmp(tabId).queryById('lblMun').hide();
        Ext.getCmp(tabId).queryById('txtSerialFish').hide();
        Ext.getCmp(tabId).queryById('lblSerialFish').hide();
        Ext.getCmp(tabId).queryById('fieldsetforVarizi').setHeight(128);
        Ext.getCmp(tabId).queryById('pnlUploadVarizi').hide();
        Ext.getCmp(tabId).queryById('txtPrice').setValue("");
        Ext.getCmp(tabId).queryById('txtPrice').setReadOnly(true);
        Ext.getCmp(tabId).queryById('txtMun').setValue("");
        Ext.getCmp(tabId).queryById('txtSerialFish').setValue("");
        Ext.getCmp(tabId).queryById('text').show();
    }

    var setPrice = function (field, key) {
        var tabId = App.SearchParvande.activeTab.id;
        if (key.keyCode == 13) {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/GetPrice',
                params: {
                    Id: Ext.getCmp(tabId).queryById('txtSerial').getValue()
                },
                success: function (Money) {
                    Ext.getCmp(tabId).queryById('txtPrice').setValue(Money);
                }
            });
        }
    };

    function setDefaultCboNoeVariz() {
        var tabId = App.SearchParvande.activeTab.id;
        CboNoeVariz = Ext.getCmp(tabId).queryById('CboNoeVariz');
        CboNoeVariz.setValue(CboNoeVariz.store.getAt(3));
    }

    function formatMoney() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('txtPrice').getValue() != '') {
            Ext.getCmp(tabId).queryById('txtPrice').setValue(accounting.formatNumber(Ext.getCmp(tabId).queryById('txtPrice').getValue()))
        }
    }



    function Archive() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ImageGallery',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ShowMadrakVariz(record) {
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ShowMadrakVariz',
            params: {
                Id: record.data.fldID
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function SodoorMafasa(record) {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/CheckBedehi',
            params: {
                CarFileId: tabId.substring(14),
                collectionDate: record.data.fldCollectionDate
            },
            success: function (data) {
                if (data.allow == false) {
                    Ext.MessageBox.show({
                        Name: "خطا",
                        msg: "خودرو انتخاب شده بدهکار است و امکان صدور مفاصا وجود ندارد.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else {

                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }
    /*function EditPictures() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/CheckTaiid',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (data) {
                if (!data.HaveTaiid || data.userId == "1") {
                    Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/UpdateCarFilePic/Index',
                        params: {
                            /*CarId: 'ViewBag.CarId'
                            CarFileId: tabId.substring(14)
                        },
                        success: function (result) {
                            Ext.net.Mask.hide();
                        }
                    });
                }
                else {
                    Ext.MessageBox.show({
                        Name: "خطا",
                        msg: "پرونده موردنظر تایید شده و قادر به ویرایش آن نمی باشید.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                Ext.getCmp(tabId).body.mask().hide();
            }
        });
    }*/

    /*function EditSavabegh() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/EnteghalSavabegh/WindowSavabegh',
            params: {
                CarId: 'ViewBag.CarId',
                CarFileId: ""
            },
            success: function (result) {
                Ext.net.Mask.hide();
            }
        });
    }*/

    /*function EditCarView() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/CheckTaiid',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (data) {
                if (!data.HaveTaiid || data.userId == "1") {
                    if (data.HaveMafasa && data.userId != "1") {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "برای پرونده موردنظر  مفاصا ثبت شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else if (data.HaveSabeghe && data.userId != "1") {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "برای پرونده موردنظر  سابقه ثبت شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else if (data.HaveVarizi && data.userId != "1") {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "برای پرونده موردنظر  واریزی ثبت شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else if (data.HaveFish && data.userId != "1") {
                        Ext.MessageBox.show({
                            Name: "خطا",
                            msg: "برای پرونده موردنظر  فیش ثبت شده و قادر به ویرایش آن نمی باشید.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/Parvande/NewParvandeKhodro',
                            params: {
                                id: 'ViewBag.CarFileId',
                                Pelakid: 0,
                                state: 2
                            },
                            success: function (result) {
                                Ext.net.Mask.hide();
                            }
                        });
                    }
                }
                else {
                    Ext.MessageBox.show({
                        Name: "خطا",
                        msg: "پرونده موردنظر تایید شده و قادر به ویرایش آن نمی باشید.",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                App.SelectParvande.body.mask().hide();
            }
        });
    }*/

    function PardakhtOnline1New() {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");
                    var lblMablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");

                    if (shasi_motor_vin.getValue() != "") {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: shasi_motor_vin.getValue(),
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        if (lblMablagh.getValue() >= 1000) {
                            var URL = '@Url.Content("/NewVer/SelectParvande/GoToOnlinePay1")';
                            $.ajax({
                                url: URL,
                                type: 'get',
                                datatype: 'json',
                                data: {
                                    Amount: lblMablagh.getValue(),
                                    CarFileId: tabId.substring(14),
                                    fldFine: fldFine.getValue(),
                                    fldValueAddPrice: fldValueAddPrice.getValue(),
                                    fldPrice: fldPrice.getValue(),
                                    Years: Years.getValue(),
                                    Bed: Bed.getValue(),
                                    fldOtherPrice: fldOtherPrice.getValue(),
                                    fldMainDiscount: fldMainDiscount.getValue(),
                                    fldFineDiscount: fldFineDiscount.getValue(),
                                    fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                    fldOtherDiscount: fldOtherDiscount.getValue()
                                },
                                error: function (xhr, status, error) {
                                    alert(xhr + status);
                                },
                                success: function (result) {
                                    window.location.href = "http://e1.kashan.ir/payment.aspx?bill=" + result.shGabz + "&pay=" + result.Shpardakht + "&refer=http://car.favakashan.ir/First/Index";
                                }
                            });
                        }

                        else {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: "مبلغ پرداخت کمتر از میزان مجاز برای پرداخت اینترنتی است.",
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                    }
                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به پرداخت نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

    function Mafasa() {
        var tabId = App.SearchParvande.activeTab.id;
        var MablaghAvarez = Ext.getCmp(tabId).queryById("Mablagh").getValue();
        var shasi_motor_vin = Ext.getCmp(tabId).queryById('shasi_motor_vin').getValue();

        App.AvarezWin.body.mask('در حال بارگذاری...');
        @*if (Ext.getCmp(tabId).queryById("AvarezMablagh").getText() == "") {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/calc',
                params: {
                    CarFileid: tabId.substring(14)
                },
                success: function (data) {
                    if (data.State == 2) {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/SendToSupporter',
                            params: {
                                msg: data.msg,
                                Year: data.Year,
                                CarClassId: 0,
                                carFileID: tabId.substring(14)
                            },
                            success: function (data) {
                                App.AvarezWin.body.mask().hide();
                            }
                        });
                        Ext.getCmp(tabId).queryById("Years").setValue(data.Year);
                    }
                    else {
                        if (data.msg != "") {
                            Ext.MessageBox.show({
                                title: data.MsgTitle,
                                msg: data.msg,
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                        }
                        else {
                            Ext.net.DirectMethod.request({
                                url: '/NewVer/SelectParvande/GetPicStatus',
                                params: {
                                    CarFileid: tabId.substring(14)
                                },
                                success: function (result) {
                                    if (result.status == false && result.ForceScan == "1") {
                                        var str = "";
                                        if (result.carfile == 1)
                                            str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                                        if (result.carext == 1)
                                            str += " انتقال سوابق ";
                                        if (result.coll == 1)
                                            str += " واریزی علی الحساب ";
                                        Ext.MessageBox.show({
                                            title: "خطا",
                                            msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                                            icon: Ext.MessageBox.ERROR,
                                            buttons: Ext.MessageBox.OK
                                        });
                                        App.AvarezWin.body.mask().hide();
                                    }
                                    else {
                                        if (shasi_motor_vin != "") {
                                            Ext.MessageBox.show({
                                                title: "خطا",
                                                msg: shasi_motor_vin,
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                            App.AvarezWin.body.mask().hide();
                                        }
                                        else {
                                            if (MablaghAvarez <= 10000) {
                                                /*Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/ShowMafasa',
                                                    params: {
                                                        containerId: "SearchParvande",
                                                        CarFileId: tabId.substring(14)
                                                    },
                                                    success: function (data) {
                                                        Ext.net.Mask.hide();
                                                    }
                                                });*/
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/Mafasa',
                                                    params: {
                                                        id: tabId.substring(14)
                                                    },
                                                    success: function (result) {
                                                        if (result.Er == 1) {
                                                            Ext.MessageBox.show({
                                                                title: result.MsgTitle,
                                                                msg: result.Msg,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttons: Ext.MessageBox.OK
                                                            });
                                                        }
                                                        else {
                                                            /*var param = { 'IdMafasa': result.IdMafasa};
                                                            OpenWindowWithPost1("/NewVer/SelectParvande/ShowMafasaNewTab",
                                                            "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                            "NewWindow", param);*/
                                                            if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "1" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                                openWindowWithPost("/NewVer/SelectParvande/ShowMafasaNewTab", {
                                                                    IdMafasa: result.IdMafasa
                                                                });
                                                            }
                                                            else {
                                                                Ext.net.DirectMethod.request({
                                                                    url: '/NewVer/SelectParvande/ShowMafasaNewWin',
                                                                    params: {
                                                                        IdMafasa: result.IdMafasa
                                                                    }
                                                                });
                                                            }
                                                        }
                                                    }
                                                });
                                            }
                                            else {
                                                Ext.MessageBox.show({
                                                    title: "خطا",
                                                    msg: 'خودرو انتخاب شده بدهکار است و امکان صدور مفاصا وجود ندارد.',
                                                    icon: Ext.MessageBox.ERROR,
                                                    buttons: Ext.MessageBox.OK
                                                });
                                            }
                                            App.AvarezWin.body.mask().hide();
                                        }
                                    }
                                }
                            });
                        }
                    }
                }
            });
        }
        else {*@
        if (Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").getValue() == '0') {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/GetPicStatus',
                params: {
                    CarFileid: tabId.substring(14)
                },
                success: function (result) {
                    if (result.status == false && result.ForceScan == "1") {
                        var str = "";
                        if (result.carfile == 1)
                            str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                        if (result.coll == 1)
                            str += " واریزی علی الحساب ";
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                    else if (result.status1 == false && result.ExpScan == "1") {
                        var str = "";
                        if (result.carext == 1)
                            str += " انتقال سوابق ";
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                    else {
                        if (shasi_motor_vin != "") {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: shasi_motor_vin,
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                            App.AvarezWin.body.mask().hide();
                        }
                        else {
                            if (MablaghAvarez <= 10000) {
                                /*Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SelectParvande/ShowMafasa',
                                    params: {
                                        containerId: "SearchParvande",
                                        CarFileId: tabId.substring(14)
                                    },
                                    success: function (data) {
                                        Ext.net.Mask.hide();
                                    }
                                });*/
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SelectParvande/CheckExistMafasa',
                                    params: {
                                        carId: Ext.getCmp(tabId).queryById('fldCarId').getValue(),
                                        carFileId: tabId.substring(14)
                                    },
                                    success: function (data) {
                                        if (data.state == 2) {
                                            Ext.MessageBox.show({
                                                title: "خطا",
                                                msg: "لطفا ابتدا رسید دفتر را صادر نموده و سپس اقدام به صدور مفاصا نمایید.",
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                        }
                                        else if (data.state == 0) {/*عدم وجود مفاصا*/
                                            Ext.net.DirectMethod.request({
                                                url: '/NewVer/SelectParvande/Mafasa',
                                                params: {
                                                    id: tabId.substring(14)
                                                },
                                                success: function (result) {
                                                    if (result.Er == 1) {
                                                        Ext.MessageBox.show({
                                                            title: result.MsgTitle,
                                                            msg: result.Msg,
                                                            icon: Ext.MessageBox.ERROR,
                                                            buttons: Ext.MessageBox.OK
                                                        });
                                                    }
                                                    else {
                                                        /*var param = { 'IdMafasa': result.IdMafasa};
                                                        OpenWindowWithPost1("/NewVer/SelectParvande/ShowMafasaNewTab",
                                                        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                        "NewWindow", param);*/
                                                        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                            openWindowWithPost("/NewVer/SelectParvande/ShowMafasaNewTab", {
                                                                IdMafasa: result.IdMafasa
                                                            });
                                                        }
                                                        else {
                                                            Ext.net.DirectMethod.request({
                                                                url: '/NewVer/SelectParvande/ShowMafasaNewWin',
                                                                params: {
                                                                    IdMafasa: result.IdMafasa
                                                                }
                                                            });
                                                        }
                                                    }
                                                }
                                            });
                                        }
                                        else {
                                            Ext.MessageBox.show({
                                                title: "هشدار",
                                                msg: "آیا مایل به چاپ مفاصا به صورت المثنی هستید؟",
                                                icon: Ext.MessageBox.WARNING,
                                                buttons: Ext.MessageBox.YESNO,
                                                fn: function (btn) {
                                                    if (btn == 'yes') {/*همون قبلی*/
                                                        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                            openWindowWithPost("/NewVer/SelectParvande/ShowMafasaNewTab", {
                                                                IdMafasa: data.MafasaId
                                                            });
                                                        }
                                                        else {
                                                            Ext.net.DirectMethod.request({
                                                                url: '/NewVer/SelectParvande/ShowMafasaNewWin',
                                                                params: {
                                                                    IdMafasa: data.MafasaId
                                                                }
                                                            });
                                                        }
                                                    }
                                                    else {
                                                        Ext.net.DirectMethod.request({
                                                            url: '/NewVer/SelectParvande/Mafasa',
                                                            params: {
                                                                id: tabId.substring(14)
                                                            },
                                                            success: function (result) {
                                                                if (result.Er == 1) {
                                                                    Ext.MessageBox.show({
                                                                        title: result.MsgTitle,
                                                                        msg: result.Msg,
                                                                        icon: Ext.MessageBox.ERROR,
                                                                        buttons: Ext.MessageBox.OK
                                                                    });
                                                                }
                                                                else {
                                                                    /*var param = { 'IdMafasa': result.IdMafasa};
                                                                    OpenWindowWithPost1("/NewVer/SelectParvande/ShowMafasaNewTab",
                                                                    "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                                    "NewWindow", param);*/
                                                                    if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                                        openWindowWithPost("/NewVer/SelectParvande/ShowMafasaNewTab", {
                                                                            IdMafasa: result.IdMafasa
                                                                        });
                                                                    }
                                                                    else {
                                                                        Ext.net.DirectMethod.request({
                                                                            url: '/NewVer/SelectParvande/ShowMafasaNewWin',
                                                                            params: {
                                                                                IdMafasa: result.IdMafasa
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            }
                                                        });
                                                    }
                                                }
                                            });
                                        }
                                    }
                                });
                            }
                            else {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: 'خودرو انتخاب شده بدهکار است و امکان صدور مفاصا وجود ندارد.',
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            App.AvarezWin.body.mask().hide();
                        }
                    }
                }
            });
        } else {
            Ext.MessageBox.show({
                title: "",
                msg: "پرونده مورد نظر تایید نشده و می بایست کلیه اطلاعات شامل پلاک، مشخصات خودرو، انتقال سوابق و اطلاعات واریزی بررسی گردیده و درصورت وجود مغایرت نسبت به اصلاح موارد ذکر شده اقدام نمایید و پس از اطمینان از صحیح بودن اطلاعات پرونده را تایید کنید. جهت تایید پرونده بروی تصویر کارت خودرو راست کلیک و تایید را انتخاب کنید. لازم بذکر است پس از تایید و وجود هرگونه مغایرت در اطلاعات مسئولیت آن به عهده شما خواهد بود.",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.OK
            });
        }
        /*}*/
    }

    function DownloadMafasa() {
        var tabId = App.SearchParvande.activeTab.id;
        var MablaghAvarez = Ext.getCmp(tabId).queryById("Mablagh").getValue();
        var shasi_motor_vin = Ext.getCmp(tabId).queryById('shasi_motor_vin').getValue();

        App.AvarezWin.body.mask('در حال بارگذاری...');
        if (Ext.getCmp(App.SearchParvande.activeTab.id).queryById("KhodEzhari").getValue() == '0') {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/GetPicStatus',
                params: {
                    CarFileid: tabId.substring(14)
                },
                success: function (result) {
                    if (result.status == false && result.ForceScan == "1") {
                        var str = "";
                        if (result.carfile == 1)
                            str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                        if (result.coll == 1)
                            str += " واریزی علی الحساب ";
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                    else if (result.status1 == false && result.ExpScan == "1") {
                        var str = "";
                        if (result.carext == 1)
                            str += " انتقال سوابق ";
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                        App.AvarezWin.body.mask().hide();
                    }
                    else {
                        if (shasi_motor_vin != "") {
                            Ext.MessageBox.show({
                                title: "خطا",
                                msg: shasi_motor_vin,
                                icon: Ext.MessageBox.ERROR,
                                buttons: Ext.MessageBox.OK
                            });
                            App.AvarezWin.body.mask().hide();
                        }
                        else {
                            if (MablaghAvarez <= 10000) {
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SelectParvande/CheckExistMafasa',
                                    params: {
                                        carId: Ext.getCmp(tabId).queryById('fldCarId').getValue(),
                                        carFileId: tabId.substring(14)
                                    },
                                    success: function (data) {
                                        if (data.state == 2) {
                                            Ext.MessageBox.show({
                                                title: "خطا",
                                                msg: "لطفا ابتدا رسید دفتر را صادر نموده و سپس اقدام به صدور مفاصا نمایید.",
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                        }
                                        else if (data.state == 0) {/*عدم وجود مفاصا*/
                                            Ext.net.DirectMethod.request({
                                                url: '/NewVer/SelectParvande/Mafasa',
                                                params: {
                                                    id: tabId.substring(14)
                                                },
                                                success: function (result) {
                                                    if (result.Er == 1) {
                                                        Ext.MessageBox.show({
                                                            title: result.MsgTitle,
                                                            msg: result.Msg,
                                                            icon: Ext.MessageBox.ERROR,
                                                            buttons: Ext.MessageBox.OK
                                                        });
                                                    }
                                                    else {
                                                        window.location.href = '@Url.Content("/NewVer/SelectParvande/DownloadMafasaPdf?id=")'
                                                            + result.IdMafasa;
                                                    }
                                                }
                                            });
                                        }
                                        else {
                                            Ext.MessageBox.show({
                                                title: "هشدار",
                                                msg: "آیا مایل به چاپ مفاصا به صورت المثنی هستید؟",
                                                icon: Ext.MessageBox.WARNING,
                                                buttons: Ext.MessageBox.YESNO,
                                                fn: function (btn) {
                                                    if (btn == 'yes') {/*همون قبلی*/
                                                        window.location.href = '@Url.Content("/NewVer/SelectParvande/DownloadMafasaPdf?id=")'
                                                            + data.MafasaId;
                                                    }
                                                    else {
                                                        Ext.net.DirectMethod.request({
                                                            url: '/NewVer/SelectParvande/Mafasa',
                                                            params: {
                                                                id: tabId.substring(14)
                                                            },
                                                            success: function (result) {
                                                                if (result.Er == 1) {
                                                                    Ext.MessageBox.show({
                                                                        title: result.MsgTitle,
                                                                        msg: result.Msg,
                                                                        icon: Ext.MessageBox.ERROR,
                                                                        buttons: Ext.MessageBox.OK
                                                                    });
                                                                }
                                                                else {

                                                                    window.location.href = '@Url.Content("/NewVer/SelectParvande/DownloadMafasaPdf?id=")'
                                                            + result.IdMafasa;
                                                                }
                                                            }
                                                        });
                                                    }
                                                }
                                            });
                                        }
                                    }
                                });

                                /*Ext.net.DirectMethod.request({
                                    url: '/NewVer/SelectParvande/Mafasa',
                                    params: {
                                        id: tabId.substring(14)
                                    },
                                    success: function (result) {
                                        if (result.Er == 1) {
                                            Ext.MessageBox.show({
                                                title: result.MsgTitle,
                                                msg: result.Msg,
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                        }
                                        else {
                                            window.location.href = 'Url.Content("/NewVer/SelectParvande/DownloadMafasaPdf?id=")'
                                           + result.IdMafasa;
                                        }
                                    }
                                });*/
                            }
                            else {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: 'خودرو انتخاب شده بدهکار است و امکان صدور مفاصا وجود ندارد.',
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                            }
                            App.AvarezWin.body.mask().hide();
                        }
                    }
                }
            });
        } else {
            Ext.MessageBox.show({
                title: "",
                msg: "پرونده مورد نظر تایید نشده و می بایست کلیه اطلاعات شامل پلاک، مشخصات خودرو، انتقال سوابق و اطلاعات واریزی بررسی گردیده و درصورت وجود مغایرت نسبت به اصلاح موارد ذکر شده اقدام نمایید و پس از اطمینان از صحیح بودن اطلاعات پرونده را تایید کنید. جهت تایید پرونده بروی تصویر کارت خودرو راست کلیک و تایید را انتخاب کنید. لازم بذکر است پس از تایید و وجود هرگونه مغایرت در اطلاعات مسئولیت آن به عهده شما خواهد بود. همچنین درصورت مغایر بودن پلاک از قسمت تعویض مالک استفاده نمایید.",
                icon: Ext.MessageBox.WARNING,
                buttons: Ext.MessageBox.OK
            });
        }
    }

    function openWindowWithPost(url, data) {
        var form = document.createElement("form");
        form.target = "_blank";
        form.method = "POST";
        form.action = url;
        form.style.display = "none";

        var input = document.createElement("input");
        input.type = "text";
        form.appendChild(input);

        for (var key in data) {
            var input = document.createElement("input");
            input.type = "hidden";
            input.name = key;
            input.value = data[key];
            form.appendChild(input);
        }

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
    }

    function OpenWindowWithPost1(url, windowoption, name, params) {
        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", url);
        form.setAttribute("target", name);

        for (var i in params) {
            if (params.hasOwnProperty(i)) {
                var input = document.createElement('input');
                input.type = 'hidden';
                input.name = i;
                input.value = params[i];
                form.appendChild(input);
            }
        }

        document.body.appendChild(form);

        window.open("post.htm", name, windowoption);
        form.submit();
        document.body.removeChild(form);
    }
    function SelMalek() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask('در حال بارگذاری...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/ChCarFilePelaquSearch_/Index',
            params: {
                CarId: Ext.getCmp(tabId).queryById('fldCarId').getValue(),
                CarPlaqId: Ext.getCmp(tabId).queryById('fldCarPlaqueID').getValue()
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    /*function ShowPic2(state) {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/PreviewFile/Index',
            params: {
                State: state,
                Id: 'ViewBag.CarId'
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }*/

    function ReloadGridVarizi() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('GridVarizi').getStore().getProxy().setExtraParam("CarFileId", tabId.substring(14));
        Ext.getCmp(tabId).queryById('GridVarizi').getStore().load();
        /*Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ReloadGridVarizi',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (result) {
                var tabId = App.SearchParvande.activeTab.id;
                Ext.getCmp(tabId).queryById('GridVarizi').getStore().loadData(result);
                Ext.net.Mask.hide();
            }
        });*/
    }

    function ReloadGridCarFileOwner() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask('در حال بارگذاری...');
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ReloadGridCarFileOwner',
            params: {
                PlaquId: Ext.getCmp(tabId).queryById('carPlaqueIdChangeMalek').getValue()
            },
            success: function (result) {
                var tabId = App.SearchParvande.activeTab.id;
                Ext.getCmp(tabId).queryById('GridChangeOwner').getStore().loadData(result);
                App.AvarezWin.body.mask().hide();
            }
        });
    }


    function ReloadGridBlackList() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('GridBlackList').getStore().getProxy().setExtraParam("CarFileId", tabId.substring(14));
        Ext.getCmp(tabId).queryById('GridBlackList').getStore().load();
    }

    function ReloadGridSavabegh() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('GridSavabegh').getStore().getProxy().setExtraParam("CarFileId", tabId.substring(14));
        Ext.getCmp(tabId).queryById('GridSavabegh').getStore().load();
        /*Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ReloadGridSavabegh',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (result) {
                var tabId = App.SearchParvande.activeTab.id;
                Ext.getCmp(tabId).queryById('GridSavabegh').getStore().loadData(result);
                Ext.net.Mask.hide();
            }
        });*/
    }

    function ReloadGridPeacockery() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('GridPeacockery').getStore().getProxy().setExtraParam("CarFileId", tabId.substring(14));
        Ext.getCmp(tabId).queryById('GridPeacockery').getStore().load();
    }

    function SaveVarizi() {
        var tabId = App.SearchParvande.activeTab.id;

        var er = false;
        if (Ext.getCmp(tabId).queryById('CboNoeVariz').getValue() == "10") {
            Ext.getCmp(tabId).queryById('txtSerial').allowBlank = true;
        }

        if (Ext.getCmp(tabId).queryById('CboNoeVariz').validate() == false) {
            er = true;
        }
        if (Ext.getCmp(tabId).queryById('txtDateVariz').validate() == false) {
            er = true;
        }
        if (Ext.getCmp(tabId).queryById('cboNoePardakht').getValue() == "1") {
            if (Ext.getCmp(tabId).queryById('txtSerial').validate() == false) {
                er = true;
            }
        }
        else {
            if (Ext.getCmp(tabId).queryById('txtSerialFish').validate() == false) {
                er = true;
            }
            if (Ext.getCmp(tabId).queryById('txtMun').validate() == false) {
                er = true;
            }
        }
        if (Ext.getCmp(tabId).queryById('txtPrice').validate() == false) {
            er = true;
        }



        if (er == true)
            return;

        var data = {
            fldCarFileID: tabId.substring(14),
            fldCollectionDate: Ext.getCmp(tabId).queryById('txtDateVariz').getRawValue(),
            fldPrice: parseInt(Ext.getCmp(tabId).queryById('txtPrice').getValue().toString().replace(',', '').replace(',', '').replace(',', '')),
            fldSettleTypeID: Ext.getCmp(tabId).queryById('CboNoeVariz').getValue(),
            fldDesc: Ext.getCmp(tabId).queryById('txtDescV').getValue(),
            fldPeacockeryCode: Ext.getCmp(tabId).queryById('txtSerial').getValue(),
            fldId: Ext.getCmp(tabId).queryById('fldIdVarizi').getValue(),
            fldSerialBarChasb: Ext.getCmp(tabId).queryById('txtSerialLable').getValue(),
            fldMunId: Ext.getCmp(tabId).queryById('fldIdMunVarizi').getValue(),
            fldSerialFish: Ext.getCmp(tabId).queryById('txtSerialFish').getValue(),
            fldFileId: Ext.getCmp(tabId).queryById('fldFileIdVarizi').getValue()
        };

        App.AvarezWin.body.mask("در حال ذخیره سازی...");
        $.ajax({
            type: "POST",
            url: '/NewVer/SelectParvande/SaveVarizi',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(data),
            datatype: "json",
            success: function (data) {
                var ic = Ext.MessageBox.INFO;
                if (data.Er == 1)
                    ic = Ext.MessageBox.ERROR;
                Ext.MessageBox.show({
                    title: data.MsgTitle,
                    msg: data.Msg,
                    icon: ic,
                    buttons: Ext.MessageBox.OK
                });
                if (data.Er != 1) {
                    ClearVarizi();
                    ReloadGridVarizi();
                    ReloadGridPeacockery();
                }
                else {
                    var elId = '"fi-button-msgvariz"' + tabId.substring(14);
                    var el = Ext.get(elId);
                    Ext.get(el).update("");
                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function SaveBlackList() {
        var tabId = App.SearchParvande.activeTab.id;
        var cboType = Ext.getCmp(tabId).queryById('cboType');
        var txtMsg = Ext.getCmp(tabId).queryById('txtMsg');
        var fldIdBlackList = Ext.getCmp(tabId).queryById('fldIdBlackList');

        var er = false;

        if (cboType.validate() == false) {
            er = true;
        }
        if (txtMsg.validate() == false) {
            er = true;
        }

        if (er == true)
            return;

        App.AvarezWin.body.mask("در حال ذخیره سازی...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/SaveBlackList',
            params: {
                fldId: fldIdBlackList.getValue(),
                fldType: cboType.getValue(),
                fldMsg: txtMsg.getValue(),
                CarFileID: tabId.substring(14)
            },
            success: function (data) {
                var ic = Ext.MessageBox.INFO;
                if (data.Err == 1)
                    ic = Ext.MessageBox.ERROR;
                Ext.MessageBox.show({
                    title: data.MsgTitle,
                    msg: data.Msg,
                    icon: ic,
                    buttons: Ext.MessageBox.OK
                });
                if (data.Err != 1) {
                    ReloadGridBlackList();
                    ClearBlackList();
                }
                else {
                    var elId = '"fi-button-msgvariz"' + tabId.substring(14);
                    var el = Ext.get(elId);
                    Ext.get(el).update("");
                }
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ClearVarizi() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.getCmp(tabId).queryById('fldIdVarizi').setValue(0);
        Ext.getCmp(tabId).queryById('fldFileIdVarizi').setValue(0);
        Ext.getCmp(tabId).queryById('txtDateVariz').setValue("");
        Ext.getCmp(tabId).queryById('txtPrice').setValue("");
        Ext.getCmp(tabId).queryById('txtDescV').setValue("");
        Ext.getCmp(tabId).queryById('txtSerial').setValue("");
        Ext.getCmp(tabId).queryById('txtSerialFish').setValue("");
        Ext.getCmp(tabId).queryById('txtMun').setValue("");
        Ext.getCmp(tabId).queryById('txtSerialLable').setValue("");
        Ext.getCmp(tabId).queryById('fldIdMunVarizi').setValue(0);
        var elId = '"fi-button-msgvariz"' + tabId.substring(14);
        var el = Ext.get(elId);
        Ext.get(el).update("");
    }

    function ShowMafasaInVarizi(record) {
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ShowMafasaInVarizi',
            params: {
                Id: record.data.fldID
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function ShowMafasaInExp(record) {

    }
    function ShowResid(record) {
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/ShowResid',
            params: {
                Id: record.data.fldID,
                Type: 1
            },
            success: function () {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    function Fish() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/CheckBlackList',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (data) {
                if (data.Msg != "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: data.Msg,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    App.AvarezWin.body.mask().hide();
                }
                else if (data.Msg == "") {
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/GetTrnStatus',
                        params: {
                            CarFileId: tabId.substring(14)
                        },
                        success: function (d) {
                            if (d == "0") {
                                Ext.MessageBox.show({
                                    title: "هشدار",
                                    msg: "درصورت ادامه از شارژ شمار کسر خواهد شد. آیا مطمئن هستید؟",
                                    icon: Ext.MessageBox.WARNING,
                                    buttons: Ext.MessageBox.YESNO,
                                    fn: function (btn) {
                                        if (btn == 'yes') {
                                            /*Ext.net.DirectMethod.request({
                                                url: '/NewVer/SodorFish/Index',
                                                params: {
                                                    containerId: "SearchParvande",
                                                    CarId: 'ViewBag.CarId',
                                                    CarFileId: 'ViewBag.CarFileId'
                                                },
                                                success: function () {
                                                    App.AvarezWin.body.mask().hide();
                                                }
                                            });*/
                                        }
                                    }
                                });
                            }
                            else {
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SodorFish/Index',
                                    params: {
                                        containerId: "SearchParvande",
                                        CarId: 'ViewBag.CarId',
                                        CarFileId: 'ViewBag.CarFileId'
                                    },
                                    success: function () {
                                        Ext.net.Mask.hide();
                                    }
                                });
                            }
                        }
                    });
                }
            }
        });
    }

    /*function EnteghalSavabegh() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/EnteghalSavabegh/Index',
            params: {
                containerId: "SearchParvande",
                CarId: 'ViewBag.CarId',
                CarFileId: 'ViewBag.CarFileId'
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }*/

    /*function Fish() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/InSearch_File/CheckBlackList',
            params: {
                CarId: 'ViewBag.CarId'
            },
            success: function (data) {
                if (data.Msg != "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: data.Msg,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    Ext.net.Mask.hide();
                }
                else if (data.Msg == "") {
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/InSearch_File/GetTrnStatus',
                        params: {
                            CarId: 'ViewBag.CarId'
                        },
                        success: function (d) {
                            if (d == "0") {
                                Ext.MessageBox.show({
                                    title: "هشدار",
                                    msg: "درصورت ادامه از شارژ شمار کسر خواهد شد. آیا مطمئن هستید؟",
                                    icon: Ext.MessageBox.WARNING,
                                    buttons: Ext.MessageBox.YESNO,
                                    fn: function (btn) {
                                        if (btn == 'yes') {
                                            Ext.net.DirectMethod.request({
                                                url: '/NewVer/SodorFish/Index',
                                                params: {
                                                    containerId: "SearchParvande",
                                                    CarId: 'ViewBag.CarId',
                                                    CarFileId: 'ViewBag.CarFileId'
                                                },
                                                success: function () {
                                                    Ext.net.Mask.hide();
                                                }
                                            });
                                        }
                                    }
                                });
                            }
                            else {
                                Ext.net.DirectMethod.request({
                                    url: '/NewVer/SodorFish/Index',
                                    params: {
                                        containerId: "SearchParvande",
                                        CarId: 'ViewBag.CarId',
                                        CarFileId: 'ViewBag.CarFileId'
                                    },
                                    success: function () {
                                        Ext.net.Mask.hide();
                                    }
                                });
                            }
                        }
                    });
                }
            }
        });
    }*/

    /*function Varizi() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/SabtVarizi/Index',
            params: {
                containerId: "SearchParvande",
                CarId: 'ViewBag.CarId',
                CarFileId: 'ViewBag.CarFileId'
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }*/

    /*function Mafasa() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/SodorFish/ShowMafasa',
            params: {
                containerId: "SearchParvande",
                CarId: 'ViewBag.CarId',
                CarFileId: 'ViewBag.CarFileId'
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }*/

    function HazfTekrari() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.MessageBox.show({
            title: "هشدار",
            msg: "آیا برای حذف مطمئن هستید؟",
            icon: Ext.MessageBox.WARNING,
            buttons: Ext.MessageBox.YESNO,
            fn: function (btn) {
                if (btn == 'yes') {
                    App.AvarezWin.body.mask("در حال انجام عملیات...");
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/DeleteByCarFile',
                        params: {
                            id: tabId.substring(14)
                        },
                        success: function (data) {
                            var ic = Ext.MessageBox.INFO;
                            if (data.Err == 1)
                                ic = Ext.MessageBox.ERROR;
                            Ext.MessageBox.show({
                                title: data.MsgTitle,
                                msg: data.Msg,
                                icon: ic,
                                buttons: Ext.MessageBox.OK
                            });
                            App.AvarezWin.body.mask().hide();
                            ReloadGridPeacockery();
                        }
                    });
                }
            }
        });
    }

    /*function ListSiah() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/ListBlack/Index',
            params: {
                containerId: "SearchParvande",
                CarId: 'ViewBag.CarId'
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }*/

    /*function Tarakonesh() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/InSearch_File/CheckBlackList',
            params: {
                CarId: 'ViewBag.CarId'
            },
            success: function (data) {
                if (data.Msg != "") {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: data.Msg,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }
                else if (data.Msg == "") {
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/PcPos_TransactionList/Index',
                        params: {
                            containerId: "SearchParvande",
                            CarId: 'ViewBag.CarId',
                            CarFileId: 'ViewBag.CarFileId'
                        },
                        success: function (data) {
                            Ext.net.Mask.hide();
                        }
                    });
                }
            }
        });
    }*/
    @*function LoadDetails1() {
        Ext.net.DirectMethod.request({
            url: '/NewVer/Parvande/Details',
            params: {
                Id: '@ViewBag.CarFileId'
            },
            success: function (data) {
                vin = data.fldVIN.toString();
                var twoChar = vin.substr(2, 2);
                var year = vin.substr(4, 2);
                var fiveChar = vin.substr(6, 5);
                var shasi = vin.substring(11);
                var _2char = App.SelectParvande.queryById('_2char');
                _2char.setValue(twoChar).setReadOnly(true);
                var _charModel = App.SelectParvande.queryById('_charModel');
                _charModel.setValue(year).setReadOnly(true);
                var _5char = App.SelectParvande.queryById('_5char');
                _5char.setValue(fiveChar).setReadOnly(true);
                var _charShasi = App.SelectParvande.queryById('_charShasi');
                _charShasi.setValue(shasi).setReadOnly(true);
                var txtMotor = App.SelectParvande.queryById('txtMotor');
                txtMotor.setValue(data.fldMotorNumber).setReadOnly(true);
                var txtShasi = App.SelectParvande.queryById('txtShasi');
                txtShasi.setValue(data.fldShasiNumber).setReadOnly(true);
                var txtDate = App.SelectParvande.queryById('txtDate');
                txtDate.setValue(data.fldStartDateInsurance).setReadOnly(true);
                var txtDateP = App.SelectParvande.queryById('txtDateP');
                txtDateP.setValue(data.fldDatePlaque).setReadOnly(true);
                var cboColor = App.SelectParvande.queryById('cboColor');
                cboColor.setValue(data.fldCarColorID).setReadOnly(true);

                var cboCarMake = App.SelectParvande.queryById('cboCarMake');
                cboCarMake.setValue(data.CarMake).setReadOnly(true);
                var Account = App.SelectParvande.queryById('cboCarAccountTypes');
                Account.clearValue(); Account.getStore().load();
                Account.setValue(data.CarAccountId).setReadOnly(true);
                var cboShort = App.SelectParvande.queryById('cboShort');
                cboShort.clearValue(); cboShort.getStore().load();
                cboShort.setValue(data.sumbolid).setReadOnly(true);
                var cboYear = App.SelectParvande.queryById('cboYear');
                cboYear.clearValue(); cboYear.getStore().load();
                cboYear.setValue(data.fldModel).setReadOnly(true);

                var cboCarCabin = App.SelectParvande.queryById('cboCarCabin');
                cboCarCabin.clearValue(); cboCarCabin.getStore().load();
                cboCarCabin.setValue(data.CabinTypeId).setReadOnly(true);
                var cboSystem = App.SelectParvande.queryById('cboSystem');
                cboSystem.clearValue(); cboSystem.getStore().load();
                cboSystem.setValue(data.CarSystemId).setReadOnly(true);
                var cboModel = App.SelectParvande.queryById('cboModel');
                cboModel.clearValue(); cboModel.getStore().load();
                cboModel.setValue(data.CarModelId).setReadOnly(true);
                var cboClass = App.SelectParvande.queryById('cboClass');
                cboClass.clearValue(); cboClass.getStore().load();
                cboClass.setValue(data.CarClassId).setReadOnly(true);
            }
        });
    }*@
    function LoadDetails() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/Fill',
            params: {
                CarFileId: '@ViewBag.CarFileId'
            },
            success: function (data1) {
                document.getElementById('"KName"' + '@ViewBag.CarFileId').innerText = data1.Malek;
                document.getElementById('"KCode"' + '@ViewBag.CarFileId').innerText = data1.CodeMeli;
                document.getElementById('"KVIN"' + '@ViewBag.CarFileId').innerText = data1.vin;
                document.getElementById('"KPelak1"' + '@ViewBag.CarFileId').innerText = data1.fldPlaqueCityName;
                document.getElementById('"KPelak2"' + '@ViewBag.CarFileId').innerText = data1.fldPlaqueSerial;
                document.getElementById('"KPelak3"' + '@ViewBag.CarFileId').innerText = data1.fldCarPlaqueNumber;
                document.getElementById('"KNo"' + '@ViewBag.CarFileId').innerText = data1.account;
                document.getElementById('"KSystem"' + '@ViewBag.CarFileId').innerText = data1.syst;
                document.getElementById('"KTip"' + '@ViewBag.CarFileId').innerText = data1.modell;
                document.getElementById('"KRang"' + '@ViewBag.CarFileId').innerText = data1.color;
                document.getElementById('"KModel"' + '@ViewBag.CarFileId').innerText = data1.year;
                document.getElementById('"KSukht"' + '@ViewBag.CarFileId').innerText = data1.fldFuelType;
                document.getElementById('"KMotor"' + '@ViewBag.CarFileId').innerText = data1.motor;
                document.getElementById('"KShasi"' + '@ViewBag.CarFileId').innerText = data1.shasi;
                document.getElementById('"mobile"' + '@ViewBag.CarFileId').innerText = "موبایل: " + data1.mobile;
                document.getElementById('"KTedad"' + '@ViewBag.CarFileId').innerText = data1.fldCylinder_Wheel_Pivot;
                var fldCarPlaqueID = Ext.getCmp(tabId).queryById('fldCarPlaqueID');
                fldCarPlaqueID.setValue(data1.fldCarPlaqueIDD);
                var fldMalekId = Ext.getCmp(tabId).queryById('fldMalekId');
                fldMalekId.setValue(data1.fldOwnerID);
                var fldCarId = Ext.getCmp(tabId).queryById('fldCarId');
                fldCarId.setValue(data1.carId);
                var PosIPId = Ext.getCmp(tabId).queryById('PosIPId');
                PosIPId.setValue(data1.PosIPId);
                /*var MenuBill1 = Ext.getCmp("MenuBill" + 'ViewBag.CarFileId');
                MenuBill1.removeAll();
                for (var i = parseInt(data1.currentyear); i > parseInt(data1.shamsiYear)-1; i--) {
                    var menuItem = Ext.create('Ext.menu.Item', {
                        itemId: i,
                        text: i,
                        handler: function (fieldd) {
                            Ext.getCmp(tabId).queryById('yearoftax').setValue(fieldd.text);
                            ShowPnlBill(fieldd.text);
                        }
                    });
                    MenuBill1.add(menuItem);
                }*/

                var shasi = ""; var motor = ""; var vin = "";
                if (data1.shasi == "" || data1.motor == "" || data1.vin == "") {
                    if (data1.shasi == "")
                        shasi = " شماره شاسی،";
                    if (data1.motor == "")
                        motor = " شماره موتور،";
                    if (data1.vin == "")
                        vin = " VIN،";

                    var shasi_motor_vin = "ثبت " + shasi + motor + vin + " ضروری می باشد.";
                    Ext.getCmp(tabId).queryById("shasi_motor_vin").setValue(shasi_motor_vin);
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: shasi_motor_vin,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                }

                var html = "کد ملی:" + data1.CodeMeli + "</br>VIN:" + data1.vin + "</br>شماره پلاک:" + data1.plaq + "</br>شماره موتور:" + data1.motor +
                    "</br>شماره شاسی:" + data1.shasi + "</br>نوع ساخت:" + data1.make + "</br>نوع کاربری:" + data1.account + "</br>نوع کابین:" + data1.cabin + "</br>سیستم خودرو:" + data1.syst + "</br>تیپ خودرو:" +
                    data1.modell + "</br>کلاس خودرو:" + data1.classs + "</br>رنگ خودرو:" + data1.color + "</br>سال تولید:" + data1.year +
                    "</br>تاریخ پلاک گذاری:" + data1.datep + "</br>تاریخ اولین بیمه:" + data1.date;
                Ext.create('Ext.tip.ToolTip', {
                    target: Ext.getCmp(tabId).tab,
                    anchorToTarget: true,
                    anchorOffset: 25,
                    anchorSize: {
                        width: 58,
                        height: 20
                    },
                    anchor: 'top',
                    closable: false,
                    dismissDelay: 0,
                    baseCls: 'ifs-tooltip',
                    shadow: false,
                    autoHide: true,
                    showDelay: 0,
                    html: html
                });

                var menu_grid = new Ext.menu.Menu({
                    items: [
                        { text: "انتقال سوابق", iconCls: "Savabegh", handler: function () { ShowPnlSavabegh(); } },
                        { text: "تایید پرونده", iconCls: "tick", handler: function () { CarFileTaid(); } },
                        { text: "صورت حساب", iconCls: "soorathesab", handler: function () { ShowPnlBill(0); } },
                        { text: "ثبت واریزی", iconCls: "Varizi", handler: function () { ShowPnlVarizi(); } },
                        { text: "مفاصا حساب", iconCls: "Mafasa", handler: function () { Mafasa(); } },
                        { text: "حذف فیش های تکراری", iconCls: "Tekrari", handler: function () { HazfTekrari(); } },
                        { text: "لیست سیاه", iconCls: "Siah", handler: function () { ShowPnlBlackList(); } },
                        { text: "آرشیو", iconCls: "Archive", handler: function () { Archive(); } },
                        { text: "خلاصه وضعیت", iconCls: "kholase", handler: function () { kholaseVaziyat(); } },
                        { text: "ویرایش مشخصات خودرو", iconCls: "VMoshakhasat", handler: function () { ShowPnlEditCar(); } },
                        { text: "ویرایش مشخصات مالک", iconCls: "VTasavir", handler: function () { EditMalek(); } },
                        { text: "تعویض مالک", iconCls: "VMalek", handler: function () { ShowPnlChangeMalek(); } },
                        { text: "راهنمای Html", iconCls: "Helpp", handler: function () { HelpHtml(); } },
                        { text: "پیگیری پرداخت های کارتخوان", iconCls: "pishkhanpos", handler: function () { ListPishkhanpos(); } },
                        { text: "پیگیری رسیدهای کارتخوان", iconCls: "pishkhanReciept", handler: function () { ListPishkhanReciept(); } }
                    ]
                });
                App.AvarezWin.body.mask().hide();
                Ext.net.Mask.hide();

                Ext.getCmp(tabId).add(menu_grid);
                Ext.getCmp(tabId).body.on("contextmenu", function (e) { var position = e.getXY(); e.stopEvent(); menu_grid.showAt(position); });
                @*if (data1.fldBargSabzFileId == null)
                    Ext.getCmp("SelectParvande" + '@ViewBag.CarFileId').queryById('btnShow1').setDisabled(true);
                if (data1.fldCartFileId == null)
                    Ext.getCmp("SelectParvande" + '@ViewBag.CarFileId').queryById('btnShow2').setDisabled(true);
                if (data1.fldCartBackFileId == null)
                    Ext.getCmp("SelectParvande" + '@ViewBag.CarFileId').queryById('btnShow3').setDisabled(true);
                if (data1.fldSanadForoshFileId == null)
                    Ext.getCmp("SelectParvande" + '@ViewBag.CarFileId').queryById('btnShow4').setDisabled(true);*@

                /*shasi_motor_vin = "";
                var shasi = ""; var motor = ""; var vin = "";
                if (data1.shasi == "" || data1.motor == "" || data1.vin == "") {
                    if (data1.shasi == "")
                        shasi = " شماره شاسی،";
                    if (data1.motor == "")
                        motor = " شماره موتور،";
                    if (data1.vin == "")
                        vin = " VIN،";

                    shasi_motor_vin = "ثبت " + shasi + motor + vin + " ضروری می باشد.";
                }*/
            }
        });
    }

    function HelpHtml() {
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/HelpHtml',
            params: {

            },
            success: function (data) {
                App.AvarezWin.body.mask().hide();
            }
        });
    }

    var addKeyMapSelectParvande = function (cmp) {
        this.keyMap = new Ext.util.KeyMap({
            target: cmp.getEl(),
            binding: [{
                key: [13, 9], /*Ext.EventObject.ENTER,*/
                fn: function (key, e) {
                    if (e.getKey() == 9) {
                        e.stopEvent();
                    }
                    var tabId = App.SearchParvande.activeTab.id;
                    if (App.AvarezTab.activeTab.id == "SearchParvande") {
                        if (App.SearchParvande.activeTab.id != "Parvande") {
                            if (Ext.getCmp(tabId).queryById("pnlforSavabegh").hidden == false) {
                                var nextfld;
                                var keyfield = Ext.getCmp(tabId).queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                                if (keyfield.itemId == "cboState") {
                                    nextfld = Ext.getCmp(tabId).queryById("cboMun");
                                    nextfld.focus();
                                    nextfld.selectText();
                                }
                                else if (keyfield.itemId == "cboMun") {
                                    nextfld = Ext.getCmp(tabId).queryById("CboAzSal");
                                    nextfld.focus();
                                    nextfld.selectText();
                                }
                                else if (keyfield.itemId == "CboAzSal") {
                                    nextfld = Ext.getCmp(tabId).queryById("CboTaSal");
                                    nextfld.focus();
                                    nextfld.selectText();
                                }
                                else if (keyfield.itemId == "CboTaSal") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtShName");
                                    nextfld.focus();
                                    nextfld.selectText();
                                }
                                else if (keyfield.itemId == "txtShName") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtDesc");
                                    nextfld.focus();
                                    nextfld.selectText();
                                }
                            }
                            else if (Ext.getCmp(tabId).queryById("pnlforVarizi").hidden == false) {
                                var nextfld;
                                var keyfield = Ext.getCmp(tabId).queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                                if (keyfield.itemId == "cboNoePardakht" && Ext.getCmp(tabId).queryById("cboNoePardakht").getValue() == "1") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtSerial");
                                }
                                else if (keyfield.itemId == "cboNoePardakht" && Ext.getCmp(tabId).queryById("cboNoePardakht").getValue() == "2") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtMun");
                                }
                                else if (keyfield.itemId == "txtSerial") {
                                    nextfld = Ext.getCmp(tabId).queryById("CboNoeVariz");
                                }
                                else if (keyfield.itemId == "txtMun") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtSerialFish");
                                }
                                else if (keyfield.itemId == "txtDateVariz") {
                                    nextfld = Ext.getCmp(tabId).queryById("cboNoePardakht");
                                }
                                else if (keyfield.itemId == "txtSerialFish") {
                                    nextfld = Ext.getCmp(tabId).queryById("CboNoeVariz");
                                }
                                else if (keyfield.itemId == "CboNoeVariz") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtPrice");
                                }
                                else if (keyfield.itemId == "txtPrice") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtSerialLable");
                                }
                                else if (keyfield.itemId == "txtSerialLable") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtDescV");
                                }
                                if (keyfield.itemId == "txtDescV") {
                                    if (Ext.getCmp(tabId).queryById("cboNoePardakht").getValue() == "1") {
                                        SaveVarizi();
                                        return;
                                    }
                                    else {
                                        return;
                                    }
                                }
                                nextfld.focus();
                            }
                            else if (Ext.getCmp(tabId).queryById("pnlforEditCar").hidden == false) {
                                var nextfld;
                                var keyfield = Ext.getCmp(tabId).queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                                if (keyfield.itemId == "cboYear") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtDateD");
                                }
                                else if (keyfield.itemId == "txtDateM") {
                                    nextfld = Ext.getCmp(tabId).queryById("txtDateY");
                                }
                                else if (keyfield.itemId == "txtDateY") {
                                    nextfld = Ext.getCmp(tabId).queryById("cboShort");
                                }
                                else if (keyfield.itemId == "cboShort") {
                                    nextfld = Ext.getCmp(tabId).queryById("_2char");
                                }
                                else if (keyfield.itemId == "_2char") {
                                    nextfld = Ext.getCmp(tabId).queryById("_charModel");
                                }
                                else if (keyfield.itemId == "_charModel") {
                                    nextfld = Ext.getCmp(tabId).queryById("_5char");
                                }
                                else if (keyfield.itemId == "_5char") {
                                    SavePropertyCar();
                                }
                                else {
                                    nextfld = keyfield.nextSibling().nextSibling();
                                }
                                nextfld.focus();
                            }
                            else if (Ext.getCmp(tabId).queryById("pnlforBlackList").hidden == false) {
                                var nextfld;
                                var keyfield = Ext.getCmp(tabId).queryById(Ext.getCmp((Ext.Element.getActiveElement()).name).itemId);
                                if (keyfield.itemId == "txtMsg") {
                                    return;
                                }
                                else {
                                    nextfld = keyfield.nextSibling().nextSibling();
                                }
                                nextfld.focus();
                            }
                        }
                    }
                }
            }]
        });
    };

    function kholaseVaziyat() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
            openWindowWithPost("/NewVer/SelectParvande/NewSooratVaziyat", {
                CarFileId: tabId.substring(14)
            });
        }
        else {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/NewSooratVaziyat_Win',
                params: {
                    CarFileId: tabId.substring(14)
                }
            });
        }
        /*var param = {
            CarFileId: tabId.substring(14)
        };
        OpenWindowWithPost1("/NewVer/SelectParvande/NewSooratVaziyat",
        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
        "NewWindow", param);*/
        App.AvarezWin.body.mask().hide();
        /* Ext.net.DirectMethod.request({
             url: '/NewVer/SelectParvande/NewSooratVaziyat',
             params: {
                 CarFileId: tabId.substring(14)
             },
             success: function (data) {
                 Ext.net.Mask.hide();
             }
         });*/
    }

    /*function ShowMadrakVariz(record) {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/PreviewFile/Index',
            params: {
                State: "2",
                Id: record.data.fldID
            },
            success: function () {
                Ext.net.Mask.hide();
            }
        });
    }


      var tabId = App.SearchParvande.activeTab.id;
      CarFileId: tabId.substring(14)
    /*function refreshgrid() {
        App.SelectParvande.queryById('GridSavabegh').getView().refresh();
        App.SelectParvande.queryById('GridVarizi').getView().refresh();
    }*/

    /*function HelpSelectParvande() {
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/HelpSelectParvande',
            params: {

            },
            success: function (data) {
                Ext.net.Mask.hide();
            }
        });
    }*/


    function ListPishkhanpos() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/AppReport_New/UnsuccessfulPayments',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (result1) {
                App.AvarezWin.body.mask().hide();
            }
        });
        Ext.net.Mask.hide();
    }

    function ListPishkhanReciept() {
        var tabId = App.SearchParvande.activeTab.id;
        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/AppReport_New/UnsuccessfulReciept',
            params: {
                CarFileId: tabId.substring(14)
            },
            success: function (result1) {
                App.AvarezWin.body.mask().hide();
            }
        });
        Ext.net.Mask.hide();
    }



    function PrintDetails() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
            openWindowWithPost("/NewVer/SelectParvande/PrintJoziyatAvarezTab", {
                CarFileId: tabId.substring(14)
            });
        }
        else {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/printJoziyatAvarezWin',
                params: {
                    CarFileId: tabId.substring(14)
                },
                success: function (result1) {
                }
            });
        }
        /*var param = {
            CarFileId: tabId.substring(14)
        };
        OpenWindowWithPost1("/NewVer/SelectParvande/PrintJoziyatAvarezTab",
        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
        "NewWindow", param);*/
        Ext.net.Mask.hide();
    }

    function PrintDetails2() {
        var tabId = App.SearchParvande.activeTab.id;
        Ext.net.Mask.show({ msg: 'در حال بارگذاری...' });
        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
            openWindowWithPost("/NewVer/SelectParvande/PrintAllJoziyatAvarezTab", {
                CarFileId: tabId.substring(14),
                Year: Ext.getCmp(tabId).queryById('yearoftax').getValue(),
                Price: Ext.getCmp(tabId).queryById('FinallPrice').getValue()
            });
        }
        else {
            Ext.net.DirectMethod.request({
                url: '/NewVer/SelectParvande/PrintAllJoziyatAvarezWin',
                params: {
                    CarFileId: tabId.substring(14),
                    Year: Ext.getCmp(tabId).queryById('yearoftax').getValue(),
                    Price: Ext.getCmp(tabId).queryById('FinallPrice').getValue()
                }
            });
        }
        Ext.net.Mask.hide();
    }

    function Fish1() {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");
                    var Mablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");

                    if (Ext.getCmp(tabId).queryById("AvarezMablagh").text == "" || parseInt(Ext.getCmp(tabId).queryById("AvarezMablagh").text) == 0) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "مبلغ عوارض 0 ریال است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        App.AvarezWin.body.mask("در حال بارگذاری...");
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/CheckBlackList',
                            params: {
                                CarFileId: tabId.substring(14)
                            },
                            success: function (data) {
                                if (data.Msg != "") {
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: data.Msg,
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                                else {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/SelectParvande/GetPicStatus',
                                        params: {
                                            CarFileid: tabId.substring(14)
                                        },
                                        success: function (result) {
                                            if (result.status == false && result.ForceScan == "1") {
                                                var str = "";
                                                if (result.carfile == 1)
                                                    str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                                                if (result.coll == 1)
                                                    str += " واریزی علی الحساب ";
                                                Ext.MessageBox.show({
                                                    title: "خطا",
                                                    msg: "تصاویر مربوط به " + str + " بارگذاری نشده است.",
                                                    icon: Ext.MessageBox.ERROR,
                                                    buttons: Ext.MessageBox.OK
                                                });
                                                App.AvarezWin.body.mask().hide();
                                            }
                                            else if (result.status1 == false && result.ExpScan == "1") {
                                                var str = "";
                                                if (result.carext == 1)
                                                    str += " انتقال سوابق ";
                                                Ext.MessageBox.show({
                                                    title: "خطا",
                                                    msg: "تصاویر مربوط به " + str + " بارگذاری نشده است.",
                                                    icon: Ext.MessageBox.ERROR,
                                                    buttons: Ext.MessageBox.OK
                                                });
                                                App.AvarezWin.body.mask().hide();
                                            }
                                            else {
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/CheckExistFish',
                                                    params: {
                                                        carFileid: tabId.substring(14),
                                                        showmoney: Mablagh.getValue()
                                                    },
                                                    success: function (result) {
                                                        if (result.state == 0) {
                                                            /*var param = {
                                                                CarFileId: tabId.substring(14),
                                                                mablagh: Mablagh.getValue(),
                                                                fldFine: fldFine.getValue(),
                                                                fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                fldPrice: fldPrice.getValue(),
                                                                Years: Years.getValue(),
                                                                Bed: Bed.getValue(),
                                                                fldOtherPrice: fldOtherPrice.getValue(),
                                                                fldMainDiscount: fldMainDiscount.getValue(),
                                                                fldFineDiscount: fldFineDiscount.getValue(),
                                                                fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                fldOtherDiscount: fldOtherDiscount.getValue()
                                                            };
                                                            OpenWindowWithPost1("/NewVer/SelectParvande/FishReport",
                                                            "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                            "NewWindow", param);*/
                                                            if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                                openWindowWithPost("/NewVer/SelectParvande/FishReport", {
                                                                    CarFileId: tabId.substring(14),
                                                                    mablagh: Mablagh.getValue(),
                                                                    fldFine: fldFine.getValue(),
                                                                    fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                    fldPrice: fldPrice.getValue(),
                                                                    Years: Years.getValue(),
                                                                    Bed: Bed.getValue(),
                                                                    fldOtherPrice: fldOtherPrice.getValue(),
                                                                    fldMainDiscount: fldMainDiscount.getValue(),
                                                                    fldFineDiscount: fldFineDiscount.getValue(),
                                                                    fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                    fldOtherDiscount: fldOtherDiscount.getValue()
                                                                });
                                                            }
                                                            else {
                                                                Ext.net.DirectMethod.request({
                                                                    url: '/NewVer/SelectParvande/FishReportWin',
                                                                    params: {
                                                                        CarFileId: tabId.substring(14),
                                                                        mablagh: Mablagh.getValue(),
                                                                        fldFine: fldFine.getValue(),
                                                                        fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                        fldPrice: fldPrice.getValue(),
                                                                        Years: Years.getValue(),
                                                                        Bed: Bed.getValue(),
                                                                        fldOtherPrice: fldOtherPrice.getValue(),
                                                                        fldMainDiscount: fldMainDiscount.getValue(),
                                                                        fldFineDiscount: fldFineDiscount.getValue(),
                                                                        fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                        fldOtherDiscount: fldOtherDiscount.getValue()
                                                                    }
                                                                });
                                                            }
                                                            App.AvarezWin.body.mask().hide();
                                                        }
                                                        else {
                                                            Ext.MessageBox.show({
                                                                title: "هشدار",
                                                                msg: "آیا مایل به چاپ فیش المثنی هستید؟",
                                                                icon: Ext.MessageBox.WARNING,
                                                                buttons: Ext.MessageBox.YESNO,
                                                                fn: function (btn) {
                                                                    if (btn == 'yes') {
                                                                        /*var param = {
                                                                            PeacockeryId: result.PeacockeryId,
                                                                            mablagh: Mablagh.getValue(),
                                                                            fldFine: fldFine.getValue(),
                                                                            fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                            fldPrice: fldPrice.getValue(),
                                                                            Years: Years.getValue(),
                                                                            Bed: Bed.getValue(),
                                                                            fldOtherPrice: fldOtherPrice.getValue(),
                                                                            fldMainDiscount: fldMainDiscount.getValue(),
                                                                            fldFineDiscount: fldFineDiscount.getValue(),
                                                                            fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                            fldOtherDiscount: fldOtherDiscount.getValue()
                                                                        };
                                                                        OpenWindowWithPost1("/NewVer/SelectParvande/_FishReport",
                                                                        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                                        "NewWindow", param);*/
                                                                        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                                            openWindowWithPost("/NewVer/SelectParvande/_FishReport", {
                                                                                PeacockeryId: result.PeacockeryId,
                                                                                mablagh: Mablagh.getValue(),
                                                                                fldFine: fldFine.getValue(),
                                                                                fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                                fldPrice: fldPrice.getValue(),
                                                                                Years: Years.getValue(),
                                                                                Bed: Bed.getValue(),
                                                                                fldOtherPrice: fldOtherPrice.getValue(),
                                                                                fldMainDiscount: fldMainDiscount.getValue(),
                                                                                fldFineDiscount: fldFineDiscount.getValue(),
                                                                                fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                                fldOtherDiscount: fldOtherDiscount.getValue()
                                                                            });
                                                                        }
                                                                        else {
                                                                            Ext.net.DirectMethod.request({
                                                                                url: '/NewVer/SelectParvande/_FishReportWin',
                                                                                params: {
                                                                                    PeacockeryId: result.PeacockeryId,
                                                                                    mablagh: Mablagh.getValue(),
                                                                                    fldFine: fldFine.getValue(),
                                                                                    fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                                    fldPrice: fldPrice.getValue(),
                                                                                    Years: Years.getValue(),
                                                                                    Bed: Bed.getValue(),
                                                                                    fldOtherPrice: fldOtherPrice.getValue(),
                                                                                    fldMainDiscount: fldMainDiscount.getValue(),
                                                                                    fldFineDiscount: fldFineDiscount.getValue(),
                                                                                    fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                                    fldOtherDiscount: fldOtherDiscount.getValue()
                                                                                }
                                                                            });
                                                                        }
                                                                    } else {
                                                                        /*var param = {
                                                                            CarFileId: tabId.substring(14),
                                                                            mablagh: Mablagh.getValue(),
                                                                            fldFine: fldFine.getValue(),
                                                                            fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                            fldPrice: fldPrice.getValue(),
                                                                            Years: Years.getValue(),
                                                                            Bed: Bed.getValue(),
                                                                            fldOtherPrice: fldOtherPrice.getValue(),
                                                                            fldMainDiscount: fldMainDiscount.getValue(),
                                                                            fldFineDiscount: fldFineDiscount.getValue(),
                                                                            fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                            fldOtherDiscount: fldOtherDiscount.getValue()
                                                                        };
                                                                        OpenWindowWithPost1("/NewVer/SelectParvande/FishReport",
                                                                        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                                                                        "NewWindow", param);*/
                                                                        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                                                                            openWindowWithPost("/NewVer/SelectParvande/FishReport", {
                                                                                CarFileId: tabId.substring(14),
                                                                                mablagh: Mablagh.getValue(),
                                                                                fldFine: fldFine.getValue(),
                                                                                fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                                fldPrice: fldPrice.getValue(),
                                                                                Years: Years.getValue(),
                                                                                Bed: Bed.getValue(),
                                                                                fldOtherPrice: fldOtherPrice.getValue(),
                                                                                fldMainDiscount: fldMainDiscount.getValue(),
                                                                                fldFineDiscount: fldFineDiscount.getValue(),
                                                                                fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                                fldOtherDiscount: fldOtherDiscount.getValue()
                                                                            });
                                                                        }
                                                                        else {
                                                                            Ext.net.DirectMethod.request({
                                                                                url: '/NewVer/SelectParvande/FishReportWin',
                                                                                params: {
                                                                                    CarFileId: tabId.substring(14),
                                                                                    mablagh: Mablagh.getValue(),
                                                                                    fldFine: fldFine.getValue(),
                                                                                    fldValueAddPrice: fldValueAddPrice.getValue(),
                                                                                    fldPrice: fldPrice.getValue(),
                                                                                    Years: Years.getValue(),
                                                                                    Bed: Bed.getValue(),
                                                                                    fldOtherPrice: fldOtherPrice.getValue(),
                                                                                    fldMainDiscount: fldMainDiscount.getValue(),
                                                                                    fldFineDiscount: fldFineDiscount.getValue(),
                                                                                    fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                                                    fldOtherDiscount: fldOtherDiscount.getValue()
                                                                                }
                                                                            });
                                                                        }
                                                                    }
                                                                    App.AvarezWin.body.mask().hide();
                                                                }
                                                            });
                                                        }
                                                    }
                                                });
                                            }
                                        }
                                    });
                                }
                            }
                        });
                    }
                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به صدور فیش نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

    function DownloadFish() {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");
                    var Mablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");

                    if (Ext.getCmp(tabId).queryById("AvarezMablagh").text == "" || parseInt(Ext.getCmp(tabId).queryById("AvarezMablagh").text) == 0) {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: "مبلغ عوارض 0 ریال است.",
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        App.AvarezWin.body.mask("در حال بارگذاری...");
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/GetPicStatus',
                            params: {
                                CarFileid: tabId.substring(14)
                            },
                            success: function (result) {
                                if (result.status == false && result.ForceScan == "1") {
                                    var str = "";
                                    if (result.carfile == 1)
                                        str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                                    if (result.coll == 1)
                                        str += " واریزی علی الحساب ";
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                                else if (result.status == false && result.ExpScan == "1") {
                                    var str = "";
                                    if (result.carext == 1)
                                        str += " انتقال سوابق ";
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است.",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                                else {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/SelectParvande/CheckExistFish',
                                        params: {
                                            carFileid: tabId.substring(14),
                                            showmoney: Mablagh.getValue()
                                        },
                                        success: function (result) {
                                            if (result.state == 0) {
                                                window.location.href = '@Url.Content("/NewVer/SelectParvande/DownloadFish?CarFileId=")'
                                                    + tabId.substring(14) + '&mablagh=' + Mablagh.getValue() + '&fldFine=' + fldFine.getValue()
                                                    + '&fldValueAddPrice=' + fldValueAddPrice.getValue() + '&fldPrice=' + fldPrice.getValue() + '&Years=' + Years.getValue()
                                                    + '&Bed=' + Bed.getValue() + '&fldOtherPrice=' + fldOtherPrice.getValue() + '&fldMainDiscount=' + fldMainDiscount.getValue()
                                                    + '&fldFineDiscount=' + fldFineDiscount.getValue() + '&fldValueAddDiscount=' + fldValueAddDiscount.getValue()
                                                    + '&fldOtherDiscount=' + fldOtherDiscount.getValue();
                                                App.AvarezWin.body.mask().hide();
                                            }
                                            else {
                                                Ext.MessageBox.show({
                                                    title: "هشدار",
                                                    msg: "آیا مایل به دانلود فیش المثنی هستید؟",
                                                    icon: Ext.MessageBox.WARNING,
                                                    buttons: Ext.MessageBox.YESNO,
                                                    fn: function (btn) {
                                                        if (btn == 'yes') {
                                                            window.location.href = '@Url.Content("/NewVer/SelectParvande/_DownloadFish?PeacockeryId=")'
                                                                + result.PeacockeryId + '&mablagh=' + Mablagh.getValue() + '&fldFine=' + fldFine.getValue()
                                                                + '&fldValueAddPrice=' + fldValueAddPrice.getValue() + '&fldPrice=' + fldPrice.getValue() + '&Years=' + Years.getValue()
                                                                + '&Bed=' + Bed.getValue() + '&fldOtherPrice=' + fldOtherPrice.getValue() + '&fldMainDiscount=' + fldMainDiscount.getValue()
                                                                + '&fldFineDiscount=' + fldFineDiscount.getValue() + '&fldValueAddDiscount=' + fldValueAddDiscount.getValue()
                                                                + '&fldOtherDiscount=' + fldOtherDiscount.getValue();
                                                        }
                                                        else {
                                                            window.location.href = '@Url.Content("/NewVer/SelectParvande/DownloadFish?CarFileId=")'
                                                                + tabId.substring(14) + '&mablagh=' + Mablagh.getValue() + '&fldFine=' + fldFine.getValue()
                                                                + '&fldValueAddPrice=' + fldValueAddPrice.getValue() + '&fldPrice=' + fldPrice.getValue() + '&Years=' + Years.getValue()
                                                                + '&Bed=' + Bed.getValue() + '&fldOtherPrice=' + fldOtherPrice.getValue() + '&fldMainDiscount=' + fldMainDiscount.getValue()
                                                                + '&fldFineDiscount=' + fldFineDiscount.getValue() + '&fldValueAddDiscount=' + fldValueAddDiscount.getValue()
                                                                + '&fldOtherDiscount=' + fldOtherDiscount.getValue();
                                                        }
                                                        App.AvarezWin.body.mask().hide();
                                                    }
                                                });
                                            }
                                        }
                                    });
                                }
                            }
                        });
                    }
                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به صدور فیش نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

    function OfficeRecipt1() {
        var tabId = App.SearchParvande.activeTab.id;
        var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");

        App.AvarezWin.body.mask("در حال بارگذاری...");
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/GetPicStatus',
            params: {
                CarFileid: tabId.substring(14)
            },
            success: function (result) {
                if (result.status == false && result.ForceScan == "1") {
                    var str = "";
                    if (result.carfile == 1)
                        str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                    if (result.coll == 1)
                        str += " واریزی علی الحساب ";
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    App.AvarezWin.body.mask().hide();
                }
                else if (result.status1 == false && result.ExpScan == "1") {
                    var str = "";
                    if (result.carext == 1)
                        str += " انتقال سوابق ";
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    App.AvarezWin.body.mask().hide();
                }
                else {
                    if (shasi_motor_vin.getValue() != "") {
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: shasi_motor_vin.getValue(),
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });
                    }
                    else {
                        if ('@ViewBag.ImageSetting' == "3" || '@ViewBag.ImageSetting' == "2" || '@ViewBag.ImageSetting' == "4") {
                            openWindowWithPost("/NewVer/SelectParvande/PrintResidDaftarTab", {
                                CarFileId: tabId.substring(14)
                            });
                        }
                        else {
                            Ext.net.DirectMethod.request({
                                url: '/NewVer/SelectParvande/PrintResidDaftarWin',
                                params: {
                                    CarFileId: tabId.substring(14)
                                }
                            });
                        }
                        /*var param = {
                            CarFileId: tabId.substring(14)
                        };
                        OpenWindowWithPost1("/NewVer/SelectParvande/PrintResidDaftarTab",
                        "width=750,height=550,left=100,top=100,resizable=yes,scrollbars=yes",
                        "NewWindow", param);*/
                    }
                    App.AvarezWin.body.mask().hide();
                }
            }
        });
    }
    function showHidebtnpose() {
        var tabId = App.SearchParvande.activeTab.id;
        if (Ext.getCmp(tabId).queryById('PosIPId').getValue() != "0") {
            Ext.getCmp(tabId).queryById('btnPos').show();
        }
        else {
            Ext.getCmp(tabId).queryById('btnPos').hide();
        }
    }

    function PayPos() {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var Mablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");

                    App.AvarezWin.body.mask('در حال انجام عملیات...');
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/GetPicStatus',
                        params: {
                            CarFileid: tabId.substring(14)
                        },
                        success: function (result) {
                            if (result.status == false && result.ForceScan == "1") {
                                var str = "";
                                if (result.carfile == 1)
                                    str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                                if (result.coll == 1)
                                    str += " واریزی علی الحساب ";
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                                App.AvarezWin.body.mask().hide();
                            }
                            else if (result.status1 == false && result.ExpScan == "1") {
                                var str = "";
                                if (result.carext == 1)
                                    str += " انتقال سوابق ";
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                                App.AvarezWin.body.mask().hide();
                            }
                            else {
                                if ('@ViewBag.ImageSetting' == "6") {
                                    App.AvarezWin.body.mask().hide();
                                    var win = Ext.create('Ext.window.Window', {
                                        title: '',
                                        buttonAlign: 'center',
                                        width: 300,
                                        height: 100,
                                        id: "Bwindow",
                                        closable: true,
                                        resizable: false,
                                        layout: {
                                            type: 'vbox',
                                            align: 'center'
                                        },
                                        modal: true,
                                        items: [{
                                            xtype: 'textfield',
                                            fieldLabel: 'سریال برچسب:',
                                            itemId: 'serial_B',
                                            margin: "10px",
                                            allowBlank: true,
                                            blankText: "لطفاً سریال را وارد نمایید."
                                        },
                                        {
                                            xtype: 'button',
                                            text: 'ادامه',
                                            width: 50,
                                            listeners: {
                                                click: function (button) {
                                                    if (win.queryById('serial_B').validate() == false) { return; }
                                                    var serial_B = win.queryById('serial_B').getValue();
                                                    win.destroy();
                                                    App.AvarezWin.body.mask('در حال انجام عملیات...');
                                                    Ext.net.DirectMethod.request({
                                                        url: '/NewVer/SelectParvande/PcPosPay',
                                                        params: {
                                                            CarFileId: tabId.substring(14),
                                                            Mablagh: Mablagh.getValue(),
                                                            PosIPId: Ext.getCmp(tabId).queryById('PosIPId').getValue(),
                                                            fldFine: fldFine.getValue(),
                                                            fldValueAddPrice: fldValueAddPrice.getValue(),
                                                            fldPrice: fldPrice.getValue(),
                                                            Years: Years.getValue(),
                                                            Bed: Bed.getValue(),
                                                            fldOtherPrice: fldOtherPrice.getValue(),
                                                            fldMainDiscount: fldMainDiscount.getValue(),
                                                            fldFineDiscount: fldFineDiscount.getValue(),
                                                            fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                            fldOtherDiscount: fldOtherDiscount.getValue(),
                                                            serialBarchasb: serial_B
                                                        },
                                                        success: function (data) {
                                                            App.AvarezWin.body.mask().hide();
                                                            var ico = Ext.MessageBox.INFO;
                                                            if (data.Er == 1) {
                                                                ico = Ext.MessageBox.ERROR;
                                                            }
                                                            Ext.MessageBox.show({
                                                                title: data.MsgTitle,
                                                                msg: data.msg,
                                                                icon: ico,
                                                                buttons: Ext.MessageBox.OK
                                                            });
                                                            if (data.Er != 1) {
                                                                var valuee = Ext.getCmp(tabId).queryById('yearoftax').getValue();
                                                                LoadBill(valuee);
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                        }]
                                    });
                                    win.show();
                                }
                                else {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/SelectParvande/PcPosPay',
                                        params: {
                                            CarFileId: tabId.substring(14),
                                            Mablagh: Mablagh.getValue(),
                                            PosIPId: Ext.getCmp(tabId).queryById('PosIPId').getValue(),
                                            fldFine: fldFine.getValue(),
                                            fldValueAddPrice: fldValueAddPrice.getValue(),
                                            fldPrice: fldPrice.getValue(),
                                            Years: Years.getValue(),
                                            Bed: Bed.getValue(),
                                            fldOtherPrice: fldOtherPrice.getValue(),
                                            fldMainDiscount: fldMainDiscount.getValue(),
                                            fldFineDiscount: fldFineDiscount.getValue(),
                                            fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                            fldOtherDiscount: fldOtherDiscount.getValue()
                                        },
                                        success: function (data) {
                                            if (data.BankId == 20) {/*بانک شهر*/
                                                var ico = Ext.MessageBox.INFO;
                                                if (data.Er == 1) {
                                                    ico = Ext.MessageBox.ERROR;
                                                }
                                                Ext.MessageBox.show({
                                                    title: data.MsgTitle,
                                                    msg: data.msg,
                                                    icon: ico,
                                                    buttons: Ext.MessageBox.OK
                                                });
                                                if (data.Er != 1) {
                                                    var valuee = Ext.getCmp(tabId).queryById('yearoftax').getValue();
                                                    LoadBill(valuee);
                                                }
                                                App.AvarezWin.body.mask().hide();
                                            }
                                            else if (data.BankId == 17) {/*بانک سامان*/
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/SamanPcPosPay',
                                                    params: {
                                                        fishid: data.fishid,
                                                        PosIPId: data.PosIPId
                                                    },
                                                    success: function () {
                                                        App.AvarezWin.body.mask().hide();
                                                    }
                                                });
                                            }
                                            else if (data.BankId == 15) {/*بانک پارسیان*/
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/ParsianPcPosPay',
                                                    params: {
                                                        fishid: data.fishid,
                                                        PosIPId: data.PosIPId
                                                    },
                                                    success: function () {
                                                        App.AvarezWin.body.mask().hide();
                                                    }
                                                });
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    });
                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به پرداخت نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

    function Next1() {
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var shasi_motor_vin = Ext.getCmp(tabId).queryById("shasi_motor_vin");
                    var Mablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");

                    App.AvarezWin.body.mask('در حال بارگذاری...');
                    Ext.net.DirectMethod.request({
                        url: '/NewVer/SelectParvande/GetPicStatus',
                        params: {
                            CarFileid: tabId.substring(14)
                        },
                        success: function (result) {
                            if (result.Er == 0) {
                                if (result.status == false && result.ForceScan == "1") {
                                    var str = "";
                                    if (result.carfile == 1)
                                        str += " پرونده خودرو(برگ سبز، کارت خودرو، سند کارخانه) ";
                                    if (result.coll == 1)
                                        str += " واریزی علی الحساب ";
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                                else if (result.status1 == false && result.ExpScan == "1") {
                                    var str = "";
                                    if (result.carext == 1)
                                        str += " انتقال سوابق ";
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: "تصاویر مربوط به " + str + " بارگذاری نشده است",
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                                    App.AvarezWin.body.mask().hide();
                                }
                                else {
                                    if (shasi_motor_vin.getValue() != "") {
                                        Ext.MessageBox.show({
                                            title: "خطا",
                                            msg: shasi_motor_vin.getValue(),
                                            icon: Ext.MessageBox.ERROR,
                                            buttons: Ext.MessageBox.OK
                                        });
                                        App.AvarezWin.body.mask().hide();
                                    }
                                    else {
                                        var bankid = 0;
                                        var h = document.getElementsByName('Bank');
                                        for (var i = 0; i < h.length; i++) {
                                            if (h[i].checked == true)
                                                bankid = h[i].value;
                                        }
                                        if (Mablagh.getValue() >= 1000) {
                                            if (bankid == 0) {
                                                Ext.MessageBox.show({
                                                    title: "خطا",
                                                    msg: "ابتدا بانک مورد نظر را انتخاب کنید.",
                                                    icon: Ext.MessageBox.ERROR,
                                                    buttons: Ext.MessageBox.OK
                                                });
                                                App.AvarezWin.body.mask().hide();
                                            }
                                            else {
                                                Ext.net.DirectMethod.request({
                                                    url: '/NewVer/SelectParvande/GoToOnlinePay',
                                                    params: {
                                                        Amount: Mablagh.getValue(),
                                                        CarFileid: tabId.substring(14),
                                                        BankId: bankid,
                                                        fldFine: fldFine.getValue(),
                                                        fldValueAddPrice: fldValueAddPrice.getValue(),
                                                        fldPrice: fldPrice.getValue(),
                                                        Years: Years.getValue(),
                                                        Bed: Bed.getValue(),
                                                        fldOtherPrice: fldOtherPrice.getValue(),
                                                        fldMainDiscount: fldMainDiscount.getValue(),
                                                        fldFineDiscount: fldFineDiscount.getValue(),
                                                        fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                                        fldOtherDiscount: fldOtherDiscount.getValue()
                                                    },
                                                    success: function (data1) {
                                                        Ext.net.DirectMethod.request({
                                                            url: data1,
                                                            success: function () {
                                                                App.AvarezWin.body.mask().hide();
                                                            }
                                                        });
                                                    }
                                                });
                                            }
                                        }
                                        else {
                                            Ext.MessageBox.show({
                                                title: "خطا",
                                                msg: "مبلغ پرداخت کمتر از میزان مجاز برای پرداخت اینترنتی است.",
                                                icon: Ext.MessageBox.ERROR,
                                                buttons: Ext.MessageBox.OK
                                            });
                                            App.AvarezWin.body.mask().hide();
                                        }
                                    }
                                }
                            }
                            else {
                                Ext.MessageBox.show({
                                    title: "خطا",
                                    msg: result.Msg,
                                    icon: Ext.MessageBox.ERROR,
                                    buttons: Ext.MessageBox.OK
                                });
                                App.AvarezWin.body.mask().hide();
                            }
                        }
                    });
                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به پرداخت نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

</script>
<script>

    function pishkhan(type) {
        paytype = type;
        var tabId = App.SearchParvande.activeTab.id;
        $.ajax({
            url: "/NewVer/SelectParvande/CheckTaeedSavabeghfromnow",
            type: 'get',
            datatype: 'json',
            data: {
                carFileId: tabId.substring(14)
            },
            error: function (xhr, status, error) {
                Ext.MessageBox.show({
                    title: "خطا",
                    msg: "",
                    icon: Ext.MessageBox.ERROR,
                    buttons: Ext.MessageBox.OK
                });
            },
            success: function (data) {
                if (data.fldTaeedSavabegh == false || (data.fldTaeedSavabegh == true && data.taeed == true)) {/*اجازه صدور فیش*/
                    var Mablagh = Ext.getCmp(tabId).queryById("Mablagh");
                    var CarFileid = tabId.substring(14);
                    var fldFine = Ext.getCmp(tabId).queryById("fldFine");
                    var fldValueAddPrice = Ext.getCmp(tabId).queryById("fldValueAddPrice");
                    var fldPrice = Ext.getCmp(tabId).queryById("fldPrice");
                    var Bed = Ext.getCmp(tabId).queryById("Bed");
                    var Years = Ext.getCmp(tabId).queryById("Years");
                    var fldOtherPrice = Ext.getCmp(tabId).queryById("fldOtherPrice");
                    var fldMainDiscount = Ext.getCmp(tabId).queryById("fldMainDiscount");
                    var fldFineDiscount = Ext.getCmp(tabId).queryById("fldFineDiscount");
                    var fldValueAddDiscount = Ext.getCmp(tabId).queryById("fldValueAddDiscount");
                    var fldOtherDiscount = Ext.getCmp(tabId).queryById("fldOtherDiscount");
                    if (Mablagh.getValue() > 10000) {
                        Ext.net.DirectMethod.request({
                            url: '/NewVer/SelectParvande/PishkhanPos',
                            params: {
                                Mablagh: Mablagh.getValue(),
                                CarFileid: CarFileid,
                                fldFine: fldFine.getValue(),
                                fldValueAddPrice: fldValueAddPrice.getValue(),
                                fldPrice: fldPrice.getValue(),
                                Years: Years.getValue(),
                                Bed: Bed.getValue(),
                                fldOtherPrice: fldOtherPrice.getValue(),
                                fldMainDiscount: fldMainDiscount.getValue(),
                                fldFineDiscount: fldFineDiscount.getValue(),
                                fldValueAddDiscount: fldValueAddDiscount.getValue(),
                                fldOtherDiscount: fldOtherDiscount.getValue()
                            },
                            success: function (data1) {
                                if (data1.err == 0) {
                                    if (data1.flag == 1) {
                                        Ext.MessageBox.show({
                                            title: "",
                                            msg: "در صورت وجود رسید کارتخوان جهت تأیید دستی گزینه تکمیل پرداخت را انتخاب نمایید و در غیر این صورت جهت ارسال مجدد اطلاعات به دستگاه کارتخوان گزینه پرداخت را انتخاب نمایید.",
                                            icon: Ext.MessageBox.WARNING,
                                            buttons: Ext.MessageBox.YESNO,
                                            buttonText: {
                                                yes: 'تکمیل پرداخت',
                                                no: 'پرداخت'
                                            },
                                            fn: function (btn) {
                                                if (btn == 'yes') {
                                                    Ext.net.DirectMethod.request({
                                                        url: '/NewVer/AppReport_New/GetInfoPose',
                                                        params: {
                                                            PishkhanPosId: data1.posId
                                                        },
                                                        success: function (data1) {

                                                        }
                                                    });
                                                }
                                                else {
                                                    App.AvarezWin.body.mask('لطفا تا دریافت اطلاعات از دستگاه POS منتظر بمانید\n و از refresh کردن صفحه یا استفاده از دکمه back مرورگر خودداری فرمایید');
                                                    paytax(data1.posString, 'ref1');
                                                }
                                            }
                                        });
                                    }
                                    else {
                                        App.AvarezWin.body.mask('لطفا تا دریافت اطلاعات از دستگاه POS منتظر بمانید\n و از refresh کردن صفحه یا استفاده از دکمه back مرورگر خودداری فرمایید');
                                        paytax(data1.posString, 'ref1');
                                    }
                                }
                                else
                                    Ext.MessageBox.show({
                                        title: "خطا",
                                        msg: 'پرونده انتخابی بدهکار نمی باشد.',
                                        icon: Ext.MessageBox.ERROR,
                                        buttons: Ext.MessageBox.OK
                                    });
                            }
                        });
                    }
                    else
                        Ext.MessageBox.show({
                            title: "خطا",
                            msg: 'پرونده انتخابی بدهکار نمی باشد.',
                            icon: Ext.MessageBox.ERROR,
                            buttons: Ext.MessageBox.OK
                        });

                }
                else {
                    Ext.MessageBox.show({
                        title: "",
                        msg: "کاربر گرامی پرونده مذکور دارای انتقال سابقه تأیید نشده است. لطفا منتظر تأیید بمانید و چند دقیقه دیگر اقدام به پرداخت نمایید. ",
                        icon: Ext.MessageBox.INFO,
                        buttons: Ext.MessageBox.OK
                    });
                }
            }
        });
    }

    function pishkhanRecipt(type) {
        paytype = type;
        var tabId = App.SearchParvande.activeTab.id;
        var CarFileid = tabId.substring(14);
        Ext.net.DirectMethod.request({
            url: '/NewVer/SelectParvande/PishkhanResipt',
            params: {
                CarFileid: CarFileid
            },
            success: function (data1) {
                if (data1.err == 0) {
                    if (data1.flag == 1) {
                        Ext.MessageBox.show({
                            title: "",
                            msg: "در صورت وجود رسید کارتخوان جهت تأیید دستی گزینه تکمیل پرداخت را انتخاب نمایید و در غیر این صورت جهت ارسال مجدد اطلاعات به دستگاه کارتخوان گزینه پرداخت را انتخاب نمایید.",
                            icon: Ext.MessageBox.WARNING,
                            buttons: Ext.MessageBox.YESNO,
                            buttonText: {
                                yes: 'تکمیل پرداخت',
                                no: 'پرداخت'
                            },
                            fn: function (btn) {
                                if (btn == 'yes') {
                                    Ext.net.DirectMethod.request({
                                        url: '/NewVer/AppReport_New/GetInfoReciept',
                                        params: {
                                            PishkhanRecipetId: data1.recieptId
                                        },
                                        success: function (data1) {

                                        }
                                    });
                                }
                                else {
                                    App.AvarezWin.body.mask('لطفا تا دریافت اطلاعات از دستگاه POS منتظر بمانید\n و از refresh کردن صفحه یا استفاده از دکمه back مرورگر خودداری فرمایید');
                                    paytax(data1.posString, 'ref1');
                                }
                            }
                        });
                    }
                    else {
                        App.AvarezWin.body.mask('لطفا تا دریافت اطلاعات از دستگاه POS منتظر بمانید\n و از refresh کردن صفحه یا استفاده از دکمه back مرورگر خودداری فرمایید');
                        paytax(data1.posString, 'ref1');
                    }
                }
                else {
                    Ext.MessageBox.show({
                        title: "خطا",
                        msg: data1.msg,
                        icon: Ext.MessageBox.ERROR,
                        buttons: Ext.MessageBox.OK
                    });
                    App.AvarezWin.body.mask().hide();
                }
            }
        });
    }
</script>